<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>è®¡ç®—æœºçŸ¥è¯†ä½“ç³»æ€»è§ˆ | Leosocy's Blog</title><meta name="description" content="æŠŠçŸ¥è¯†çœ‹ä½œæ˜¯ä¸€é¢—è¯­ä¹‰æ ‘ï¼Œåœ¨è¿›å…¥å¶å­ï¼ˆç»†èŠ‚ï¼‰ä¹‹å‰ï¼Œå…ˆç¡®ä¿è‡ªå·±ç†è§£äº†åŸºæœ¬åŸç†ï¼Œä¹Ÿå°±æ˜¯è¿™é¢—æ ‘çš„æ ‘å¹²å’Œå¤§çš„æ ‘æï¼Œç„¶åå†æ·±å…¥åˆ°æ ‘å¶ï¼Œå¦åˆ™çš„è¯é‚£äº›æ ‘å¶å’Œç»†èŠ‚å°†ä¼šæ— å¤„æ –èº«ï¼Œå¯¼è‡´å¾ˆå¿«å‡‹è½ï¼ˆé—å¿˜ï¼‰ã€‚éšç€å·¥ä½œç»éªŒçš„å¢é•¿ï¼Œæ„ˆå‘è§‰å¾—å¾ˆå¤šæŠ€æœ¯èƒŒåçš„åŸºæœ¬åŸç†éƒ½æ˜¯ç›¸é€šçš„ï¼Œæ‰€ä»¥åŸºäºè¿™äº›åŸç†æ„å»ºè‡ªå·±çš„çŸ¥è¯†ä½“ç³»æ˜¯å°¤ä¸ºé‡è¦çš„ï¼Œè¿™æ ·æ‰èƒ½æ›´å¥½åœ°åšåˆ°æ¥ï¼ˆå­¦ä¹ ï¼‰ã€åŒ–ï¼ˆç†è§£ï¼‰ã€å‘ï¼ˆåˆ›é€ ï¼‰ã€‚"><meta name="keywords" content="åŸºç¡€çŸ¥è¯†,åç«¯æŠ€èƒ½,ç¼–ç¨‹è¯­è¨€,å†…åŠŸå¿ƒæ³•,å¤§æ•°æ®,äº‘åŸç”Ÿ,æ•ˆç‡å·¥å…·"><meta name="author" content="Leosocy,leosocy@gmail.com"><meta name="copyright" content="Leosocy"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://cdn.leosocy.top/img/LEO-logo.jpg"><link rel="canonical" href="https://blog.leosocy.top/posts/133f/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//www.google-analytics.com" crossorigin="crossorigin"><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"><meta name="google-site-verification" content="oh1OfqVAIxCAFZ8w5KBBtK7tJK48Z0HuFl2XXbRiM-E"><meta name="baidu-site-verification" content="code-7jpxSWptMj"><meta property="og:type" content="article"><meta property="og:title" content="è®¡ç®—æœºçŸ¥è¯†ä½“ç³»æ€»è§ˆ"><meta property="og:url" content="https://blog.leosocy.top/posts/133f/"><meta property="og:site_name" content="Leosocy's Blog"><meta property="og:description" content="æŠŠçŸ¥è¯†çœ‹ä½œæ˜¯ä¸€é¢—è¯­ä¹‰æ ‘ï¼Œåœ¨è¿›å…¥å¶å­ï¼ˆç»†èŠ‚ï¼‰ä¹‹å‰ï¼Œå…ˆç¡®ä¿è‡ªå·±ç†è§£äº†åŸºæœ¬åŸç†ï¼Œä¹Ÿå°±æ˜¯è¿™é¢—æ ‘çš„æ ‘å¹²å’Œå¤§çš„æ ‘æï¼Œç„¶åå†æ·±å…¥åˆ°æ ‘å¶ï¼Œå¦åˆ™çš„è¯é‚£äº›æ ‘å¶å’Œç»†èŠ‚å°†ä¼šæ— å¤„æ –èº«ï¼Œå¯¼è‡´å¾ˆå¿«å‡‹è½ï¼ˆé—å¿˜ï¼‰ã€‚éšç€å·¥ä½œç»éªŒçš„å¢é•¿ï¼Œæ„ˆå‘è§‰å¾—å¾ˆå¤šæŠ€æœ¯èƒŒåçš„åŸºæœ¬åŸç†éƒ½æ˜¯ç›¸é€šçš„ï¼Œæ‰€ä»¥åŸºäºè¿™äº›åŸç†æ„å»ºè‡ªå·±çš„çŸ¥è¯†ä½“ç³»æ˜¯å°¤ä¸ºé‡è¦çš„ï¼Œè¿™æ ·æ‰èƒ½æ›´å¥½åœ°åšåˆ°æ¥ï¼ˆå­¦ä¹ ï¼‰ã€åŒ–ï¼ˆç†è§£ï¼‰ã€å‘ï¼ˆåˆ›é€ ï¼‰ã€‚"><meta property="og:image" content="https://blog.leosocy.top/img/computer-science.png"><meta property="article:published_time" content="2020-11-14T03:42:22.000Z"><meta property="article:modified_time" content="2023-11-05T07:26:20.240Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-8EGQPPW7GQ"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-8EGQPPW7GQ');
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  bookmark: {
    message_prev: 'æŒ‰',
    message_next: 'é”®å°†æœ¬é¡µåŠ å…¥ä¹¦ç­¾'
  },
  runtime_unit: 'å¤©',
  runtime: false,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"æŒ‰","message_next":"é”®å°†æœ¬é¡µåŠ å…¥ä¹¦ç­¾"},"chs_to_cht":"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“","cht_to_chs":"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“","day_to_night":"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>(function(win, export_obj) {
win['TeaAnalyticsObject'] = export_obj;
if (!win[export_obj]) {
function _collect() {
_collect.q.push(arguments);
}
_collect.q = _collect.q || [];
win[export_obj] = _collect;
}
win[export_obj].l = +new Date();
})(window, 'collectEvent');</script><script async src="https://sf1-scmcdn-tos.pstatp.com/goofy/log-sdk/collect/collect-autotrack-rangers.js"></script><script>window.collectEvent('init', {
app_id: 190292,//  å¿…é¡»æ›¿æ¢æˆç”³è¯·çš„ app_id
channel: 'cn',
log: true, // å¼€å¯è°ƒè¯•æ—¥å¿—
autotrack: true // å¼€å¯å…¨åŸ‹ç‚¹é‡‡é›†ï¼Œé»˜è®¤å…³é—­ï¼Œéœ€è¦çƒ­åŠ›å›¾åŠåœˆé€‰åŠŸèƒ½å¯å¼€å¯
});
window.collectEvent('start');</script><script>var _wr = function(type) {
  var orig = history[type];
  return function() {
    var rv = orig.apply(this, arguments);
    var e = new Event(type);
    e.arguments = arguments;
    window.dispatchEvent(e);
    return rv;
  };
};
history.pushState = _wr('pushState');
history.replaceState = _wr('replaceState');
window.addEventListener("popstate", function(event) {
  window.collectEvent('predefinePageView');
});
window.addEventListener("pushState", function(event) {
  window.collectEvent('predefinePageView');
});</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2023-11-05 15:26:20'
}</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LeosocyBlog/cdn@master/css/leosocy.min.css"><meta name="referrer" content="no-referrer-when-downgrade"><meta name="generator" content="Hexo 7.0.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" data-lazy-src="https://cdn.leosocy.top/img/avatar-leosocy.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length_num">26</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length_num">40</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length_num">21</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-github"></i><span> æˆ‘çš„å¼€æºé¡¹ç›®</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Leosocy/EDCC-Palmprint-Recognition"><i class="fa-fw fas fa-id-card"></i><span> EDCCé«˜æ•ˆã€å‡†ç¡®çš„æŒçº¹è¯†åˆ«ç®—æ³•</span></a></li><li><a class="site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Leosocy/RobustPalmRoi"><i class="fa-fw fas fa-hand-paper"></i><span> RobustPalmRoié²æ£’æ€§å¥½çš„æŒçº¹ROIæå–ç®—æ³•</span></a></li><li><a class="site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Leosocy/IntelliProxy"><i class="fa-fw fas fa-cloud"></i><span> Goå®ç°çš„æŒä¹…å®æ—¶é«˜è´¨é‡çš„HTTPä»£ç†</span></a></li><li><a class="site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Leosocy/cacheorm"><i class="fa-fw fas fa-database"></i><span> åŸºäºç¼“å­˜çš„Python ORMæ¡†æ¶</span></a></li><li><a class="site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Leosocy/SmartThreadPool"><i class="fa-fw fas fa-sitemap"></i><span> C++11å®ç°çš„æ™ºèƒ½çº¿ç¨‹æ± åº“</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/gossip/"><i class="fa-fw fas fa-book"></i><span> éšç¬”</span></a></div></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">ç›®å½•</div><div class="sidebar-toc__progress"><span class="progress-notice">ä½ å·²ç»è¯»äº†</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">åŸºç¡€çŸ¥è¯†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.</span> <span class="toc-text">è®¡ç®—æœºåŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%AF%C2%B7%E8%AF%BA%E4%BE%9D%E6%9B%BC%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.1.</span> <span class="toc-text">å†¯Â·è¯ºä¾æ›¼ä½“ç³»ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CPU%E7%BB%84%E6%88%90"><span class="toc-number">1.1.2.</span> <span class="toc-text">CPUç»„æˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">å¯„å­˜å™¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CPU%E6%8C%87%E4%BB%A4"><span class="toc-number">1.1.3.</span> <span class="toc-text">CPUæŒ‡ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4%E5%88%86%E7%B1%BB"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">æŒ‡ä»¤åˆ†ç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%BA%E5%99%A8%E7%A0%81%E7%9A%84%E7%94%9F%E6%88%90"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">æœºå™¨ç çš„ç”Ÿæˆ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4%E8%B7%B3%E8%BD%AC"><span class="toc-number">1.1.3.3.</span> <span class="toc-text">æŒ‡ä»¤è·³è½¬</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#if%E2%80%A6else-goto"><span class="toc-number">1.1.3.3.1.</span> <span class="toc-text">ifâ€¦else + goto</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#while-amp-for"><span class="toc-number">1.1.3.3.2.</span> <span class="toc-text">while &amp; for</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#switch%E2%80%A6case"><span class="toc-number">1.1.3.3.3.</span> <span class="toc-text">switchâ€¦case</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E5%8F%8A%E6%A0%88%E5%B8%A7"><span class="toc-number">1.1.3.4.</span> <span class="toc-text">å‡½æ•°è°ƒç”¨åŠæ ˆå¸§</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E6%A0%88%E5%B8%A7%E8%B5%B7%E6%BA%90"><span class="toc-number">1.1.3.4.1.</span> <span class="toc-text">å‡½æ•°æ ˆå¸§èµ·æº</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B1%87%E7%BC%96%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">1.1.3.4.2.</span> <span class="toc-text">æ±‡ç¼–ä»£ç åˆ†æ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x86-64%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="toc-number">1.1.3.4.3.</span> <span class="toc-text">x86_64å¸¸ç”¨æŒ‡ä»¤</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E5%BB%B6%E5%B1%95"><span class="toc-number">1.1.3.4.4.</span> <span class="toc-text">ç›¸å…³çŸ¥è¯†å»¶å±•</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%86%85%E8%81%94%E4%BC%98%E5%8A%A3"><span class="toc-number">1.1.3.4.4.1.</span> <span class="toc-text">å‡½æ•°å†…è”ä¼˜åŠ£</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Stack-Overflow"><span class="toc-number">1.1.3.4.4.2.</span> <span class="toc-text">Stack Overflow</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB"><span class="toc-number">1.1.3.4.4.3.</span> <span class="toc-text">æ ˆæº¢å‡ºæ”»å‡»</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%B0%BE%E9%80%92%E5%BD%92%E4%BC%98%E5%8C%96"><span class="toc-number">1.1.3.4.4.4.</span> <span class="toc-text">å°¾é€’å½’ä¼˜åŒ–</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8D%8F%E7%A8%8B%E7%9A%84%E5%87%BD%E6%95%B0%E6%A0%88%E5%88%87%E6%8D%A2"><span class="toc-number">1.1.3.4.4.5.</span> <span class="toc-text">åç¨‹çš„å‡½æ•°æ ˆåˆ‡æ¢</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8ECPU%E6%8C%87%E4%BB%A4%E5%B1%82%E9%9D%A2%E7%90%86%E8%A7%A3%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.3.5.</span> <span class="toc-text">ä»CPUæŒ‡ä»¤å±‚é¢ç†è§£ä¸€äº›é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#LLVM"><span class="toc-number">1.1.3.5.1.</span> <span class="toc-text">LLVM</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B7%B7%E6%B7%86%E7%BC%96%E8%AF%91"><span class="toc-number">1.1.3.5.2.</span> <span class="toc-text">æ··æ·†ç¼–è¯‘</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Compare-And-Swap%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C"><span class="toc-number">1.1.3.5.3.</span> <span class="toc-text">Compare And SwapåŸå­æ“ä½œ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B6%85%E7%BA%BF%E7%A8%8B-hyperthreading"><span class="toc-number">1.1.3.5.4.</span> <span class="toc-text">è¶…çº¿ç¨‹ hyperthreading</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%89%E8%B6%A3%E7%9A%84%E4%BC%98%E5%8C%96"><span class="toc-number">1.1.3.5.5.</span> <span class="toc-text">æœ‰è¶£çš„ä¼˜åŒ–</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CPU%E8%BF%90%E7%AE%97"><span class="toc-number">1.1.4.</span> <span class="toc-text">CPUè¿ç®—</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%97%E6%9C%AF%E9%80%BB%E8%BE%91%E5%8D%95%E5%85%83%EF%BC%88ALU-Arithmetic-Logic-Unit%EF%BC%89"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">ç®—æœ¯é€»è¾‘å•å…ƒï¼ˆALU Arithmetic Logic Unitï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%97%A8%E7%94%B5%E8%B7%AF"><span class="toc-number">1.1.4.1.1.</span> <span class="toc-text">é—¨ç”µè·¯</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8A%A0%E6%B3%95%E5%99%A8"><span class="toc-number">1.1.4.1.2.</span> <span class="toc-text">åŠ æ³•å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8A%A0%E6%B3%95%E5%99%A8%E4%BC%98%E5%8C%96"><span class="toc-number">1.1.4.1.2.1.</span> <span class="toc-text">åŠ æ³•å™¨ä¼˜åŒ–</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B9%98%E6%B3%95%E5%99%A8"><span class="toc-number">1.1.4.1.3.</span> <span class="toc-text">ä¹˜æ³•å™¨</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%87%8F%E6%B3%95%E8%BF%90%E7%AE%97"><span class="toc-number">1.1.4.1.4.</span> <span class="toc-text">å‡æ³•è¿ç®—</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%87%8F%E6%B3%95%E5%99%A8%E6%95%88%E7%8E%87%E4%BD%8E"><span class="toc-number">1.1.4.1.4.1.</span> <span class="toc-text">ä¸ºä»€ä¹ˆå‡æ³•å™¨æ•ˆç‡ä½</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%B4%9F%E6%95%B0%E7%9A%84%E8%A1%A5%E7%A0%81%E8%A6%81%E6%8C%89%E4%BD%8D%E5%8F%96%E5%8F%8D%E5%B9%B6%E5%8A%A01%EF%BC%9F"><span class="toc-number">1.1.4.1.4.2.</span> <span class="toc-text">ä¸ºä»€ä¹ˆè´Ÿæ•°çš„è¡¥ç è¦æŒ‰ä½å–åå¹¶åŠ 1ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%AE%E7%82%B9%E8%BF%90%E7%AE%97"><span class="toc-number">1.1.4.1.5.</span> <span class="toc-text">æµ®ç‚¹è¿ç®—</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%90%E5%8D%87CPU%E5%88%A9%E7%94%A8%E7%8E%87"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">æå‡CPUåˆ©ç”¨ç‡</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="toc-number">1.1.4.2.1.</span> <span class="toc-text">æµæ°´çº¿</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B9%B1%E5%BA%8F%E6%89%A7%E8%A1%8C"><span class="toc-number">1.1.4.2.2.</span> <span class="toc-text">ä¹±åºæ‰§è¡Œ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E6%94%AF%E9%A2%84%E6%B5%8B"><span class="toc-number">1.1.4.2.3.</span> <span class="toc-text">åˆ†æ”¯é¢„æµ‹</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Linux%E4%B8%AD%E7%9A%84likely-unlikely"><span class="toc-number">1.1.4.2.3.1.</span> <span class="toc-text">Linuxä¸­çš„likely&#x2F;unlikely</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97%EF%BC%9ASIMD"><span class="toc-number">1.1.4.2.4.</span> <span class="toc-text">å¹¶è¡Œè®¡ç®—ï¼šSIMD</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E6%9C%89%E8%B6%A3%E5%B0%8F%F0%9F%8C%B0"><span class="toc-number">1.1.4.2.5.</span> <span class="toc-text">ä¸€äº›æœ‰è¶£å°ğŸŒ°</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98"><span class="toc-number">1.1.5.</span> <span class="toc-text">å†…å­˜</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MMU%E4%B8%8ETLB"><span class="toc-number">1.1.5.1.</span> <span class="toc-text">MMUä¸TLB</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#M-Modified-E-Exclusive-S-Shared-I-Invalid-%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.1.5.2.</span> <span class="toc-text">M(Modified) E(Exclusive) S(Shared) I(Invalid)åè®®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CacheLine%E4%B8%8E%E4%BC%AA%E5%85%B1%E4%BA%AB"><span class="toc-number">1.1.5.3.</span> <span class="toc-text">CacheLineä¸ä¼ªå…±äº«</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E4%B8%8EI-O%E8%AE%BE%E5%A4%87"><span class="toc-number">1.1.6.</span> <span class="toc-text">å­˜å‚¨ä¸I&#x2F;Oè®¾å¤‡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DMA"><span class="toc-number">1.1.6.1.</span> <span class="toc-text">DMA</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#INT%E4%B8%AD%E6%96%AD"><span class="toc-number">1.1.6.2.</span> <span class="toc-text">INTä¸­æ–­</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88ARM%E6%9E%B6%E6%9E%84%E5%9C%A8%E7%A7%BB%E5%8A%A8%E4%BA%92%E8%81%94%E7%BD%91%E6%97%B6%E4%BB%A3%E5%A4%A7%E8%A1%8C%E5%85%B6%E9%81%93"><span class="toc-number">1.1.7.</span> <span class="toc-text">ä¸ºä»€ä¹ˆARMæ¶æ„åœ¨ç§»åŠ¨äº’è”ç½‘æ—¶ä»£å¤§è¡Œå…¶é“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.2.</span> <span class="toc-text">æ“ä½œç³»ç»Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="toc-number">1.2.1.</span> <span class="toc-text">å†…å­˜ç®¡ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%A9%E7%90%86%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">ç‰©ç†å†…å­˜ç®¡ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BC%99%E4%BC%B4%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.2.1.1.1.</span> <span class="toc-text">ä¼™ä¼´ç³»ç»Ÿ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B0%8F%E5%AF%B9%E8%B1%A1%E5%88%86%E9%85%8D"><span class="toc-number">1.2.1.1.2.</span> <span class="toc-text">å°å¯¹è±¡åˆ†é…</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">è™šæ‹Ÿå†…å­˜ç®¡ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%A1%B5%E8%A1%A8%E5%B8%83%E5%B1%80"><span class="toc-number">1.2.1.2.1.</span> <span class="toc-text">é¡µè¡¨å¸ƒå±€</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Page-Table-Entry-Flags"><span class="toc-number">1.2.1.2.2.</span> <span class="toc-text">Page Table Entry Flags</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PGD%E4%B8%8E%E8%BF%9B%E7%A8%8B%E5%88%87%E6%8D%A2"><span class="toc-number">1.2.1.2.3.</span> <span class="toc-text">PGDä¸è¿›ç¨‹åˆ‡æ¢</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Huge-Page"><span class="toc-number">1.2.1.2.4.</span> <span class="toc-text">Huge Page</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.</span> <span class="toc-text">ç¼–è¯‘åŸç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E9%93%BE%E6%8E%A5%E4%B8%8E%E8%A3%85%E8%BD%BD"><span class="toc-number">1.4.</span> <span class="toc-text">ç¨‹åºé“¾æ¥ä¸è£…è½½</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%93%E6%89%93%E6%A1%A9%E6%9C%BA%E5%88%B6"><span class="toc-number">1.4.1.</span> <span class="toc-text">åº“æ‰“æ¡©æœºåˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5"><span class="toc-number">1.4.2.</span> <span class="toc-text">é“¾æ¥</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5%E7%9A%84%E6%8E%A5%E5%8F%A3%E2%80%94%E2%80%94%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">é“¾æ¥çš„æ¥å£â€”â€”ç¬¦å·</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">åŠ¨æ€é“¾æ¥</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#GOT%E4%B8%8EC-%E4%B8%AD%E7%9A%84%E8%99%9A%E5%87%BD%E6%95%B0%E8%A1%A8"><span class="toc-number">1.4.2.2.1.</span> <span class="toc-text">GOTä¸C++ä¸­çš„è™šå‡½æ•°è¡¨</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E7%9A%84%E5%85%A5%E5%8F%A3%E4%B8%80%E5%AE%9A%E6%98%AFmain%E5%90%97"><span class="toc-number">1.4.2.2.2.</span> <span class="toc-text">å‡½æ•°çš„å…¥å£ä¸€å®šæ˜¯mainå—</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C"><span class="toc-number">1.5.</span> <span class="toc-text">è®¡ç®—æœºç½‘ç»œ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E8%B5%84%E6%96%99"><span class="toc-number">1.5.1.</span> <span class="toc-text">ç›¸å…³èµ„æ–™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82"><span class="toc-number">1.5.2.</span> <span class="toc-text">æ•°æ®é“¾è·¯å±‚</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#FDB-Fowarding-dataase"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">FDB(Fowarding dataase)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82"><span class="toc-number">1.5.3.</span> <span class="toc-text">ç½‘ç»œå±‚</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ARP-Address-Resolution-Protocol"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">ARP(Address Resolution Protocol)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IP"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">IP</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IPv6"><span class="toc-number">1.5.3.2.1.</span> <span class="toc-text">IPv6</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E5%B0%8F%E9%97%AE%E9%A2%98"><span class="toc-number">1.5.3.2.1.1.</span> <span class="toc-text">ä¸€äº›å°é—®é¢˜</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TUN-TAP%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8"><span class="toc-number">1.5.3.3.</span> <span class="toc-text">TUN&#x2F;TAPåŠå…¶åº”ç”¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#socket"><span class="toc-number">1.5.4.</span> <span class="toc-text">socket</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#UnixDomain-Socket"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">UnixDomain Socket</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E5%B1%82"><span class="toc-number">1.5.5.</span> <span class="toc-text">ä¼ è¾“å±‚</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Packet-Filtering-amp-iptables"><span class="toc-number">1.5.5.1.</span> <span class="toc-text">Packet Filtering &amp; iptables</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%B1%82%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.5.6.</span> <span class="toc-text">åº”ç”¨å±‚åè®®</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HTTP%E5%AE%B6%E6%97%8F"><span class="toc-number">1.5.6.1.</span> <span class="toc-text">HTTPå®¶æ—</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#HTTP2%E7%89%B9%E6%80%A7"><span class="toc-number">1.5.6.1.1.</span> <span class="toc-text">HTTP2ç‰¹æ€§</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#QUIC"><span class="toc-number">1.5.6.1.2.</span> <span class="toc-text">QUIC</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DNS"><span class="toc-number">1.5.6.2.</span> <span class="toc-text">DNS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SSH"><span class="toc-number">1.5.6.3.</span> <span class="toc-text">SSH</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#SSH%E4%BD%BF%E7%94%A8%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81%E8%AE%A4%E8%AF%81%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.6.3.1.</span> <span class="toc-text">SSHä½¿ç”¨è´¦å·å¯†ç è®¤è¯åŸç†</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SSH%E4%BD%BF%E7%94%A8%E7%A7%98%E9%92%A5%E8%AE%A4%E8%AF%81%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.6.3.2.</span> <span class="toc-text">SSHä½¿ç”¨ç§˜é’¥è®¤è¯åŸç†</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SSH-tunneling%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BD%BF%E7%94%A8"><span class="toc-number">1.5.6.3.3.</span> <span class="toc-text">SSH tunnelingåŸç†åŠä½¿ç”¨</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95"><span class="toc-number">1.6.</span> <span class="toc-text">æ•°æ®ç»“æ„ä¸ç®—æ³•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8A%80%E8%83%BD"><span class="toc-number">2.</span> <span class="toc-text">åç«¯æŠ€èƒ½</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">2.1.</span> <span class="toc-text">æ•°æ®åº“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL"><span class="toc-number">2.1.1.</span> <span class="toc-text">MySQL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#InnoDB%E7%9A%84Page-Structure"><span class="toc-number">2.1.1.1.</span> <span class="toc-text">InnoDBçš„Page Structure</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8"><span class="toc-number">2.1.2.</span> <span class="toc-text">åˆ†åº“åˆ†è¡¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">ä¸€è‡´æ€§å“ˆå¸Œ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98"><span class="toc-number">2.2.</span> <span class="toc-text">ç¼“å­˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF%E6%80%BB%E8%A7%88"><span class="toc-number">2.2.1.</span> <span class="toc-text">ç¼“å­˜æŠ€æœ¯æ€»è§ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">ç¼“å­˜æ·˜æ±°ç­–ç•¥</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#TinyLFU"><span class="toc-number">2.2.1.1.1.</span> <span class="toc-text">TinyLFU</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#W-TinyLFU"><span class="toc-number">2.2.1.1.1.1.</span> <span class="toc-text">W-TinyLFU</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis"><span class="toc-number">2.2.2.</span> <span class="toc-text">Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">Redisæ•°æ®ç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Redis%E7%BC%96%E7%A0%81"><span class="toc-number">2.2.2.1.1.</span> <span class="toc-text">Redisç¼–ç </span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Redis%E5%AF%B9%E8%B1%A1"><span class="toc-number">2.2.2.1.2.</span> <span class="toc-text">Rediså¯¹è±¡</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#String-Object"><span class="toc-number">2.2.2.1.2.1.</span> <span class="toc-text">String Object</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">Redisé€šä¿¡åè®®</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#RESP%EF%BC%88REdis-Serialization-Protocol%EF%BC%89"><span class="toc-number">2.2.2.2.1.</span> <span class="toc-text">RESPï¼ˆREdis Serialization Protocolï¼‰</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%98%E6%B1%B0%E6%9C%BA%E5%88%B6"><span class="toc-number">2.2.2.3.</span> <span class="toc-text">æ·˜æ±°æœºåˆ¶</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E7%BC%93%E5%AD%98"><span class="toc-number">2.2.3.</span> <span class="toc-text">å†…å­˜ç¼“å­˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="toc-number">2.3.</span> <span class="toc-text">æ¶ˆæ¯é˜Ÿåˆ—</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E7%A0%81-amp-%E5%8E%8B%E7%BC%A9-amp-%E5%8A%A0%E5%AF%86"><span class="toc-number">2.4.</span> <span class="toc-text">ç¼–ç  &amp; å‹ç¼© &amp; åŠ å¯†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E7%A0%81"><span class="toc-number">2.4.1.</span> <span class="toc-text">ç¼–ç </span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81"><span class="toc-number">2.4.1.1.</span> <span class="toc-text">å­—ç¬¦ç¼–ç </span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E9%9B%86%E4%B8%8E%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E5%8F%91%E5%B1%95%E5%8F%B2"><span class="toc-number">2.4.1.1.1.</span> <span class="toc-text">å­—ç¬¦é›†ä¸å­—ç¬¦ç¼–ç å‘å±•å²</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#UTF-8%E7%BC%96%E7%A0%81%E8%A7%84%E5%88%99"><span class="toc-number">2.4.1.1.2.</span> <span class="toc-text">UTF-8ç¼–ç è§„åˆ™</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%8B%E6%8C%81%E4%B8%A4%E6%8A%8A%E9%94%9F%E6%96%A4%E6%8B%B7%EF%BC%8C%E5%8F%A3%E4%B8%AD%E7%96%BE%E5%91%BC%E7%83%AB%E7%83%AB%E7%83%AB"><span class="toc-number">2.4.1.1.3.</span> <span class="toc-text">æ‰‹æŒä¸¤æŠŠé”Ÿæ–¤æ‹·ï¼Œå£ä¸­ç–¾å‘¼çƒ«çƒ«çƒ«</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#MySQL%E4%B8%AD%E7%9A%84utf8mb4"><span class="toc-number">2.4.1.1.4.</span> <span class="toc-text">MySQLä¸­çš„utf8mb4</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Python2%E4%B8%AD%E8%AE%A8%E5%8E%8C%E7%9A%84%E7%BC%96%E7%A0%81"><span class="toc-number">2.4.1.1.5.</span> <span class="toc-text">Python2ä¸­è®¨åŒçš„ç¼–ç </span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Protobuf"><span class="toc-number">2.4.1.2.</span> <span class="toc-text">Protobuf</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#varint"><span class="toc-number">2.4.1.2.1.</span> <span class="toc-text">varint</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#zigzag"><span class="toc-number">2.4.1.2.2.</span> <span class="toc-text">zigzag</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JSON"><span class="toc-number">2.4.1.3.</span> <span class="toc-text">JSON</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#simdjson%E6%98%AF%E4%BD%95%E6%96%B9%E7%A5%9E%E5%9C%A3"><span class="toc-number">2.4.1.3.1.</span> <span class="toc-text">simdjsonæ˜¯ä½•æ–¹ç¥åœ£</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Base64%E5%AE%B6%E6%97%8F"><span class="toc-number">2.4.1.4.</span> <span class="toc-text">Base64å®¶æ—</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%8B%E7%BC%A9"><span class="toc-number">2.4.2.</span> <span class="toc-text">å‹ç¼©</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#GZip"><span class="toc-number">2.4.2.1.</span> <span class="toc-text">GZip</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LZ4"><span class="toc-number">2.4.2.2.</span> <span class="toc-text">LZ4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Snappy"><span class="toc-number">2.4.2.3.</span> <span class="toc-text">Snappy</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86"><span class="toc-number">2.4.3.</span> <span class="toc-text">åŠ å¯†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86"><span class="toc-number">2.4.3.1.</span> <span class="toc-text">éå¯¹ç§°åŠ å¯†</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#RSA%E7%AE%97%E6%B3%95%E7%9A%84%E6%95%B0%E5%AD%A6%E5%8E%9F%E7%90%86"><span class="toc-number">2.4.3.1.1.</span> <span class="toc-text">RSAç®—æ³•çš„æ•°å­¦åŸç†</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F"><span class="toc-number">2.5.</span> <span class="toc-text">åˆ†å¸ƒå¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RPC"><span class="toc-number">2.6.</span> <span class="toc-text">RPC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E4%B8%8E%E5%9B%9E%E6%94%B6"><span class="toc-number">2.7.</span> <span class="toc-text">å†…å­˜åˆ†é…ä¸å›æ”¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#eBPF"><span class="toc-number">2.8.</span> <span class="toc-text">eBPF</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80"><span class="toc-number">3.</span> <span class="toc-text">ç¼–ç¨‹è¯­è¨€</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#C"><span class="toc-number">3.1.</span> <span class="toc-text">C</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C-1"><span class="toc-number">3.2.</span> <span class="toc-text">C++</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Python"><span class="toc-number">3.3.</span> <span class="toc-text">Python</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.3.1.</span> <span class="toc-text">åº•å±‚å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E5%88%87%E7%9A%86%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.3.1.1.</span> <span class="toc-text">ä¸€åˆ‡çš†å¯¹è±¡</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#int"><span class="toc-number">3.3.1.1.1.</span> <span class="toc-text">int</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#import"><span class="toc-number">3.3.1.2.</span> <span class="toc-text">import</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A5%87%E6%B7%AB%E5%B7%A7%E6%8A%80"><span class="toc-number">3.3.2.</span> <span class="toc-text">å¥‡æ·«å·§æŠ€</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#new-%E4%B8%8E-init"><span class="toc-number">3.3.2.1.</span> <span class="toc-text">__new__ä¸__init__</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E6%96%B9%E6%B3%95%E4%B8%8E%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95"><span class="toc-number">3.3.2.2.</span> <span class="toc-text">ç±»æ–¹æ³•ä¸å®ä¾‹æ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mock%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-number">3.3.2.3.</span> <span class="toc-text">mockçš„åŸç†</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java"><span class="toc-number">3.4.</span> <span class="toc-text">Java</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JVM"><span class="toc-number">3.4.1.</span> <span class="toc-text">JVM</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Object-Header"><span class="toc-number">3.4.1.1.</span> <span class="toc-text">Object Header</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Scala"><span class="toc-number">3.5.</span> <span class="toc-text">Scala</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Go"><span class="toc-number">3.6.</span> <span class="toc-text">Go</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88Go%E7%9A%84%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6%E7%89%B9%E5%88%AB%E5%B0%8F%E8%BF%98%E4%B8%8D%E9%9C%80%E8%A6%81%E4%BE%9D%E8%B5%96so"><span class="toc-number">3.6.1.</span> <span class="toc-text">ä¸ºä»€ä¹ˆGoçš„å¯æ‰§è¡Œæ–‡ä»¶ç‰¹åˆ«å°è¿˜ä¸éœ€è¦ä¾èµ–so</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95"><span class="toc-number">4.</span> <span class="toc-text">å†…åŠŸå¿ƒæ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E6%80%9D%E6%83%B3"><span class="toc-number">4.1.</span> <span class="toc-text">é¢å‘å¯¹è±¡æ€æƒ³</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-number">4.2.</span> <span class="toc-text">è®¾è®¡åŸåˆ™</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.3.</span> <span class="toc-text">è®¾è®¡æ¨¡å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83"><span class="toc-number">4.4.</span> <span class="toc-text">ç¼–ç è§„èŒƒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83"><span class="toc-number">4.5.</span> <span class="toc-text">æ¥å£è®¾è®¡è§„èŒƒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E9%87%8D%E6%9E%84"><span class="toc-number">4.6.</span> <span class="toc-text">ä»£ç é‡æ„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.7.</span> <span class="toc-text">é¢†åŸŸé©±åŠ¨è®¾è®¡</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%A7%E6%95%B0%E6%8D%AE"><span class="toc-number">5.</span> <span class="toc-text">å¤§æ•°æ®</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%B9%E6%B5%81%E5%A4%84%E7%90%86"><span class="toc-number">5.1.</span> <span class="toc-text">æ‰¹æµå¤„ç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8"><span class="toc-number">5.2.</span> <span class="toc-text">å­˜å‚¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%97%B6%E5%88%86%E6%9E%90"><span class="toc-number">5.3.</span> <span class="toc-text">å®æ—¶åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%91%E5%8E%9F%E7%94%9F"><span class="toc-number">6.</span> <span class="toc-text">äº‘åŸç”Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF"><span class="toc-number">6.1.</span> <span class="toc-text">è™šæ‹ŸåŒ–æŠ€æœ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#KVM"><span class="toc-number">6.1.1.</span> <span class="toc-text">KVM</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF"><span class="toc-number">6.2.</span> <span class="toc-text">å®¹å™¨æŠ€æœ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%BA%95%E5%B1%82%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF"><span class="toc-number">6.2.1.</span> <span class="toc-text">å®¹å™¨åº•å±‚æ ¸å¿ƒæŠ€æœ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Namespace"><span class="toc-number">6.2.1.1.</span> <span class="toc-text">Namespace</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CGroup"><span class="toc-number">6.2.1.2.</span> <span class="toc-text">CGroup</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker"><span class="toc-number">6.2.2.</span> <span class="toc-text">Docker</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker%E7%BD%91%E7%BB%9C"><span class="toc-number">6.2.2.1.</span> <span class="toc-text">Dockerç½‘ç»œ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Podman"><span class="toc-number">6.2.3.</span> <span class="toc-text">Podman</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kubernetes"><span class="toc-number">6.3.</span> <span class="toc-text">Kubernetes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#K8S%E7%BD%91%E7%BB%9C"><span class="toc-number">6.3.1.</span> <span class="toc-text">K8Sç½‘ç»œ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Flannel%E7%BD%91%E7%BB%9C%E5%8E%9F%E7%90%86"><span class="toc-number">6.3.1.1.</span> <span class="toc-text">Flannelç½‘ç»œåŸç†</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Helm"><span class="toc-number">6.3.2.</span> <span class="toc-text">Helm</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ServiceMesh"><span class="toc-number">6.4.</span> <span class="toc-text">ServiceMesh</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1"><span class="toc-number">7.</span> <span class="toc-text">ç³»ç»Ÿè®¾è®¡</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%B9%8B%E5%A4%96%E7%9A%84%E8%BD%AF%E6%8A%80%E8%83%BD"><span class="toc-number">8.</span> <span class="toc-text">ä»£ç ä¹‹å¤–çš„è½¯æŠ€èƒ½</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%88%E7%8E%87%E5%B7%A5%E5%85%B7"><span class="toc-number">9.</span> <span class="toc-text">æ•ˆç‡å·¥å…·</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="toc-number">9.1.</span> <span class="toc-text">æ€§èƒ½åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%81%AB%E7%84%B0%E5%9B%BE"><span class="toc-number">9.1.1.</span> <span class="toc-text">ç«ç„°å›¾</span></a></li></ol></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://cdn.leosocy.top/img/computer-science.png)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">Leosocy's Blog</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-github"></i><span> æˆ‘çš„å¼€æºé¡¹ç›®</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Leosocy/EDCC-Palmprint-Recognition"><i class="fa-fw fas fa-id-card"></i><span> EDCCé«˜æ•ˆã€å‡†ç¡®çš„æŒçº¹è¯†åˆ«ç®—æ³•</span></a></li><li><a class="site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Leosocy/RobustPalmRoi"><i class="fa-fw fas fa-hand-paper"></i><span> RobustPalmRoié²æ£’æ€§å¥½çš„æŒçº¹ROIæå–ç®—æ³•</span></a></li><li><a class="site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Leosocy/IntelliProxy"><i class="fa-fw fas fa-cloud"></i><span> Goå®ç°çš„æŒä¹…å®æ—¶é«˜è´¨é‡çš„HTTPä»£ç†</span></a></li><li><a class="site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Leosocy/cacheorm"><i class="fa-fw fas fa-database"></i><span> åŸºäºç¼“å­˜çš„Python ORMæ¡†æ¶</span></a></li><li><a class="site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Leosocy/SmartThreadPool"><i class="fa-fw fas fa-sitemap"></i><span> C++11å®ç°çš„æ™ºèƒ½çº¿ç¨‹æ± åº“</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/gossip/"><i class="fa-fw fas fa-book"></i><span> éšç¬”</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">è®¡ç®—æœºçŸ¥è¯†ä½“ç³»æ€»è§ˆ</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">å‘è¡¨äº</span><time datetime="2020-11-14T03:42:22.000Z" title="undefined 2020-11-14 11:42:22">2020-11-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB%E6%9E%84%E5%BB%BA/">è®¡ç®—æœºçŸ¥è¯†ä½“ç³»æ„å»º</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">18.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>92åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="leancloud_visitors" id="/posts/133f/" data-flag-title="è®¡ç®—æœºçŸ¥è¯†ä½“ç³»æ€»è§ˆ"><i class="far fa-fire fa-fw post-meta-icon"></i><span class="post-meta-label">çƒ­åº¦:</span><span class="leancloud-visitors-count"></span><span class="du"> Â°C</span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h1><h2 id="è®¡ç®—æœºåŸç†"><a href="#è®¡ç®—æœºåŸç†" class="headerlink" title="è®¡ç®—æœºåŸç†"></a>è®¡ç®—æœºåŸç†</h2><h3 id="å†¯Â·è¯ºä¾æ›¼ä½“ç³»ç»“æ„"><a href="#å†¯Â·è¯ºä¾æ›¼ä½“ç³»ç»“æ„" class="headerlink" title="å†¯Â·è¯ºä¾æ›¼ä½“ç³»ç»“æ„"></a>å†¯Â·è¯ºä¾æ›¼ä½“ç³»ç»“æ„</h3><h3 id="CPUç»„æˆ"><a href="#CPUç»„æˆ" class="headerlink" title="CPUç»„æˆ"></a>CPUç»„æˆ</h3><ul>
<li>æ§åˆ¶å•å…ƒï¼ˆControl Unitï¼‰ï¼š</li>
<li>æ•°æ®å•å…ƒ</li>
<li>è¿ç®—å•å…ƒ</li>
</ul>
<h4 id="å¯„å­˜å™¨"><a href="#å¯„å­˜å™¨" class="headerlink" title="å¯„å­˜å™¨"></a>å¯„å­˜å™¨</h4><p>å¯„å­˜å™¨æ˜¯CPUå†…éƒ¨ç”¨æ¥å­˜æ”¾æ•°æ®çš„ä¸€äº›å°å‹å­˜å‚¨åŒºåŸŸï¼Œç”¨æ¥æš‚æ—¶å­˜æ”¾å‚ä¸è¿ç®—çš„æ•°æ®å’Œè¿ç®—ç»“æœä»¥åŠä¸€äº›CPUè¿è¡Œéœ€è¦çš„ä¿¡æ¯ã€‚</p>
<p>ä¸‹é¢å‡ ä¸ªtabsæè¿°äº†x86-64æ¶æ„ä¸­æ¶‰åŠåˆ°çš„ä¸åŒç±»åˆ«çš„å¯„å­˜å™¨</p>
<div class="tabs" id="å¯„å­˜å™¨"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#å¯„å­˜å™¨-1">é€šç”¨å¯„å­˜å™¨</button></li><li class="tab"><button type="button" data-href="#å¯„å­˜å™¨-2">æ ‡å¿—å¯„å­˜å™¨</button></li><li class="tab"><button type="button" data-href="#å¯„å­˜å™¨-3">æŒ‡ä»¤å¯„å­˜å™¨</button></li><li class="tab"><button type="button" data-href="#å¯„å­˜å™¨-4">æ§åˆ¶å¯„å­˜å™¨</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="å¯„å­˜å™¨-1"><p>é€šç”¨å¯„å­˜å™¨æ˜¯ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­æœ€å¸¸ç”¨ã€æœ€åŸºç¡€çš„å¯„å­˜å™¨ï¼Œå¤§éƒ¨åˆ†æ—¶é—´éƒ½æ˜¯åœ¨æ“ä½œè¿™äº›å¯„å­˜å™¨å®ŒæˆæŒ‡ä»¤åŠŸèƒ½ã€‚â€œé€šç”¨â€æŒ‡çš„æ˜¯è¿™äº›å¯„å­˜å™¨æ²¡æœ‰ç‰¹æ®Šçš„ç”¨é€”ï¼Œå¯ä»¥äº¤ç»™ç¨‹åº<strong>æŒ‰ç…§ä¸€å®šçš„è§„åˆ™</strong>ï¼ˆé€šç”¨ä¸æ˜¯ä¹±ç”¨ï¼‰å»ä½¿ç”¨ã€‚</p>
<table>
<thead>
<tr>
<th>å¯„å­˜å™¨</th>
<th>Callee Save</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>%rax(Accumulator)</td>
<td></td>
<td>ç»“æœå¯„å­˜å™¨ï¼Œé€šå¸¸ç”¨æ‰§è¡ŒåŠ æ³•ï¼Œå­˜å‚¨å‡½æ•°è°ƒç”¨çš„è¿”å›å€¼ï¼Œä¹Ÿä¼šç”¨äº<code>idiv</code>å’Œ<code>imul</code>æŒ‡ä»¤</td>
</tr>
<tr>
<td>%rbx</td>
<td>æ˜¯</td>
<td>miscellaneous register</td>
</tr>
<tr>
<td>%rdi, %rsi, %rdx, %rcx, %r8, %r9</td>
<td></td>
<td>ç”¨ä½œä¼ é€’æ•´å‹æˆ–æŒ‡é’ˆå‚æ•°åˆ°è¢«è°ƒç”¨å‡½æ•°ï¼Œä¾æ¬¡å¯¹åº”ç¬¬1ä¸ªå‚æ•°ã€ç¬¬2ä¸ªå‚æ•° â€¦ã€‚rdxä¹Ÿä¼šç”¨äº<code>idiv</code>å’Œ<code>imul</code> æŒ‡ä»¤</td>
</tr>
<tr>
<td>%rsp(Stack Pointer)</td>
<td></td>
<td>æ ˆæŒ‡é’ˆå¯„å­˜å™¨ï¼Œé€šå¸¸ä¼šæŒ‡å‘æ ˆé¡¶ä½ç½®ï¼Œå †æ ˆçš„popå’Œpushæ“ä½œå°±æ˜¯é€šè¿‡æ”¹å˜rspçš„å€¼å³ç§»åŠ¨å †æ ˆæŒ‡é’ˆçš„ä½ç½®æ¥å®ç°çš„</td>
</tr>
<tr>
<td>%rbp(Base Pointer)</td>
<td>æ˜¯</td>
<td>æ ˆåº•æŒ‡é’ˆï¼Œç”¨äºæ ‡è¯†å½“å‰æ ˆå¸§çš„èµ·å§‹ä½ç½®ï¼Œé€šå¸¸ç”¨rbp+åç§»é‡æ¥å­˜å–å‡½æ•°æ ˆä¸­çš„å±€éƒ¨å˜é‡</td>
</tr>
<tr>
<td>%r10, %r11</td>
<td></td>
<td>miscellaneous registers</td>
</tr>
<tr>
<td>%r12, %r13, %r14, %r15</td>
<td>æ˜¯</td>
<td>miscellaneous registers</td>
</tr>
</tbody></table>
<p>ä»ä¸Šè¡¨æˆ‘ä»¬å¯ä»¥è¿˜å¾—å‡ºå¦‚ä¸‹ç»“è®º</p>
<ol>
<li>æ¯ä¸ªå¯„å­˜å™¨çš„ç”¨é€”å¹¶ä¸æ˜¯å•ä¸€çš„</li>
<li>åœ¨<code>imul</code>æŒ‡ä»¤ä¸­ï¼Œä¸¤ä¸ª64ä½çš„ä¹˜æ³•æœ€å¤šä¼šäº§ç”Ÿ128ä½çš„ç»“æœï¼Œä¹˜æ³•ç»“æœéœ€è¦<code>%rdx</code>å­˜å‚¨é«˜64ä½<code>%rax</code>å­˜å‚¨ä½64ä½ï¼›åœ¨<code>idiv</code>æŒ‡ä»¤ä¸­è¢«é™¤æ•°æ˜¯128ä½çš„ï¼ŒåŒæ ·éœ€è¦<code>%rax</code>å’Œ<code>%rdx</code>å…±åŒå­˜å‚¨è¢«é™¤æ•°</li>
<li>è¢«æ ‡è¯†ä¸ºâ€miscellaneousâ€çš„å¯„å­˜å™¨å±äºé€šç”¨æ€§æ›´å¹¿æ³›çš„å¯„å­˜å™¨ï¼Œç¼–è¯‘å™¨å¯ä»¥æ ¹æ®éœ€è¦å­˜å‚¨ä»»ä½•æ•°æ®</li>
</ol>
<p><code>Caller Save</code>å’Œ<code>Callee Save</code>çš„åŒºåˆ«åœ¨äºå¯„å­˜å™¨çš„å€¼æ˜¯ç”±<code>è°ƒç”¨è€…è´Ÿè´£ä¿å­˜</code>è¿˜æ˜¯<code>è¢«è°ƒç”¨è€…è´Ÿè´£ä¿å­˜</code>ã€‚å½“äº§ç”Ÿå‡½æ•°è°ƒç”¨æ—¶ï¼Œå­å‡½æ•°å†…ä¹Ÿä¼šä½¿ç”¨åˆ°é€šç”¨å¯„å­˜å™¨è¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œæ­¤æ—¶è¿™äº›å¯„å­˜å™¨ä¸­ä¹‹å‰ä¿å­˜çš„çˆ¶å‡½æ•°çš„å€¼å°±ä¼šè¢«è¦†ç›–ã€‚ä¸ºäº†é¿å…æ•°æ®è¦†ç›–å¯¼è‡´å‡½æ•°è¿”å›æ—¶å¯„å­˜å™¨çš„æ•°æ®æ— æ³•æ¢å¤ï¼ŒCPUä½“ç³»ç»“æ„ä¸­å°±è§„å®šäº†é€šç”¨å¯„å­˜å™¨çš„ä¿å­˜æ–¹å¼ã€‚</p>
<p>å¦‚æœä¸€ä¸ªå¯„å­˜å™¨è¢«æ ‡è¯†ä¸º<code>Caller Save</code>ï¼Œé‚£ä¹ˆåœ¨è¿›è¡Œå­å‡½æ•°è°ƒç”¨å‰ï¼Œå°±éœ€è¦ç”±è°ƒç”¨è€…æå‰ä¿å­˜å¥½è¿™äº›å¯„å­˜å™¨çš„å€¼ï¼Œä¿å­˜æ–¹æ³•é€šå¸¸æ˜¯æŠŠå¯„å­˜å™¨çš„å€¼pushåˆ°å †æ ˆä¸­ï¼Œè°ƒç”¨è€…ä¿å­˜å®Œæˆåï¼Œåœ¨å­å‡½æ•°ä¸­å°±å¯ä»¥éšæ„è¦†ç›–è¿™äº›å¯„å­˜å™¨çš„å€¼äº†ã€‚å¦‚æœä¸€ä¸ªå¯„å­˜å™¨è¢«æ ‡è¯†ä¸º<code>Callee Save</code>ï¼Œé‚£ä¹ˆåœ¨å‡½æ•°è°ƒç”¨æ—¶ï¼Œè°ƒç”¨è€…å°±ä¸å¿…ä¿å­˜è¿™äº›å¯„å­˜å™¨çš„å€¼è€Œç›´æ¥è¿›è¡Œå­å‡½æ•°è°ƒç”¨ï¼Œè¿›å…¥å­å‡½æ•°åï¼Œå­å‡½æ•°åœ¨è¦†ç›–è¿™äº›å¯„å­˜å™¨ä¹‹å‰ï¼Œéœ€è¦å…ˆä¿å­˜è¿™äº›å¯„å­˜å™¨çš„å€¼ï¼Œå³è¿™äº›å¯„å­˜å™¨çš„å€¼æ˜¯ç”±è¢«è°ƒç”¨è€…æ¥ä¿å­˜å’Œæ¢å¤çš„ã€‚</p><button type="button" class="tab-to-top" onclick="scrollToDest($(this).parents('.tabs'),65)"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯„å­˜å™¨-2"><p>ç”¨é‡Œé¢çš„ä¸€ä¸ªä¸€ä¸ªæ ‡è®°bitä½ï¼Œå­˜æ”¾CPUè¿›è¡Œç®—æœ¯æˆ–é€»è¾‘è®¡ç®—çš„ç»“æœï¼Œè¿™äº›æ ‡å¿—å¤§å¤šç”±CPUè‡ªåŠ¨è®¾ç½®å’Œä¿®æ”¹</p>
<ul>
<li>é›¶æ ‡å¿—(Zero Flag)ï¼šå¦‚æœè¿ç®—ç»“æœä¸º0ï¼ŒZF=1ï¼Œå¦åˆ™ZF=0</li>
<li>ç¬¦å·æ ‡å¿—(Sign Flag)ï¼šä¸è¿ç®—ç»“æœçš„æœ€é«˜ä½bitå€¼ä¸€è‡´</li>
<li>è¿›ä½æ ‡å¿—(Carry Flag)ï¼šåœ¨æ— ç¬¦å·è¿ç®—æ—¶ï¼Œè®°å½•äº†è¿ç®—ç»“æœçš„æœ€é«˜æœ‰æ•ˆä½å‘æ›´é«˜ä½çš„è¿›ä½å€¼æˆ–ä»æ›´é«˜ä½å€Ÿä½ï¼Œäº§ç”Ÿè¿›ä½æˆ–å€Ÿä½æ—¶CF=1ï¼Œå¦åˆ™CF=0</li>
<li>æº¢å‡ºæ ‡å¿—(Overflow Flag)ï¼šæœ‰ç¬¦å·è¿ç®—çš„ç»“æœæ˜¯å¦å‘ç”Ÿäº†æº¢å‡ºï¼Œå¦‚æœå‘ç”Ÿæº¢å‡ºOF=1,å¦‚æœæ²¡æœ‰OF=0ã€‚æ­£æ•°+æ­£æ•°ï¼Œè´Ÿæ•°+è´Ÿæ•°æœ‰å¯èƒ½å‘ç”Ÿæº¢å‡ºï¼›æ­£æ•°-æ­£æ•°ä¸å¯èƒ½å‘ç”Ÿæº¢å‡º</li>
<li>å¥‡å¶æ ‡å¿—(Parity Flag)ï¼šå¦‚æœè¿ç®—ç»“æœbitä½ä¸­æœ‰å¶æ•°ä¸ª1ï¼Œåˆ™å…¶å€¼ä¸º1ï¼Œå¦åˆ™å…¶å€¼ä¸º0ã€‚æ­¤æŒ‡ä»¤ä¸»è¦ç”¨äºæ£€æŸ¥æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦äº§ç”Ÿé”™è¯¯ï¼Œæ¯”å¦‚å…¸å‹çš„<a target="_blank" rel="external nofollow noopener noreferrer" href="https://en.wikipedia.org/wiki/Parity_bit">å¥‡å¶æ ¡éªŒ</a></li>
</ul>
<blockquote>
<p>CFå’ŒOFçš„åŒºåˆ«ï¼šCFæ˜¯å¯¹æ— ç¬¦å·æ•°è¿ç®—æœ‰æ„ä¹‰çš„æ ‡å¿—ä½ï¼Œè€ŒOFæ˜¯å¯¹æœ‰ç¬¦å·æ•°è¿ç®—æœ‰æ„ä¹‰çš„æ ‡å¿—ä½ã€‚æ¯”å¦‚ï¼šmov al, $7F; add al $01ã€‚addæŒ‡ä»¤æ‰§è¡ŒåCF=0ï¼ŒOF=1ã€‚</p>
</blockquote>
<p>ä¸¾å‡ ä¸ªğŸŒ°</p>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line">              <span class="built_in">al</span>                 CF    OF    SF    ZF    PF</span><br><span class="line"><span class="keyword">sub</span> <span class="built_in">al</span>,<span class="built_in">al</span>     <span class="number">0x00</span>/<span class="number">0000</span> <span class="number">0000</span>     <span class="number">0</span>     <span class="number">0</span>     <span class="number">0</span>     <span class="number">1</span>     <span class="number">1</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">al</span>,<span class="number">10h</span>    <span class="number">0x10</span>/<span class="number">0001</span> <span class="number">0000</span>     <span class="number">0</span>     <span class="number">0</span>     <span class="number">0</span>     <span class="number">1</span>     <span class="number">1</span>  <span class="comment">; movä¸ä¼šæ”¹å˜ä»»ä½•æ ‡å¿—å¯„å­˜å™¨çš„å€¼</span></span><br><span class="line"><span class="keyword">add</span> <span class="built_in">al</span>,<span class="number">90h</span>    <span class="number">0xa0</span>/<span class="number">1010</span> <span class="number">0000</span>     <span class="number">0</span>     <span class="number">0</span>     <span class="number">1</span>     <span class="number">0</span>     <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">al</span>,<span class="number">80h</span>    <span class="number">0x80</span>/<span class="number">1000</span> <span class="number">0000</span>     <span class="number">0</span>     <span class="number">0</span>     <span class="number">1</span>     <span class="number">0</span>     <span class="number">1</span></span><br><span class="line"><span class="keyword">add</span> <span class="built_in">al</span>,<span class="number">80h</span>    <span class="number">0x00</span>/<span class="number">0000</span> <span class="number">0000</span>     <span class="number">1</span>     <span class="number">1</span>     <span class="number">0</span>     <span class="number">0</span>     <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">al</span>,<span class="number">fch</span>    <span class="number">0xfc</span>/<span class="number">1111</span> <span class="number">1100</span>     <span class="number">1</span>     <span class="number">1</span>     <span class="number">0</span>     <span class="number">0</span>     <span class="number">1</span></span><br><span class="line"><span class="keyword">add</span> <span class="built_in">al</span>,<span class="number">05h</span>    <span class="number">0x01</span>/<span class="number">0000</span> <span class="number">0001</span>     <span class="number">1</span>     <span class="number">0</span>     <span class="number">0</span>     <span class="number">0</span>     <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">al</span>,<span class="number">7dh</span>    <span class="number">0x7d</span>/<span class="number">0111</span> <span class="number">1101</span>     <span class="number">1</span>     <span class="number">0</span>     <span class="number">0</span>     <span class="number">0</span>     <span class="number">0</span></span><br><span class="line"><span class="keyword">add</span> <span class="built_in">al</span>,<span class="number">0bh</span>    <span class="number">0x88</span>/<span class="number">1000</span> <span class="number">1000</span>     <span class="number">0</span>     <span class="number">1</span>     <span class="number">1</span>     <span class="number">0</span>     <span class="number">1</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" onclick="scrollToDest($(this).parents('.tabs'),65)"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯„å­˜å™¨-3"><ul>
<li>%rip(Instruction Pointer)ï¼šæŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ï¼Œåˆå«PC(Program Counter)ï¼Œå­˜æ”¾ä¸‹ä¸€æ¡å¾…æ‰§è¡ŒæŒ‡ä»¤çš„å†…å­˜åœ°å€ã€‚CPUçš„å·¥ä½œå…¶å®å°±æ˜¯ä¸æ–­å–å‡ºå®ƒæŒ‡å‘çš„æŒ‡ä»¤ï¼Œç„¶åæ‰§è¡Œè¿™æ¡æŒ‡ä»¤ã€‚</li>
</ul><button type="button" class="tab-to-top" onclick="scrollToDest($(this).parents('.tabs'),65)"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="å¯„å­˜å™¨-4"><p><img src="https://cdn.leosocy.top/img/dinosaurloading.gif" data-lazy-src="https://cdn.leosocy.top/img/20201128172252.png"></p>
<ul>
<li>CR0ï¼šå­˜å‚¨äº†CPUæ§åˆ¶æ ‡è®°å’Œå·¥ä½œçŠ¶æ€ã€‚ä¸€äº›é‡è¦çš„æ ‡å¿—ä½å«ä¹‰å¦‚ä¸‹ï¼š<ul>
<li>PE(Protected Mode Enable)ï¼š1ä»£è¡¨ç³»ç»Ÿè¿è¡Œåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ï¼Œå¦åˆ™ä¸ºå®æ¨¡å¼</li>
<li>WP(Write Protect)ï¼šæ˜¯å¦å¼€å¯å†…å­˜å†™ä¿æŠ¤ï¼Œè‹¥å¼€å¯ï¼Œå¯¹åªè¯»é¡µé¢è¿›è¡Œå†™å…¥ä¼šè§¦å‘å¼‚å¸¸ï¼Œè¿™ä¸€æœºåˆ¶å¸¸å¸¸è¢«ç”¨äºå®ç°<a href="https://blog.leosocy.top/posts/6d47">å†™æ—¶å¤åˆ¶COW</a>åŠŸèƒ½</li>
<li>AM(Alignment Mask)ï¼šæ˜¯å¦å¯ç”¨å†…å­˜å¯¹é½è‡ªåŠ¨æ£€æŸ¥</li>
<li>CD(Cache Disable)ï¼š1ä»£è¡¨å…³é—­cache</li>
<li>PG(Paging)ï¼š1ä»£è¡¨å¯ç”¨å†…å­˜åˆ†é¡µï¼ŒåŒæ—¶ä½¿ç”¨CR3å¯„å­˜å™¨ï¼Œå¦åˆ™ä¸å¼€å¯å†…å­˜åˆ†é¡µ</li>
</ul>
</li>
<li>CR1ï¼šä¿ç•™ï¼Œè®¿é—®å®ƒä¼šå¯¼è‡´CPUæŠ›å‡ºæœªå®šä¹‰å¼‚å¸¸</li>
<li>CR2ï¼šå‘ç”Ÿç¼ºé¡µå¼‚å¸¸æ—¶ä¿å­˜å¯¼è‡´å¼‚å¸¸çš„è®¿é—®åœ°å€</li>
<li>CR3ï¼šç”¨äºå­˜å‚¨é¡µç›®å½•çš„ç‰©ç†å†…å­˜åŸºåœ°å€ï¼Œæ¯”å¦‚Linux 64ä½ä¸­å­˜å‚¨PGDçš„ç‰©ç†åœ°å€ï¼Œåœ¨è¿›ç¨‹ç©ºé—´åˆ‡æ¢æ—¶ï¼ŒCR3ä¹Ÿè¦åŒæ­¥åˆ‡æ¢</li>
<li>CR4ï¼šåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ä½¿ç”¨ï¼Œå­˜å‚¨äº†CPUå·¥ä½œç›¸å…³ä»¥åŠå½“å‰ä»»åŠ¡çš„ä¸€äº›ä¿¡æ¯</li>
</ul><button type="button" class="tab-to-top" onclick="scrollToDest($(this).parents('.tabs'),65)"><i class="fas fa-arrow-up"></i></button></div></div></div>

<h3 id="CPUæŒ‡ä»¤"><a href="#CPUæŒ‡ä»¤" class="headerlink" title="CPUæŒ‡ä»¤"></a>CPUæŒ‡ä»¤</h3><h4 id="æŒ‡ä»¤åˆ†ç±»"><a href="#æŒ‡ä»¤åˆ†ç±»" class="headerlink" title="æŒ‡ä»¤åˆ†ç±»"></a>æŒ‡ä»¤åˆ†ç±»</h4><table>
<thead>
<tr>
<th>æŒ‡ä»¤ç±»å‹</th>
<th>ç¤ºä¾‹</th>
<th>ç¤ºä¾‹æ±‡ç¼–ä»£ç </th>
<th>å«ä¹‰</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td>ç®—æœ¯ç±»æŒ‡ä»¤</td>
<td>add</td>
<td>add $s1,$s2,$s3</td>
<td>$s1=$s2+$s3</td>
<td>å°†å¯„å­˜å™¨r2å’Œr3ä¸­çš„æ•°å€¼ç›¸åŠ åçš„ç»“æœæ”¾åˆ°å¯„å­˜å™¨r1ä¸­</td>
</tr>
<tr>
<td>æ•°æ®ä¼ è¾“ç±»æŒ‡ä»¤</td>
<td>load word</td>
<td>load $s1,10($s2)</td>
<td>$s1=memory[$s2+10]</td>
<td>å–å¯„å­˜å™¨r2ä¸­çš„æ•°ï¼ŒåŠ ä¸Š10å­—èŠ‚åç§»åï¼Œå–å‡ºå†…å­˜ä¸­å¯¹åº”çš„å­—(WORD ä¸€èˆ¬ä¸º4å­—èŠ‚)ï¼Œå­˜å…¥r1å¯„å­˜å™¨ä¸­</td>
</tr>
<tr>
<td>é€»è¾‘ç±»æŒ‡ä»¤</td>
<td>xor</td>
<td>xor $s1,$s2$s3</td>
<td>$s1=$s2 ^ $s3</td>
<td>å°†å¯„å­˜å™¨r2å’Œr3ä¸­çš„æ•°å€¼æŒ‰ä½å–å¼‚æˆ–åçš„ç»“æœæ”¾åˆ°å¯„å­˜å™¨r1ä¸­</td>
</tr>
<tr>
<td>æ¡ä»¶åˆ†æ”¯æŒ‡ä»¤</td>
<td>branch on equal</td>
<td>beq $s1,$s2,10</td>
<td>if($s1==$s2) go to PC+10</td>
<td>å¦‚æœr1å’Œr2å¯„å­˜å™¨å†…çš„å€¼ç›¸ç­‰ï¼Œä»ç¨‹åºè®¡æ•°å™¨å¾€åè·³10</td>
</tr>
<tr>
<td>æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤</td>
<td>jump</td>
<td>j 1000</td>
<td>go to 1000</td>
<td>è·³è½¬åˆ°1000è¿™ä¸ªç›®æ ‡åœ°å€</td>
</tr>
</tbody></table>
<h4 id="æœºå™¨ç çš„ç”Ÿæˆ"><a href="#æœºå™¨ç çš„ç”Ÿæˆ" class="headerlink" title="æœºå™¨ç çš„ç”Ÿæˆ"></a>æœºå™¨ç çš„ç”Ÿæˆ</h4><p>ä»¥æœ€ç®€å•çš„<code>MIPS32</code>æŒ‡ä»¤é›†ä¸ºä¾‹<br><img src="https://cdn.leosocy.top/img/dinosaurloading.gif" data-lazy-src="https://cdn.leosocy.top/img/20201117200420.png"></p>
<blockquote>
<p>RæŒ‡ä»¤ï¼šç”¨ä½œç®—æœ¯å’Œé€»è¾‘è¿ç®—ï¼Œrs/rtä¸ºè¯»å–æ•°æ®å¯„å­˜å™¨ï¼Œrdä¸ºå†™å…¥æ•°æ®å¯„å­˜å™¨ã€‚å¦‚æœæ˜¯é€»è¾‘ä½ç§»æ“ä½œï¼Œåˆ™å¯¹rs/rtä¸­çš„æ•°æ®æ ¹æ®ä½ç§»é‡åšä½ç§»æ“ä½œï¼Œç„¶åå†™å…¥rdå¯„å­˜å™¨ï¼›å¦åˆ™åç§»é‡ä¸º00000ã€‚æœ€åçš„åŠŸèƒ½ç ï¼Œåˆ™æ˜¯åœ¨å‰é¢çš„æ“ä½œç ä¸å¤Ÿçš„æ—¶å€™ï¼Œæ‰©å±•æ“ä½œç è¡¨ç¤ºå¯¹åº”çš„å…·ä½“æŒ‡ä»¤çš„ã€‚æ¯”å¦‚<code>add</code>å’Œ<code>xor</code>çš„opcodeéƒ½æ˜¯<code>000000</code>ï¼Œè€Œ<code>add</code>çš„åŠŸèƒ½ç ä¸º<code>100000</code>ï¼Œ<code>xor</code>çš„åŠŸèƒ½ç ä¸º<code>100110</code></p>
</blockquote>
<blockquote>
<p>IæŒ‡ä»¤ï¼šç”¨ä½œæ•°æ®ä¼ è¾“å’Œæ¡ä»¶åˆ†æ”¯ï¼Œä»¥åŠåœ¨è¿ç®—æ—¶ä½¿ç”¨çš„å¹¶éå˜é‡è€Œæ˜¯å¸¸æ•°ã€‚æ­¤æ—¶æ²¡æœ‰ç¬¬ä¸‰ä¸ªå¯„å­˜å™¨ã€åç§»é‡ä»¥åŠåŠŸèƒ½ç ï¼Œè¿™ä¸‰éƒ¨åˆ†è¢«åˆæˆäº†ä¸€ä¸ª16Bitçš„<em>åœ°å€å€¼</em>æˆ–<em>å¸¸æ•°</em></p>
</blockquote>
<blockquote>
<p>JæŒ‡ä»¤ï¼šç”¨ä½œè·³è½¬ï¼Œé™¤opcodeå¤–çš„26Bitéƒ½æ˜¯ä¸€ä¸ªè·³è½¬åçš„åœ°å€</p>
</blockquote>
<p>ä¸‹é¢ç”¨ä¸€ä¸ªç®€å•çš„å¼‚æˆ–æŒ‡ä»¤ä¸ºä¾‹ï¼Œçœ‹çœ‹ä¸€ä¸ªæœºå™¨ç å¦‚ä½•ç”Ÿæˆ</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">xor $t0,$s2,$s1</span><br><span class="line"></span><br><span class="line">ï¼ˆä¸ºäº†æ–¹ä¾¿ï¼Œä¸‹é¢çš„æ•°å­—éƒ½ç”¨10è¿›åˆ¶è¡¨ç¤ºï¼‰å¯¹åº”MIPS32æŒ‡ä»¤é‡Œï¼Œopcodeä¸º0ï¼Œrsä»£è¡¨ç¬¬ä¸€ä¸ªå¯„å­˜å™¨s1ï¼Œåœ°å€æ˜¯17ï¼Œrtä»£è¡¨ç¬¬äºŒä¸ªå¯„å­˜å™¨s2ï¼Œåœ°å€æ˜¯18ï¼Œrdä»£è¡¨ç›®æ ‡çš„ä¸´æ—¶å¯„å­˜å™¨t0ï¼Œåœ°å€æ˜¯8ã€‚å› ä¸ºä¸æ˜¯ä½ç§»æ“ä½œï¼Œæ‰€ä»¥åç§»é‡æ˜¯0ã€‚åŠŸèƒ½ç é€šè¿‡æŸ¥è¡¨å¾—åˆ°äºŒè¿›åˆ¶ä¸º&#x27;100110&#x27;ã€‚</span><br><span class="line"></span><br><span class="line">| opcode |   rs  |   rt  |   rd  | shamt | funct  |</span><br><span class="line">| 000000 | 10001 | 10010 | 01000 | 00000 | 100110 |</span><br><span class="line"></span><br><span class="line">2è¿›åˆ¶è¡¨ç¤ºä¸ºï¼š0000 0010 0011 0010 0100 0000 0010 0110</span><br><span class="line">16è¿›åˆ¶è¡¨ç¤ºä¸ºï¼š 0x02324026</span><br></pre></td></tr></table></figure>

<h4 id="æŒ‡ä»¤è·³è½¬"><a href="#æŒ‡ä»¤è·³è½¬" class="headerlink" title="æŒ‡ä»¤è·³è½¬"></a>æŒ‡ä»¤è·³è½¬</h4><p>CPUå¦‚ä½•æ‰§è¡ŒæŒ‡ä»¤çš„ï¼Ÿ</p>
<p>ç¨‹åºæ‰§è¡Œæ—¶ï¼ŒCPUä¼šæ ¹æ®PCå¯„å­˜å™¨ä¸­çš„æŒ‡ä»¤å†…å­˜åœ°å€ï¼Œä»å†…å­˜é‡ŒæŠŠéœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤è¯»å–åˆ°æŒ‡ä»¤å¯„å­˜å™¨é‡Œé¢æ‰§è¡Œï¼Œç„¶åæ ¹æ®æŒ‡ä»¤é•¿åº¦è‡ªå¢ï¼Œå¼€å§‹é¡ºåºè¯»å–ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œè¿™å°±è¦æ±‚æŒ‡ä»¤å¿…é¡»æ˜¯è¿ç»­å­˜å‚¨åœ¨å†…å­˜ç©ºé—´ä¸­çš„ã€‚</p>
<p>è€Œæœ‰äº›ç‰¹æ®Šçš„æŒ‡ä»¤ï¼Œæ¯”å¦‚<a href="#%E6%9C%BA%E5%99%A8%E7%A0%81%E7%9A%84%E7%94%9F%E6%88%90">ä¸Šä¸€å°èŠ‚</a>æåˆ°çš„JæŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯è·³è½¬æŒ‡ä»¤ï¼Œä¼šä¿®æ”¹PCå¯„å­˜å™¨é‡Œé¢çš„æŒ‡ä»¤å†…å­˜åœ°å€çš„å€¼ã€‚è¿™æ ·ä¸‹ä¸€æ¡è¦æ‰§è¡Œçš„æŒ‡ä»¤å°±ä¸æ˜¯é¡ºåºåŠ è½½çš„äº†ã€‚æ­£æ˜¯å› ä¸ºæœ‰äº†è·³è½¬æŒ‡ä»¤ï¼Œæˆ‘ä»¬æ‰å¯ä»¥åœ¨ç¨‹åºä¸­ä½¿ç”¨<code>if...else/switch...case</code>æ¡ä»¶è¯­å¥å’Œ<code>while/for</code>å¾ªç¯è¯­å¥ã€‚</p>
<blockquote>
<p>æ³¨ï¼šæœ¬èŠ‚æ±‡ç¼–ä»£ç ä½¿ç”¨çš„ç¼–è¯‘å™¨ç‰ˆæœ¬ä¸ºï¼š<code>Apple clang version 11.0.3 (clang-1103.0.32.59) </code></p>
</blockquote>
<h5 id="ifâ€¦else-goto"><a href="#ifâ€¦else-goto" class="headerlink" title="ifâ€¦else + goto"></a>ifâ€¦else + goto</h5><p><code>goto</code>å±äºæŒ‡ä»¤è·³è½¬æœ€ç®€å•çš„ä½¿ç”¨åœºæ™¯ã€‚<code>if else</code>é€šè¿‡<code>jne+jmp</code>å®ç°åˆ†æ”¯è·³è½¬ã€‚</p>
<div class="tabs" id="ifelse"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#ifelse-1">æ±‡ç¼–ä»£ç </button></li><li class="tab"><button type="button" data-href="#ifelse-2">Cä»£ç </button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="ifelse-1"><figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line"><span class="comment">; int main() &#123;</span></span><br><span class="line"> <span class="number">0</span>: <span class="number">55</span>                      pushq   %rbp            <span class="comment">; å°†çˆ¶å‡½æ•°æ ˆå¸§çš„èµ·å§‹åœ°å€å‹å…¥æ ˆé¡¶ï¼Œå³å½“å‰å‡½æ•°æ ˆå¸§</span></span><br><span class="line"> <span class="number">1</span>: <span class="number">48</span> <span class="number">89</span> e5                <span class="keyword">movq</span>    %rsp, %rbp      <span class="comment">; å°†æ ˆæŒ‡é’ˆçš„å€¼å¤åˆ¶åˆ°rbpé‡Œï¼Œè€Œrspå§‹ç»ˆä¼šæŒ‡å‘æ ˆé¡¶</span></span><br><span class="line"> <span class="number">4</span>: <span class="number">48</span> <span class="number">83</span> ec <span class="number">10</span>             subq    <span class="number">$16</span>, %rsp       <span class="comment">; æ ˆé¡¶å‘ä¸‹æ‰©å±•16ä¸ªå­—èŠ‚ï¼ˆæ ˆæ˜¯ä»é«˜åœ°å€å‘ä½åœ°å€ç”Ÿé•¿çš„ï¼‰ï¼Œç”¨äºåœ¨å‘ç”Ÿå‡½æ•°è°ƒç”¨æ—¶ï¼Œå­˜å‚¨å½“å‰å‡½æ•°å†…çš„å±€éƒ¨å˜é‡</span></span><br><span class="line"> <span class="number">8</span>: <span class="number">31</span> c0                   xorl    %eax, %eax      <span class="comment">; raxçš„ä½4å­—èŠ‚ç½®0</span></span><br><span class="line"><span class="symbol"> a:</span> <span class="number">89</span> c7                   movl    %eax, %edi      <span class="comment">; å°†raxçš„ä½4å­—èŠ‚ï¼ˆå³0ï¼‰å¤åˆ¶åˆ°rdiå¯„å­˜å™¨çš„ä½4å­—èŠ‚ã€‚[å¯„å­˜å™¨](#å¯„å­˜å™¨)ä¸€èŠ‚æœ‰å­¦åˆ°rdiæ˜¯ç”¨äºå­˜å‚¨å‡½æ•°è°ƒç”¨çš„ç¬¬1ä¸ªå‚æ•°å€¼</span></span><br><span class="line"><span class="symbol"> c:</span> c7 <span class="number">45</span> fc <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    movl    <span class="number">$0</span>, -<span class="number">4</span>(%rbp)    <span class="comment">; å°†[rbp-4, rbp]å†…å­˜ç©ºé—´ç½®0ï¼Œæš‚æ—¶ä¸çŸ¥é“ç”¨å¤„</span></span><br><span class="line"><span class="comment">;  srand(time(NULL));</span></span><br><span class="line"><span class="number">13</span>: e8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          callq   <span class="number">0</span> &lt;_main+<span class="number">0x18</span>&gt;  <span class="comment">; è°ƒç”¨timeå‡½æ•°ï¼Œå‚æ•°çš„å€¼å­˜åœ¨ediå¯„å­˜å™¨ï¼Œå³0(NULL)</span></span><br><span class="line"><span class="number">18</span>: <span class="number">89</span> c7                   movl    %eax, %edi      <span class="comment">; å°†timeå‡½æ•°çš„è¿”å›å€¼å¤åˆ¶åˆ°rdiå¯„å­˜å™¨çš„ä½4å­—èŠ‚ï¼Œä½œä¸ºsrandå‡½æ•°çš„ç¬¬1ä¸ªå‚æ•°</span></span><br><span class="line">1a: e8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          callq   <span class="number">0</span> &lt;_main+<span class="number">0x1f</span>&gt;  <span class="comment">; è°ƒç”¨srandå‡½æ•°</span></span><br><span class="line"><span class="comment">;  int r = rand() % 2;</span></span><br><span class="line">1f: e8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          callq   <span class="number">0</span> &lt;_main+<span class="number">0x24</span>&gt;  <span class="comment">; è°ƒç”¨randå‡½æ•°ï¼Œè¿”å›å€¼å­˜åˆ°raxæŒ‡é’ˆ</span></span><br><span class="line"><span class="number">24</span>: <span class="number">99</span>                      cltd                    <span class="comment">; å°†eaxå¯„å­˜å™¨çš„å€¼ç¬¦å·æ‰©å±•32ä½åˆ°%edxå¯„å­˜å™¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœeaxå¯„å­˜å™¨çš„äºŒè¿›åˆ¶åºåˆ—çš„æœ€é«˜ä½ä¸º0ï¼Œåˆ™cltdæŒ‡ä»¤å°†æŠŠedxç½®ä¸º32ä¸ª0ï¼Œç›¸åï¼Œå¦‚æœ%eaxå¯„å­˜å™¨çš„äºŒè¿›åˆ¶åºåˆ—æœ€é«˜ä½ä¸º1ï¼Œåˆ™cltdæŒ‡ä»¤å°†ä¼šè‡ªä»å¡«å……edxå¯„å­˜å™¨ä¸º32ä¸ª1</span></span><br><span class="line"><span class="number">25</span>: b9 <span class="number">02</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          movl    <span class="number">$2</span>, %ecx        <span class="comment">; å°†rcxçš„ä½4å­—èŠ‚å€¼ç½®ä¸º2</span></span><br><span class="line">2a: f7 f9                   idivl   %ecx            <span class="comment">; å°†edxï¼ˆé«˜32ä½å’Œeaxï¼ˆä½32ä½ï¼‰ä¸­çš„64ä½æ•°ä½œä¸ºè¢«é™¤æ•°ï¼Œecxå€¼ä½œä¸ºé™¤æ•°ã€‚æŒ‡ä»¤å°†å•†å­˜å‚¨åœ¨eaxä¸­ï¼Œä½™æ•°å­˜å‚¨åœ¨edxä¸­ã€‚</span></span><br><span class="line">2c: <span class="number">89</span> <span class="number">55</span> f8                movl    %edx, -<span class="number">8</span>(%rbp)  <span class="comment">; å°†edxä¸­å­˜å‚¨çš„ä½™æ•°çš„å€¼å¤åˆ¶åˆ°[rbp-8, rpb-4]å†…å­˜ç©ºé—´ï¼Œå³å˜é‡rçš„æ ˆåœ°å€</span></span><br><span class="line"><span class="comment">;  if (r == 0) &#123;</span></span><br><span class="line">2f: <span class="number">83</span> <span class="number">7d</span> f8 <span class="number">00</span>             cmpl    <span class="number">$0</span>, -<span class="number">8</span>(%rbp)    <span class="comment">; åˆ¤æ–­rçš„å€¼æ˜¯å¦ä¸º0ï¼Œå¹¶æ ¹æ®ç»“æœæ›´æ–°ZF/OF/SFæ ‡å¿—å¯„å­˜å™¨ï¼Œå¦‚æœr==0ï¼Œåˆ™ZF=1</span></span><br><span class="line"><span class="number">33</span>: 0f <span class="number">85</span> <span class="number">05</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       <span class="keyword">jne</span>     <span class="number">5</span> &lt;_main+<span class="number">0x3e</span>&gt;  <span class="comment">; Jump if not equalï¼Œå³å½“ZF!=1æ—¶ï¼Œå°†PCå¯„å­˜å™¨å€¼æ”¹ä¸º0x3e</span></span><br><span class="line"><span class="comment">;      goto label1;</span></span><br><span class="line"><span class="number">39</span>: e9 <span class="number">05</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">jmp</span>     <span class="number">5</span> &lt;_main+<span class="number">0x43</span>&gt;  <span class="comment">; å¦‚æœr==0ï¼Œå°†PCå¯„å­˜å™¨å€¼æ”¹ä¸º0x43</span></span><br><span class="line"><span class="comment">;      goto label2;</span></span><br><span class="line">3e: e9 <span class="number">09</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">jmp</span>     <span class="number">9</span> &lt;_main+<span class="number">0x4c</span>&gt;  <span class="comment">; å°†PCå¯„å­˜å™¨å€¼æ”¹ä¸º0x4c</span></span><br><span class="line"><span class="comment">;  r += 1;</span></span><br><span class="line"><span class="number">43</span>: 8b <span class="number">45</span> f8                movl    -<span class="number">8</span>(%rbp), %eax  <span class="comment">; r==0ä¼šæ‰§è¡Œåˆ°è¿™ä¸€æ¡æŒ‡ä»¤ï¼Œå°†rçš„å€¼å¤åˆ¶åˆ°eaxå¯„å­˜å™¨</span></span><br><span class="line"><span class="number">46</span>: <span class="number">83</span> c0 <span class="number">01</span>                addl    <span class="number">$1</span>, %eax        <span class="comment">; eaxå¯„å­˜å™¨ç´¯åŠ 1</span></span><br><span class="line"><span class="number">49</span>: <span class="number">89</span> <span class="number">45</span> f8                movl    %eax, -<span class="number">8</span>(%rbp)  <span class="comment">; å°†eaxçš„å€¼å¤åˆ¶åˆ°å˜é‡rçš„æ ˆåœ°å€ç©ºé—´</span></span><br><span class="line"><span class="comment">;  r += 2;</span></span><br><span class="line">4c: 8b <span class="number">45</span> f8                movl    -<span class="number">8</span>(%rbp), %eax  <span class="comment">; å°†rçš„å€¼å¤åˆ¶åˆ°eaxå¯„å­˜å™¨</span></span><br><span class="line">4f: <span class="number">83</span> c0 <span class="number">02</span>                addl    <span class="number">$2</span>, %eax        <span class="comment">; eaxå¯„å­˜å™¨ç´¯åŠ 2</span></span><br><span class="line"><span class="number">52</span>: <span class="number">89</span> <span class="number">45</span> f8                movl    %eax, -<span class="number">8</span>(%rbp)  <span class="comment">; å°†eaxçš„å€¼å¤åˆ¶åˆ°å˜é‡rçš„æ ˆåœ°å€ç©ºé—´</span></span><br><span class="line"><span class="comment">;  return r;</span></span><br><span class="line"><span class="number">55</span>: 8b <span class="number">45</span> f8                movl    -<span class="number">8</span>(%rbp), %eax  <span class="comment">; å°†rçš„å€¼å¤åˆ¶åˆ°eaxå¯„å­˜å™¨ï¼Œä½œä¸ºå‡½æ•°çš„è¿”å›å€¼</span></span><br><span class="line"><span class="number">58</span>: <span class="number">48</span> <span class="number">83</span> c4 <span class="number">10</span>             addq    <span class="number">$16</span>, %rsp       <span class="comment">; æ ˆé¡¶å‘ä¸Šç¼©å‡16ä¸ªå­—èŠ‚ï¼Œå³æ¢å¤åˆšå¼€å§‹å¼€è¾Ÿçš„16å­—èŠ‚æ ˆå†…å­˜ç©ºé—´</span></span><br><span class="line">5c: <span class="number">5d</span>                      popq    %rbp            <span class="comment">; å°†çˆ¶å‡½æ•°æ ˆå¸§çš„èµ·å§‹åœ°å€æ¢å¤åˆ°rbpå¯„å­˜å™¨</span></span><br><span class="line"><span class="number">5d</span>: c3                      retq                    <span class="comment">; å¼¹å‡ºå½“å‰æ ˆé¡¶å…ƒç´ ï¼ˆå³çˆ¶å‡½æ•°æ‰§è¡ŒcallæŒ‡ä»¤æ—¶å‹å…¥çš„PCå¯„å­˜å™¨çš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€ï¼‰ï¼Œæ›´æ–°åˆ°PCå¯„å­˜å™¨ä¸­ï¼Œå°†ç¨‹åºæ§åˆ¶æƒè¿”å›åˆ°å‡ºæ ˆåçš„æ ˆé¡¶</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" onclick="scrollToDest($(this).parents('.tabs'),65)"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ifelse-2"><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    srand(time(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="type">int</span> r = rand() % <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (r == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">goto</span> label1;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">goto</span> label2;</span><br><span class="line">    &#125;</span><br><span class="line">label1:</span><br><span class="line">    r += <span class="number">1</span>;</span><br><span class="line">label2:</span><br><span class="line">    r += <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" onclick="scrollToDest($(this).parents('.tabs'),65)"><i class="fas fa-arrow-up"></i></button></div></div></div>

<h5 id="while-amp-for"><a href="#while-amp-for" class="headerlink" title="while &amp; for"></a>while &amp; for</h5><ul>
<li><code>for</code>ï¼š å…ˆç”¨<code>cmp+jg</code>åˆ¤æ–­æ˜¯å¦æ»¡è¶³ifæ¡ä»¶ï¼Œä¸æ»¡è¶³åˆ™è·³å‡ºå¾ªç¯ï¼Œå¦åˆ™æ‰§è¡Œifå†…ä»£ç ï¼Œæœ€åç”¨<code>jmp</code>å®ç°æ‰§è¡Œå®Œifå†…ä»£ç åè·³å›<code>cmp+jg</code></li>
<li><code>while</code>ï¼š å’Œforä¸€æ ·</li>
<li><code>do...while</code>ï¼š å…ˆæ‰§è¡Œdoå†…ä»£ç ï¼Œç„¶åç”¨<code>cmp+jle</code>åˆ¤æ–­æ˜¯å¦æ»¡è¶³whileæ¡ä»¶ï¼Œæ»¡è¶³åˆ™ç”¨<code>jmp</code>è·³å›doï¼Œå¦åˆ™ç»“æŸå¾ªç¯</li>
</ul>
<div class="tabs" id="while"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#while-1">æ±‡ç¼–ä»£ç </button></li><li class="tab"><button type="button" data-href="#while-2">Cä»£ç </button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="while-1"><figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line"><span class="comment">; int main() &#123;</span></span><br><span class="line"> <span class="number">0</span>: <span class="number">55</span>                      pushq   %rbp            </span><br><span class="line"> <span class="number">1</span>: <span class="number">48</span> <span class="number">89</span> e5                <span class="keyword">movq</span>    %rsp, %rbp</span><br><span class="line"> <span class="number">4</span>: c7 <span class="number">45</span> fc <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    movl    <span class="number">$0</span>, -<span class="number">4</span>(%rbp)      <span class="comment">; è¿™é‡Œå‘ç°äº†ä¸ªæœ‰æ„æ€çš„ç°è±¡ï¼Œç”±äºä»£ç é‡Œæ²¡æœ‰è°ƒç”¨å…¶ä»–å‡½æ•°ï¼Œæ‰€ä»¥æ²¡æœ‰æ‰©å±•æ ˆé¡¶çš„æŒ‡ä»¤ï¼Œå…·ä½“åŸå› ä¸‹é¢çš„[å‡½æ•°è°ƒç”¨åŠæ ˆå¸§](#å‡½æ•°è°ƒç”¨åŠæ ˆå¸§)ä¸€èŠ‚ä¼šåˆ†æ</span></span><br><span class="line"><span class="comment">;  int a = 1;</span></span><br><span class="line"><span class="symbol"> b:</span> c7 <span class="number">45</span> f8 <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    movl    <span class="number">$1</span>, -<span class="number">8</span>(%rbp)      <span class="comment">; å°†æ ˆåœ°å€[rbp-8, rpb-4]å†…å­˜ç©ºé—´ï¼Œå³å˜é‡aèµ‹å€¼ä¸º1</span></span><br><span class="line"><span class="comment">;  for (int i = 1; i &lt;= 3; ++i) &#123;                     ; ä¸‹é¢3æ¡æŒ‡ä»¤å¯¹åº”çš„æ˜¯ i = 1; i &lt;= 3</span></span><br><span class="line"><span class="number">12</span>: c7 <span class="number">45</span> f4 <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    movl    <span class="number">$1</span>, -<span class="number">12</span>(%rbp)     <span class="comment">; å°†æ ˆåœ°å€[rbp-12, rpb-8]å†…å­˜ç©ºé—´ï¼Œå³å˜é‡ièµ‹å€¼ä¸º1</span></span><br><span class="line"><span class="number">19</span>: <span class="number">83</span> <span class="number">7d</span> f4 <span class="number">03</span>             cmpl    <span class="number">$3</span>, -<span class="number">12</span>(%rbp)     <span class="comment">; æ¯”è¾ƒiå’Œ3ï¼Œå¹¶æ ¹æ®ç»“æœæ›´æ–°ZF/OF/SFæ ‡å¿—å¯„å­˜å™¨ï¼Œå¦‚æœi&lt;=3ï¼Œåˆ™ZF=1 SF!=OF</span></span><br><span class="line"><span class="number">1d</span>: 0f 8f <span class="number">17</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       <span class="keyword">jg</span>      <span class="number">23</span> &lt;_main+<span class="number">0x3a</span>&gt;   <span class="comment">; Jump if greaterï¼Œå³å½“i &gt; 3æ—¶ï¼Œå°†PCå¯„å­˜å™¨å€¼æ”¹ä¸º0x3a</span></span><br><span class="line"><span class="comment">;      a += i;</span></span><br><span class="line"><span class="number">23</span>: 8b <span class="number">45</span> f4                movl    -<span class="number">12</span>(%rbp), %eax   <span class="comment">; å°†içš„å€¼å¤åˆ¶åˆ°eaxå¯„å­˜å™¨  </span></span><br><span class="line"><span class="number">26</span>: <span class="number">03</span> <span class="number">45</span> f8                addl    -<span class="number">8</span>(%rbp), %eax    <span class="comment">; å°†açš„å€¼ç´¯åŠ åˆ°eaxå¯„å­˜å™¨</span></span><br><span class="line"><span class="number">29</span>: <span class="number">89</span> <span class="number">45</span> f8                movl    %eax, -<span class="number">8</span>(%rbp)    <span class="comment">; å°†eaxçš„å€¼å¤åˆ¶åˆ°å˜é‡açš„æ ˆåœ°å€ç©ºé—´</span></span><br><span class="line"><span class="comment">;  for (int i = 1; i &lt;= 3; ++i) &#123;                     ; ä¸‹é¢4æ¡æŒ‡ä»¤å¯¹åº”çš„æ˜¯ ++i</span></span><br><span class="line">2c: 8b <span class="number">45</span> f4                movl    -<span class="number">12</span>(%rbp), %eax   <span class="comment">; å°†içš„å€¼å¤åˆ¶åˆ°eaxå¯„å­˜å™¨</span></span><br><span class="line">2f: <span class="number">83</span> c0 <span class="number">01</span>                addl    <span class="number">$1</span>, %eax          <span class="comment">; eaxå¯„å­˜å™¨ç´¯åŠ 1</span></span><br><span class="line"><span class="number">32</span>: <span class="number">89</span> <span class="number">45</span> f4                movl    %eax, -<span class="number">12</span>(%rbp)   <span class="comment">; å°†eaxçš„å€¼å¤åˆ¶åˆ°å˜é‡içš„æ ˆåœ°å€ç©ºé—´</span></span><br><span class="line"><span class="number">35</span>: e9 df ff ff ff          <span class="keyword">jmp</span>     -<span class="number">33</span> &lt;_main+<span class="number">0x19</span>&gt;  <span class="comment">; å°†PCå¯„å­˜å™¨å€¼æ”¹ä¸º0x19ï¼Œå³è·³å›åˆ¤æ–­ i &lt;= 3çš„é€»è¾‘</span></span><br><span class="line"><span class="comment">;  while (a &lt;= 10) &#123;</span></span><br><span class="line">3a: e9 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">jmp</span>     <span class="number">0</span> &lt;_main+<span class="number">0x3f</span>&gt;</span><br><span class="line">3f: <span class="number">83</span> <span class="number">7d</span> f8 0a             cmpl    <span class="number">$10</span>, -<span class="number">8</span>(%rbp)     <span class="comment">; æ¯”è¾ƒaå’Œ10</span></span><br><span class="line"><span class="number">43</span>: 0f 8f 0e <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       <span class="keyword">jg</span>      <span class="number">14</span> &lt;_main+<span class="number">0x57</span>&gt;   <span class="comment">; å½“ i &gt; 10æ—¶ï¼Œå°†PCå¯„å­˜å™¨å€¼æ”¹ä¸º0x57</span></span><br><span class="line"><span class="comment">;      ++a;</span></span><br><span class="line"><span class="number">49</span>: 8b <span class="number">45</span> f8                movl    -<span class="number">8</span>(%rbp), %eax    <span class="comment">; å°†açš„å€¼å¤åˆ¶åˆ°eaxå¯„å­˜å™¨</span></span><br><span class="line">4c: <span class="number">83</span> c0 <span class="number">01</span>                addl    <span class="number">$1</span>, %eax          <span class="comment">; eaxå¯„å­˜å™¨ç´¯åŠ 1</span></span><br><span class="line">4f: <span class="number">89</span> <span class="number">45</span> f8                movl    %eax, -<span class="number">8</span>(%rbp)    <span class="comment">; å°†eaxçš„å€¼å¤åˆ¶åˆ°å˜é‡açš„æ ˆåœ°å€ç©ºé—´</span></span><br><span class="line"><span class="comment">;  while (a &lt;= 10) &#123;</span></span><br><span class="line"><span class="number">52</span>: e9 e8 ff ff ff          <span class="keyword">jmp</span>     -<span class="number">24</span> &lt;_main+<span class="number">0x3f</span>&gt;  <span class="comment">; å°†PCå¯„å­˜å™¨çš„å€¼æ”¹ä¸º0x3fï¼Œå³è·³å›åˆ¤æ–­ i &lt;= 10çš„é€»è¾‘</span></span><br><span class="line"><span class="comment">;  do &#123;</span></span><br><span class="line"><span class="number">57</span>: e9 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">jmp</span>     <span class="number">0</span> &lt;_main+<span class="number">0x5c</span>&gt;</span><br><span class="line"><span class="comment">;      a += 1;</span></span><br><span class="line">5c: 8b <span class="number">45</span> f8                movl    -<span class="number">8</span>(%rbp), %eax    <span class="comment">; ä¸‹é¢3å¥å¯¹åº”a+1ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†</span></span><br><span class="line">5f: <span class="number">83</span> c0 <span class="number">01</span>                addl    <span class="number">$1</span>, %eax</span><br><span class="line"><span class="number">62</span>: <span class="number">89</span> <span class="number">45</span> f8                movl    %eax, -<span class="number">8</span>(%rbp)</span><br><span class="line"><span class="comment">;  &#125; while (a &lt;= 10);</span></span><br><span class="line"><span class="number">65</span>: <span class="number">83</span> <span class="number">7d</span> f8 0a             cmpl    <span class="number">$10</span>, -<span class="number">8</span>(%rbp)     <span class="comment">; æ¯”è¾ƒaå’Œ10</span></span><br><span class="line"><span class="number">69</span>: 0f 8e ed ff ff ff       <span class="keyword">jle</span>     -<span class="number">19</span> &lt;_main+<span class="number">0x5c</span>&gt;  <span class="comment">; å½“ a &lt;= 10æ—¶ï¼Œå°†PCå¯„å­˜å™¨å€¼æ”¹ä¸º0x5cï¼Œå³è·³å›a+1æ“ä½œ</span></span><br><span class="line"><span class="comment">;  return a;</span></span><br><span class="line">6f: 8b <span class="number">45</span> f8                movl    -<span class="number">8</span>(%rbp), %eax    <span class="comment">; å°†açš„å€¼å¤åˆ¶åˆ°eaxå¯„å­˜å™¨ä½œä¸ºå‡½æ•°è¿”å›å€¼</span></span><br><span class="line"><span class="number">72</span>: <span class="number">5d</span>                      popq    %rbp</span><br><span class="line"><span class="number">73</span>: c3                      retq</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" onclick="scrollToDest($(this).parents('.tabs'),65)"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="while-2"><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">3</span>; ++i) &#123;</span><br><span class="line">        a += i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (a &lt;= <span class="number">10</span>) &#123;</span><br><span class="line">        ++a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        a += <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">while</span> (a &lt;= <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" onclick="scrollToDest($(this).parents('.tabs'),65)"><i class="fas fa-arrow-up"></i></button></div></div></div>

<h5 id="switchâ€¦case"><a href="#switchâ€¦case" class="headerlink" title="switchâ€¦case"></a>switchâ€¦case</h5><p>ä»é€»è¾‘ä¸Šæ¥è®²ï¼Œ<code>switch...case</code>èƒ½å®ç°çš„åŠŸèƒ½éƒ½å¯ä»¥ç”¨<code>if...else</code>æ›¿æ¢ã€‚ä½†æ˜¯æœ‰ä¸€ç‚¹åŒºåˆ«åœ¨äºï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®caseçš„æ•°é‡å’Œå€¼çš„ç¨€ç–ç¨‹åº¦ï¼Œæ¥ç¼–è¯‘ä¼˜åŒ–switchè¯­å¥ç”Ÿæˆä¸åŒçš„æœºå™¨ç ï¼Œå…·ä½“çš„è§„åˆ™ä¸ºï¼š</p>
<ul>
<li>å¦‚æœ<code>caseåˆ†æ”¯æ•° &lt; 4</code>ï¼ˆdefaultä¸ç®—ï¼‰ï¼Œæˆ–è€…<code>æ¯ä¸¤ä¸ªcaseä¹‹é—´çš„å·®å€¼ &gt; é˜ˆå€¼</code>ï¼Œæ­¤æ—¶ç”Ÿæˆçš„æ±‡ç¼–ä»£ç å’Œifâ€¦elseé€»è¾‘ç±»ä¼¼ï¼Œéƒ½æ˜¯å¯¹æ¯ä¸€ä¸ªæ¡ä»¶è¿›è¡Œ<code>cmp</code>ï¼Œç„¶å<code>je/jne</code>è¿›è¡Œè·³è½¬</li>
<li>å¦åˆ™ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ç›®æ ‡æ–‡ä»¶çš„ä»£ç æ®µä¸­å¢åŠ ä¸€ä¸ª<code>jump table</code>ã€‚å…¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œindexå¯¹åº”<em>caseå€¼</em>ä¸<em>caseæœ€å°å€¼</em>çš„å·®å€¼ï¼Œvalueå¯¹åº”<em>æ•°ç»„èµ·å§‹åœ°å€</em>ä¸<em>caseä»£ç å—èµ·å§‹åœ°å€</em>çš„å·®å€¼ï¼ˆä¹‹æ‰€ä»¥è¦å­˜ç›¸å¯¹å€¼è€Œéç»å¯¹å€¼æ˜¯å› ä¸ºæŒ‡ä»¤çš„åœ°å€åªæœ‰åœ¨åŠ è½½åˆ°å†…å­˜åæ‰èƒ½ç¡®å®šï¼‰ã€‚é€šè¿‡è®¡ç®—switchå€¼ç›¸å¯¹çš„indexï¼Œå–å‡ºè·³è½¬è¡¨å¯¹åº”çš„ç›¸å¯¹åœ°å€ï¼Œç„¶åjmpåˆ°ä»£ç å—ï¼Œå®ç°<code>O(1)</code>æ—¶é—´å¤æ‚åº¦çš„æ¡ä»¶è·³è½¬ï¼Œæ˜¯å…¸å‹çš„ä»¥ç©ºé—´æ¢æ—¶é—´çš„ä¼˜åŒ–æ–¹æ³•ã€‚</li>
</ul>
<blockquote>
<p>switchè¯­å¥é€‚ç”¨åœºæ™¯</p>
<ol>
<li>åˆ¤æ–­çš„caseæ¡ä»¶é’ˆå¯¹<strong>åŒä¸€ä¸ªå˜é‡</strong>ï¼Œä¸”æœ‰ç¡®åˆ‡å€¼</li>
<li>åˆ†æ”¯è¾ƒå¤šï¼Œå¤§äºç­‰äº4ä¸ª</li>
<li>caseæ¡ä»¶çš„å€¼åœ¨ä¸€ä¸ªè¾ƒå°çš„ã€è¿ç»­çš„èŒƒå›´å†…ï¼Œä¸”è·¨åº¦å°äºç­‰äº6</li>
</ol>
<p>ifâ€¦elseè¯­å¥é€‚ç”¨åœºæ™¯</p>
<ol>
<li>åˆ†æ”¯è¾ƒå°‘ï¼Œå°äº4ä¸ª</li>
<li>caseæ¡ä»¶å€¼è¾ƒä¸ºç¨€ç–</li>
<li>åˆ¤æ–­çš„caseæ¡ä»¶<strong>ä¸æ­¢æœ‰ä¸€ä¸ªå˜é‡</strong>ï¼Œæˆ–åŸºäºæ•°å€¼èŒƒå›´åˆ¤æ–­</li>
</ol>
</blockquote>
<div class="tabs" id="switch-case"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#switch-case-1">æ±‡ç¼–ä»£ç </button></li><li class="tab"><button type="button" data-href="#switch-case-2">Jump Table</button></li><li class="tab"><button type="button" data-href="#switch-case-3">Cä»£ç </button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="switch-case-1"><figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line"><span class="comment">; void switch_demo(int x) &#123;</span></span><br><span class="line"> <span class="number">8</span>: <span class="number">89</span> <span class="number">7d</span> fc                movl    %edi, -<span class="number">4</span>(%rbp)          <span class="comment">; å°†å…¥å‚xçš„å€¼å¤åˆ¶åˆ°[rbp - 4, rbp]æ ˆå†…å­˜ï¼Œå› ä¸ºrdiå¯„å­˜å™¨åœ¨è°ƒç”¨å…¶ä»–å‡½æ•°æ—¶è¿˜è¦ç”¨åˆ°æ‰€ä»¥å¿…é¡»è¦æŠŠå€¼ä¿å­˜åˆ°å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment">;  switch(x) &#123;</span></span><br><span class="line"><span class="symbol"> b:</span> 8b <span class="number">45</span> fc                movl    -<span class="number">4</span>(%rbp), %eax</span><br><span class="line"><span class="symbol"> e:</span> <span class="number">83</span> c0 fe                addl    $-<span class="number">2</span>, %eax               <span class="comment">; eaxå¯„å­˜å™¨ä¸­çš„å€¼-2ï¼Œ2ä¸ºcaseæœ€å°å€¼ï¼Œè¿™é‡Œæ˜¯è®¡ç®—å˜é‡xå¯¹åº”è·³è½¬è¡¨çš„index</span></span><br><span class="line"><span class="number">11</span>: <span class="number">89</span> c1                   movl    %eax, %ecx              <span class="comment">; å°†indexçš„å€¼å†™å…¥ecxå¯„å­˜å™¨</span></span><br><span class="line"><span class="number">13</span>: <span class="number">83</span> e8 <span class="number">05</span>                subl    <span class="number">$5</span>, %eax                <span class="comment">; å°†å˜é‡xå‡å»caseçš„æœ€å¤§å€¼ï¼Œå¦‚æœå¤§äº0åˆ™è·³è½¬åˆ°defaultï¼Œæ— éœ€æŸ¥è¯¢è·³è½¬è¡¨</span></span><br><span class="line"><span class="number">16</span>: <span class="number">48</span> <span class="number">89</span> <span class="number">4d</span> f0             <span class="keyword">movq</span>    %rcx, -<span class="number">16</span>(%rbp)         <span class="comment">; ä¿å­˜indexçš„å€¼åˆ°[rbp - 16, rbp - 8]æ ˆå†…å­˜</span></span><br><span class="line">1a: 0f <span class="number">87</span> 5b <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       <span class="keyword">ja</span>      <span class="number">91</span> &lt;_switch_demo+<span class="number">0x7b</span>&gt;  <span class="comment">; æ— ç¬¦å·è·³è½¬ï¼Œå¦‚æœeaxä¸­çš„å€¼å¤§äº0ï¼Œå³x - 2 - 5 &gt; 0ï¼Œåˆ™ä¿®æ”¹PCå¯„å­˜å™¨çš„å€¼ä¸º0x7bï¼Œå³è·³è½¬åˆ°defaultåˆ†æ”¯</span></span><br><span class="line"><span class="number">20</span>: <span class="number">48</span> <span class="number">8d</span> <span class="number">05</span> <span class="number">69</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    leaq    <span class="number">105</span>(%rip), %rax         <span class="comment">; å°†PCå¯„å­˜å™¨ä¸­çš„å€¼åŠ 0x69å¹¶å¤åˆ¶åˆ°raxå¯„å­˜å™¨ï¼ŒPCå¯„å­˜å™¨å­˜çš„æ˜¯ä¸‹ä¸€æ¡å¾…æ‰§è¡ŒæŒ‡ä»¤çš„åœ°å€å³0x27ï¼Œæ‰€ä»¥raxä¸­çš„å€¼ä¸º0x90å³è·³è½¬è¡¨é¦–åœ°å€ã€‚leaqæ˜¯å¯¹åœ°å€è¿›è¡Œè¿ç®—ï¼Œå¹¶å°†è®¡ç®—å‡ºçš„åœ°å€å­˜å…¥ç›®æ ‡å¯„å­˜å™¨ä¸­ï¼›movqæ˜¯å¯¹åœ°å€ä¸­çš„æ•°æ®è¿›è¡Œè®¡ç®—</span></span><br><span class="line"><span class="number">27</span>: <span class="number">48</span> 8b <span class="number">4d</span> f0             <span class="keyword">movq</span>    -<span class="number">16</span>(%rbp), %rcx         <span class="comment">; å°†indexçš„å€¼å¤åˆ¶åˆ°rcxå¯„å­˜å™¨</span></span><br><span class="line">2b: <span class="number">48</span> <span class="number">63</span> <span class="number">14</span> <span class="number">88</span>             movslq  (%rax,%rcx,<span class="number">4</span>), %rdx     <span class="comment">; è·³è½¬è¡¨é¦–åœ°å€ + index * 4ï¼Œè¿™é‡Œæ˜¯è®¡ç®—å˜é‡xå¯¹åº”çš„è·³è½¬è¡¨ä¸­çš„åœ°å€</span></span><br><span class="line">2f: <span class="number">48</span> <span class="number">01</span> c2                addq    %rax, %rdx              <span class="comment">; è·³è½¬è¡¨ä¸­åœ°å€å­˜å‚¨çš„å€¼ä¸º`caseä»£ç å—ç›¸å¯¹äºè·³è½¬è¡¨é¦–åœ°å€çš„å·®å€¼`ï¼Œ åŠ ä¸Šè·³è½¬è¡¨é¦–åœ°å€åï¼Œrbxä¸­å­˜çš„å³ä¸ºå˜é‡xå¯¹åº”çš„caseä»£ç å—é¦–åœ°å€</span></span><br><span class="line"><span class="number">32</span>: ff e2                   jmpq    *%rdx                   <span class="comment">; ä¿®æ”¹PCå¯„å­˜å™¨å€¼ä¸ºrdxä¸­å­˜çš„åœ°å€å€¼</span></span><br><span class="line"><span class="comment">;          printf(&quot;Got 3&quot;);</span></span><br><span class="line"><span class="number">34</span>: <span class="number">48</span> <span class="number">8d</span> <span class="number">3d</span> <span class="number">6d</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    leaq    <span class="number">109</span>(%rip), %rdi         <span class="comment">; dataæ®µä¸­&quot;Got 3&quot;å¸¸é‡å¯¹åº”çš„åœ°å€</span></span><br><span class="line">3b: b0 <span class="number">00</span>                   movb    <span class="number">$0</span>, %al</span><br><span class="line"><span class="number">3d</span>: e8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          callq   <span class="number">0</span> &lt;_switch_demo+<span class="number">0x42</span>&gt;</span><br><span class="line"><span class="comment">;          break;</span></span><br><span class="line"><span class="number">42</span>: e9 <span class="number">42</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">jmp</span>     <span class="number">66</span> &lt;_switch_demo+<span class="number">0x89</span>&gt;  <span class="comment">; breakè·³å‡ºå¾ªç¯ </span></span><br><span class="line"><span class="comment">;          printf(&quot;Got 6&quot;);</span></span><br><span class="line"><span class="number">47</span>: <span class="number">48</span> <span class="number">8d</span> <span class="number">3d</span> <span class="number">60</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    leaq    <span class="number">96</span>(%rip), %rdi</span><br><span class="line">4e: b0 <span class="number">00</span>                   movb    <span class="number">$0</span>, %al</span><br><span class="line"><span class="number">50</span>: e8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          callq   <span class="number">0</span> &lt;_switch_demo+<span class="number">0x55</span>&gt;</span><br><span class="line"><span class="comment">;          printf(&quot;Got 7&quot;);</span></span><br><span class="line"><span class="number">55</span>: <span class="number">48</span> <span class="number">8d</span> <span class="number">3d</span> <span class="number">58</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    leaq    <span class="number">88</span>(%rip), %rdi          <span class="comment">; go through</span></span><br><span class="line">5c: b0 <span class="number">00</span>                   movb    <span class="number">$0</span>, %al</span><br><span class="line">5e: e8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          callq   <span class="number">0</span> &lt;_switch_demo+<span class="number">0x63</span>&gt;</span><br><span class="line"><span class="comment">;          break;</span></span><br><span class="line"><span class="number">63</span>: e9 <span class="number">21</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">jmp</span>     <span class="number">33</span> &lt;_switch_demo+<span class="number">0x89</span>&gt;</span><br><span class="line"><span class="comment">;          printf(&quot;Got 2 or 4&quot;);</span></span><br><span class="line"><span class="number">68</span>: <span class="number">48</span> <span class="number">8d</span> <span class="number">3d</span> 4b <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    leaq    <span class="number">75</span>(%rip), %rdi</span><br><span class="line">6f: b0 <span class="number">00</span>                   movb    <span class="number">$0</span>, %al</span><br><span class="line"><span class="number">71</span>: e8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          callq   <span class="number">0</span> &lt;_switch_demo+<span class="number">0x76</span>&gt;</span><br><span class="line"><span class="comment">;          break;</span></span><br><span class="line"><span class="number">76</span>: e9 0e <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">jmp</span>     <span class="number">14</span> &lt;_switch_demo+<span class="number">0x89</span>&gt;</span><br><span class="line"><span class="comment">;          printf(&quot;Got default&quot;);</span></span><br><span class="line">7b: <span class="number">48</span> <span class="number">8d</span> <span class="number">3d</span> <span class="number">43</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    leaq    <span class="number">67</span>(%rip), %rdi</span><br><span class="line"><span class="number">82</span>: b0 <span class="number">00</span>                   movb    <span class="number">$0</span>, %al</span><br><span class="line"><span class="number">84</span>: e8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          callq   <span class="number">0</span> &lt;_switch_demo+<span class="number">0x89</span>&gt;</span><br><span class="line"><span class="comment">; &#125;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" onclick="scrollToDest($(this).parents('.tabs'),65)"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="switch-case-2"><p>å°ç«¯æ¨¡å¼ï¼Œå³ä½åœ°å€å­˜ä½å­—èŠ‚ã€‚å€¼ä¸ºè¡¥ç ã€‚</p>
<table>
<thead>
<tr>
<th>index/switchå€¼</th>
<th>asm</th>
<th>è¡¥ç </th>
<th>åŸç </th>
<th>caseä»£ç å—é¦–åœ°å€</th>
<th>å¯¹åº”ä»£ç </th>
</tr>
</thead>
<tbody><tr>
<td>0/2</td>
<td>90: d8 ff ff ff</td>
<td>0xffffffd8</td>
<td>0x80000028</td>
<td>0x68</td>
<td>printf(â€œGot 2 or 4â€);</td>
</tr>
<tr>
<td>1/3</td>
<td>94: a4 ff ff ff</td>
<td>0xffffffa4</td>
<td>0x8000005c</td>
<td>0x34</td>
<td>printf(â€œGot 3â€);</td>
</tr>
<tr>
<td>2/4</td>
<td>98: d8 ff ff ff</td>
<td>0xffffffd8</td>
<td>0x80000028</td>
<td>0x68</td>
<td>printf(â€œGot 2 or 4â€);</td>
</tr>
<tr>
<td>3/5</td>
<td>9c: eb ff ff ff</td>
<td>0xffffffeb</td>
<td>0x80000015</td>
<td>0x7b</td>
<td>printf(â€œGot defaultâ€);</td>
</tr>
<tr>
<td>4/6</td>
<td>a0: b7 ff ff ff</td>
<td>0xffffffb7</td>
<td>0x80000049</td>
<td>0x47</td>
<td>printf(â€œGot 6â€);</td>
</tr>
<tr>
<td>5/7</td>
<td>a4: c5 ff ff ff</td>
<td>0xffffffc5</td>
<td>0x8000003b</td>
<td>0x55</td>
<td>printf(â€œGot 7â€);</td>
</tr>
</tbody></table><button type="button" class="tab-to-top" onclick="scrollToDest($(this).parents('.tabs'),65)"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="switch-case-3"><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">switch_demo</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span>(x) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Got 3&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Got 6&quot;</span>);</span><br><span class="line">        <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Got 7&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Got 2 or 4&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Got default&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" onclick="scrollToDest($(this).parents('.tabs'),65)"><i class="fas fa-arrow-up"></i></button></div></div></div>

<h4 id="å‡½æ•°è°ƒç”¨åŠæ ˆå¸§"><a href="#å‡½æ•°è°ƒç”¨åŠæ ˆå¸§" class="headerlink" title="å‡½æ•°è°ƒç”¨åŠæ ˆå¸§"></a>å‡½æ•°è°ƒç”¨åŠæ ˆå¸§</h4><blockquote>
<p>ä¸Šä¸€å°èŠ‚åˆ†ææŒ‡ä»¤è·³è½¬æ±‡ç¼–ä»£ç æ—¶æåˆ°äº†å‡½æ•°è°ƒç”¨ã€å‹æ ˆç›¸å…³çŸ¥è¯†ï¼Œè¿™ä¸€èŠ‚é‡ç‚¹å­¦ä¹ ä¸‹ã€‚é¦–å…ˆæ€è€ƒä¸ªé—®é¢˜ï¼Œå‡½æ•°Aåœ¨è°ƒç”¨å‡½æ•°Bä¹‹å‰ï¼Œéœ€è¦ä¿å­˜å“ªäº›ä¿¡æ¯ï¼Œä¿å­˜åˆ°å“ªï¼Ÿéœ€è¦ä¼ é€’å“ªäº›ä¿¡æ¯ï¼Œå¦‚ä½•ä¼ é€’ï¼Ÿè°ƒç”¨ç»“æŸåå¦‚ä½•æ¢å¤ä¿¡æ¯å¹¶ç»§ç»­æ‰§è¡Œå‘¢ï¼Ÿ</p>
</blockquote>
<h5 id="å‡½æ•°æ ˆå¸§èµ·æº"><a href="#å‡½æ•°æ ˆå¸§èµ·æº" class="headerlink" title="å‡½æ•°æ ˆå¸§èµ·æº"></a>å‡½æ•°æ ˆå¸§èµ·æº</h5><p>å¦‚æœè®©æˆ‘æ¥è®¾è®¡æŒ‡ä»¤å®ç°å‡½æ•°è°ƒç”¨ï¼Œæœ€å…ˆæƒ³åˆ°çš„æ˜¯ä»€ä¹ˆæ–¹æ³•å‘¢ï¼Ÿ</p>
<ul>
<li>ç”¨gotoèƒ½å®ç°å—ï¼Œå‡½æ•°Bæ‰§è¡Œç»“æŸååˆ©ç”¨gotoå›åˆ°å‡½æ•°Aä¸­è°ƒç”¨å‡½æ•°Bçš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚ä½†æ˜¯ç»†æƒ³ä¸€ä¸‹æœ‰è¯¸å¤šé—®é¢˜ï¼Œå¦‚æœä¾èµ–äº†ç¬¬ä¸‰æ–¹çš„åº“ï¼Œæˆ‘ä»¬æ²¡åŠæ³•æ”¹å®ƒçš„æºä»£ç ï¼Œä¹Ÿå°±æ²¡åŠæ³•è®©Calleeæ‰§è¡Œç»“æŸågotoå›Callerç»§ç»­æ‰§è¡Œï¼Œæ‰€ä»¥ç”¨gotoå®ç°ä¸äº†å‡½æ•°è°ƒç”¨ã€‚</li>
<li>é‚£æ—¢ç„¶åœ¨è¿™ç§åœºæ™¯ä¸‹æ²¡åŠæ³•è·³å›ï¼Œèƒ½ä¸èƒ½åœ¨ç¼–è¯‘æ—¶ç”¨å‡½æ•°Bçš„æŒ‡ä»¤æ›¿æ¢æ‰å‡½æ•°Açš„callæŒ‡ä»¤ï¼Ÿè¿™æ ·æ— éœ€è·³è½¬é¡ºåºæ‰§è¡Œå³å¯ã€‚ä½†æ˜¯ç»†æƒ³ä¸€ä¸‹è¿˜æ˜¯æœ‰é—®é¢˜ï¼Œå¦‚æœå‡½æ•°Aè°ƒç”¨å‡½æ•°Bï¼Œå‡½æ•°Båˆè°ƒç”¨äº†å‡½æ•°Aï¼Œè¿™æ ·ä¸€ç›´å¾ªç¯è°ƒç”¨å°±ä¼šäº§ç”Ÿæ— ç©·æ— å°½çš„æ›¿æ¢ã€‚æ‰€ä»¥æŠŠCalleeçš„æŒ‡ä»¤ç›´æ¥æ’å…¥åˆ°è°ƒç”¨å¤„è¿™ä¸ªæ–¹æ³•ä¹Ÿå®ç°ä¸äº†å‡½æ•°è°ƒç”¨ã€‚</li>
<li>æ—¢ç„¶å‡½æ•°è°ƒç”¨å¿…é¡»è¦è·³å›ç»§ç»­æ‰§è¡Œï¼Œä½†åˆä¸èƒ½ä¿®æ”¹è¢«è°ƒç”¨å‡½æ•°çš„æŒ‡ä»¤ï¼Œé‚£èƒ½ä¸èƒ½æŠŠè¦è·³å›æ‰§è¡Œçš„æŒ‡ä»¤è®°å½•ä¸‹æ¥ï¼Œç„¶åå¤§å®¶çº¦å®šä¸‹ï¼šæ¯”å¦‚å‡½æ•°è°ƒç”¨ç»“æŸåéƒ½ä»<code>r15</code>å¯„å­˜å™¨ä¸­å–å‡ºè·³å›åœ°å€ï¼Œç»§ç»­æ‰§è¡Œå°±å¥½äº†ã€‚ä½†æ˜¯åœ¨å¤šå±‚å‡½æ•°è°ƒç”¨é‡Œï¼Œéœ€è¦è®°å½•æ¯ä¸€å±‚å‡½æ•°çš„è·³å›åœ°å€ï¼Œè€ŒCPUä¸­çš„å¯„å­˜å™¨æ•°é‡å¹¶ä¸å¤šï¼ˆx86-64åªæœ‰16ä¸ªé€šç”¨å¯„å­˜å™¨ï¼‰ï¼Œè°ƒç”¨å±‚çº§ä¸€å¤šå°±å­˜ä¸ä¸‹äº†ã€‚</li>
<li>æ—¢ç„¶å¯„å­˜å™¨å­˜ä¸ä¸‹è·³å›åœ°å€ï¼Œé‚£èƒ½ä¸èƒ½æŠŠåœ°å€å­˜åˆ°å†…å­˜ç©ºé—´ä¸­å‘¢ï¼Ÿè€ƒè™‘åˆ°å‡½æ•°è°ƒç”¨æœ‰é€’å½’çš„ç‰¹æ€§ï¼Œå³å…ˆè°ƒç”¨çš„åè¿”å›ï¼Œè¿™å’Œæ ˆçš„æ•°æ®ç»“æ„ï¼ˆLIFOï¼ŒLast In First Outï¼‰ç›¸åŒã€‚è¿™æ ·æˆ‘ä»¬åœ¨å†…å­˜ä¸­å¼€è¾Ÿä¸€æ®µç©ºé—´ï¼Œæ¯æ¬¡å‡½æ•°è°ƒç”¨ä¹‹å‰æŠŠè·³å›åè¦ç»§ç»­æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€å‹æ ˆï¼Œåœ¨è¢«è°ƒç”¨å‡½æ•°è¿”å›æ—¶å°†æ ˆé¡¶åœ°å€å‡ºæ ˆï¼Œç„¶å<code>jmp</code>è·³è½¬åˆ°å¯¹åº”æŒ‡ä»¤åœ°å€ã€‚</li>
</ul>
<p>é€šè¿‡ä¸Šé¢çš„æ¨æ¼”ï¼Œæˆ‘ä»¬åˆæ­¥ç¡®å®šäº†å‡½æ•°è°ƒç”¨çš„æ–¹æ³•ã€‚å½“ç„¶åœ¨çœŸå®çš„ç¨‹åºé‡Œï¼Œéœ€è¦å‹æ ˆçš„ä¸æ­¢æœ‰å‡½æ•°è°ƒç”¨å®Œæˆåçš„è¿”å›åœ°å€ã€‚</p>
<p>ä¸ºäº†ä¿è¯è°ƒç”¨å‰åå˜é‡å’Œå‡½æ•°åœ¨Callerä¸­çš„ç›¸å¯¹åœ°å€ä¸å˜ï¼Œåœ¨å‡½æ•°è¿”å›æ—¶è¦èƒ½æŠŠCalleræ ˆåº•çš„åœ°å€æ¢å¤åˆ°å¯„å­˜å™¨ä¸­ï¼Œæ‰€ä»¥Callerçš„æ ˆåº•åœ°å€ï¼ˆå³<code>%rbp</code>å¯„å­˜å™¨ä¸­çš„å€¼ï¼‰ä¹Ÿéœ€è¦ä¿å­˜åˆ°æ ˆç©ºé—´ã€‚è€ƒè™‘åˆ°å‡½æ•°ä¼ å‚å¯ä»¥æœ‰å¾ˆå¤šï¼Œè€Œå¯„å­˜å™¨ä¸ªæ•°æœ‰é™ï¼Œæ‰€ä»¥å½“å‚æ•°è¶…è¿‡6ä¸ªï¼ˆåœ¨<a href="#%E5%AF%84%E5%AD%98%E5%99%A8">å¯„å­˜å™¨</a>ä¸€èŠ‚æœ‰è®²è¿‡ï¼‰åï¼Œå¤šå‡ºçš„å‚æ•°æ•°æ®ä¹Ÿè¦å‹å…¥æ ˆä¸­ï¼ˆä»å³åˆ°å·¦ä¾æ¬¡å‹å…¥Calleræ ˆï¼‰ã€‚é‚£ä¹ˆå‡½æ•°çš„æ ˆç©ºé—´ç›®å‰å¯ä»¥ç¡®å®šçš„ç»“æ„å¦‚ä¸‹ï¼š</p>
<img src="https://cdn.leosocy.top/img/dinosaurloading.gif" data-lazy-src="https://cdn.leosocy.top/img/20210409011244.png" style="zoom:33%;">

<p>é€šè¿‡å¯„å­˜å™¨ä¼ é€’åˆ°Calleeçš„å‚æ•°å€¼ä¹Ÿéœ€è¦ä¿å­˜åˆ°æ ˆç©ºé—´ï¼Œä»¥å…å¯„å­˜å™¨å‚ä¸ä¹‹åçš„è®¡ç®—æˆ–å‡½æ•°è°ƒç”¨å¯¼è‡´å…¶å†…çš„å€¼è¢«è¦†ç›–ã€‚åŒæ—¶å±€éƒ¨å˜é‡åœ¨å‡½æ•°è°ƒç”¨è¿”å›åè¿˜éœ€è¦ç»§ç»­ä½¿ç”¨ï¼Œæ‰€ä»¥å±€éƒ¨å˜é‡çš„å€¼ä¹Ÿéœ€è¦ä¿å­˜åˆ°æ ˆç©ºé—´ï¼Œé‚£ä¹ˆå‡½æ•°çš„æ ˆå¸§ç©ºé—´æœ€ç»ˆå°±ç¡®å®šä¸ºï¼š</p>
<img src="https://cdn.leosocy.top/img/dinosaurloading.gif" data-lazy-src="https://cdn.leosocy.top/img/20210409011337.png" style="zoom:33%;">

<h5 id="æ±‡ç¼–ä»£ç åˆ†æ"><a href="#æ±‡ç¼–ä»£ç åˆ†æ" class="headerlink" title="æ±‡ç¼–ä»£ç åˆ†æ"></a>æ±‡ç¼–ä»£ç åˆ†æ</h5><blockquote>
<p>æ³¨ï¼šæ±‡ç¼–ä»£ç ä½¿ç”¨çš„ç¼–è¯‘å™¨ç‰ˆæœ¬ä¸ºï¼š<code>gcc version 6.3.0 20170516 (Debian 6.3.0-18+deb9u1)</code></p>
<p>æ±‡ç¼–ä»£ç ä¸­æ¶‰åŠåˆ°çš„å‡ ä¸ªå°çŸ¥è¯†ï¼Œè¿™é‡Œæå‰è¯´æ˜ä¸‹</p>
<ol>
<li><code>lea</code>ï¼ˆLoad Effective Addressï¼‰æ˜¯å¯¹åœ°å€è¿›è¡Œè¿ç®—ï¼Œå¹¶å°†è®¡ç®—å‡ºçš„åœ°å€å­˜å…¥ç›®æ ‡å¯„å­˜å™¨ä¸­ï¼›movæ˜¯å¯¹åœ°å€ä¸­çš„æ•°æ®è¿›è¡Œè®¡ç®—ã€‚ä¸¾ä¸ªä¾‹å­ï¼š<code>%rbp=0x30</code>ï¼Œ <code>mov -0x10(%rbp),rax</code>å°†0x20~0x28å†…å­˜åœ°å€ä¸­çš„æ•°æ®å¤åˆ¶åˆ°raxå¯„å­˜å™¨ï¼›<code>lea -0x10(%rbp),rax</code>å°†0x20è¿™ä¸ªå€¼å¤åˆ¶åˆ°raxå¯„å­˜å™¨</li>
<li><strong>æ ˆåœ°å€å¯¹é½</strong>ï¼šæŸäº›å‹å·çš„Intelå’ŒAMDå¤„ç†å™¨å¯¹äºSSEæŒ‡ä»¤ï¼Œå¦‚æœæ•°æ®æ²¡æœ‰å¯¹é½çš„è¯ï¼Œå°±æ— æ³•æ­£ç¡®æ‰§è¡Œã€‚è¿™äº›æŒ‡ä»¤å¯¹16å­—èŠ‚å†…å­˜è¿›è¡Œæ“ä½œï¼Œåœ¨SSEå•å…ƒå’Œå†…å­˜ä¹‹é—´ä¼ é€æ•°æ®çš„æŒ‡ä»¤è¦æ±‚å†…å­˜åœ°å€å¿…é¡»æ˜¯16çš„å€æ•°ã€‚å¯¹é½çš„å­—èŠ‚æ•°å¯ä»¥é€šè¿‡gccçš„<code>-mpreferred-stack-boundary</code>å‚æ•°é…ç½®ï¼Œå–å€¼èŒƒå›´ä¸º<code>4~12</code>å³<code>64byte~4096byte</code></li>
</ol>
</blockquote>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line"><span class="number">0000000000000072</span> &lt;main&gt;:</span><br><span class="line"><span class="keyword">int</span> main() &#123;</span><br><span class="line"><span class="number">72</span>:  <span class="number">55</span>                <span class="keyword">push</span>   %rbp              <span class="comment">; å°†ä¸Šä¸€æ ˆå¸§çš„rbpå€¼å‹æ ˆã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç–‘æƒ‘ï¼šmainå‡½æ•°ä¸æ˜¯æ•´ä¸ªå‡½æ•°çš„å…¥å£å—ï¼Ÿéš¾é“è¯´mainä¹Ÿæœ‰çˆ¶å‡½æ•°ï¼Ÿè¿™ä¸ªè°œé¢˜å°†åœ¨[ç¨‹åºé“¾æ¥ä¸è£…è½½](#ç¨‹åºè¿æ¥ä¸è£…è½½)ä¸€èŠ‚æ­æ™“</span></span><br><span class="line"><span class="number">73</span>:  <span class="number">48</span> <span class="number">89</span> e5          <span class="keyword">mov</span>    %rsp,%rbp         <span class="comment">; å°†rspçš„å€¼å¤åˆ¶åˆ°rbpå¯„å­˜å™¨ï¼Œå³å°†rbpæŒ‡å‘å½“å‰å‡½æ•°çš„æ ˆåº•ï¼Œè€Œrspå§‹ç»ˆä¼šæŒ‡å‘æ ˆé¡¶</span></span><br><span class="line"><span class="number">76</span>:  <span class="number">48</span> <span class="number">83</span> ec <span class="number">10</span>       <span class="keyword">sub</span>    <span class="number">$0</span>x10,%rsp        <span class="comment">; æ ˆé¡¶å‘ä¸‹æ‰©å±•16ä¸ªå­—èŠ‚ï¼ˆæ ˆæ˜¯ä»é«˜åœ°å€å‘ä½åœ°å€ç”Ÿé•¿çš„ï¼‰ï¼Œç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡</span></span><br><span class="line">		long x = <span class="number">10</span>, y = <span class="number">20</span><span class="comment">;</span></span><br><span class="line">7a:  <span class="number">48</span> c7 <span class="number">45</span> f8 0a <span class="number">00</span> <span class="keyword">movq</span>   <span class="number">$0</span>xa,-<span class="number">0x8</span>(%rbp)   <span class="comment">; å°†æ ˆåœ°å€[rbp-8, rbp]å†…å­˜ç©ºé—´ï¼Œå³å˜é‡xèµ‹å€¼ä¸º10</span></span><br><span class="line"><span class="number">81</span>:  <span class="number">00</span> </span><br><span class="line"><span class="number">82</span>:  <span class="number">48</span> c7 <span class="number">45</span> f0 <span class="number">14</span> <span class="number">00</span> <span class="keyword">movq</span>   <span class="number">$0</span>x14,-<span class="number">0x10</span>(%rbp) <span class="comment">; å°†æ ˆåœ°å€[rbp-16, rbp-8]å†…å­˜ç©ºé—´ï¼Œå³å˜é‡yèµ‹å€¼ä¸º20</span></span><br><span class="line"><span class="number">89</span>:  <span class="number">00</span> </span><br><span class="line">		x = calc(<span class="string">&#x27;l&#x27;</span>, <span class="number">2</span>, <span class="number">3</span>, x, <span class="number">15</span>, y, y + <span class="number">1</span>)<span class="comment">;</span></span><br><span class="line">8a:  <span class="number">48</span> 8b <span class="number">45</span> f0       <span class="keyword">mov</span>    -<span class="number">0x10</span>(%rbp),%rax  <span class="comment">; å°†å˜é‡yçš„å€¼å¤åˆ¶åˆ°raxå¯„å­˜å™¨ï¼Œç”¨äºåç»­è®¡ç®—y+1</span></span><br><span class="line">8e:  <span class="number">48</span> <span class="number">8d</span> <span class="number">48</span> <span class="number">01</span>       <span class="keyword">lea</span>    <span class="number">0x1</span>(%rax),%rcx    <span class="comment">; å°†y+1çš„å€¼å¤åˆ¶åˆ°rcxå¯„å­˜å™¨ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆç”¨leaè€Œä¸ç”¨addå‘¢ï¼Ÿå› ä¸ºraxä¸­å­˜å‚¨yçš„å€¼è¿˜è¦ç”¨äºåç»­ä¼ å‚ï¼Œç”¨addä¼šæ”¹å˜raxä¸­çš„å€¼ï¼Œè¿™é‡Œç”¨leaå¯ä»¥å°†è¿ç®—åçš„å€¼å­˜åˆ°å¦ä¸€ä¸ªå¯„å­˜å™¨ä¸­</span></span><br><span class="line"><span class="number">92</span>:  <span class="number">48</span> 8b <span class="number">55</span> f0       <span class="keyword">mov</span>    -<span class="number">0x10</span>(%rbp),%rdx  <span class="comment">; å°†å˜é‡yçš„å€¼å¤åˆ¶åˆ°rbxå¯„å­˜å™¨</span></span><br><span class="line"><span class="number">96</span>:  <span class="number">48</span> 8b <span class="number">45</span> f8       <span class="keyword">mov</span>    -<span class="number">0x8</span>(%rbp),%rax   <span class="comment">; å°†å˜é‡xçš„å€¼å¤åˆ¶åˆ°raxå¯„å­˜å™¨</span></span><br><span class="line">9a:  <span class="number">48</span> <span class="number">83</span> ec <span class="number">08</span>       <span class="keyword">sub</span>    <span class="number">$0</span>x8,%rsp         <span class="comment">; æ ˆé¡¶å‘ä¸‹æ‰©å±•8ä¸ªå­—èŠ‚ï¼Œç”¨äºä¿è¯æ ˆå¸§çš„è¾¹ç•Œæ˜¯16å­—èŠ‚å¯¹é½çš„</span></span><br><span class="line">9e:  <span class="number">51</span>                <span class="keyword">push</span>   %rcx              <span class="comment">; ç¬¬ä¸ƒä¸ªå‚æ•°å‹æ ˆï¼Œ</span></span><br><span class="line">9f:  <span class="number">49</span> <span class="number">89</span> d1          <span class="keyword">mov</span>    %rdx,%r9          <span class="comment">; r9å¯„å­˜å™¨ï¼Œå­˜ç¬¬å…­ä¸ªå‚æ•°yï¼Œyçš„å€¼åœ¨0x92æŒ‡ä»¤ä¸­è¢«å¤åˆ¶åˆ°äº†rdxå¯„å­˜å™¨</span></span><br><span class="line"><span class="symbol">a2:</span>  <span class="number">41</span> b8 0f <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="keyword">mov</span>    <span class="number">$0</span>xf,%r8d         <span class="comment">; r8å¯„å­˜å™¨ï¼Œå­˜ç¬¬äº”ä¸ªå‚æ•°15</span></span><br><span class="line"><span class="symbol">a8:</span>  <span class="number">48</span> <span class="number">89</span> c1          <span class="keyword">mov</span>    %rax,%rcx         <span class="comment">; rcxå¯„å­˜å™¨ï¼Œå­˜ç¬¬å››ä¸ªå‚æ•°xï¼Œxçš„å€¼åœ¨0x96æŒ‡ä»¤ä¸­è¢«å¤åˆ¶åˆ°äº†raxå¯„å­˜å™¨</span></span><br><span class="line"><span class="symbol">ab:</span>  ba <span class="number">03</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    <span class="keyword">mov</span>    <span class="number">$0</span>x3,%edx         <span class="comment">; rdxå¯„å­˜å™¨ï¼Œå­˜ç¬¬ä¸‰ä¸ªå‚æ•°3</span></span><br><span class="line"><span class="symbol">b0:</span>  be <span class="number">02</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    <span class="keyword">mov</span>    <span class="number">$0</span>x2,%esi         <span class="comment">; rsiå¯„å­˜å™¨ï¼Œå­˜ç¬¬äºŒä¸ªå‚æ•°2</span></span><br><span class="line"><span class="symbol">b5:</span>  bf 6c <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    <span class="keyword">mov</span>    <span class="number">$0</span>x6c,%edi        <span class="comment">; rdiå¯„å­˜å™¨ï¼Œå­˜ç¬¬ä¸€ä¸ªå‚æ•°&#x27;l&#x27;</span></span><br><span class="line"><span class="symbol">ba:</span>  e8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    callq  bf &lt;main+<span class="number">0x4d</span>&gt;    <span class="comment">; è°ƒç”¨calcæ–¹æ³•ï¼ŒcallæŒ‡ä»¤ä¼šæŠŠripå¯„å­˜å™¨é‡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€å‹æ ˆï¼Œä¿ç•™å‡½æ•°è°ƒç”¨ç»“æŸåè¦æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€ï¼Œç„¶åæŠŠè¢«è°ƒå‡½æ•°çš„åœ°å€æ›´æ–°åˆ°ripå¯„å­˜å™¨ä¸­å®ç°å‡½æ•°è·³è½¬</span></span><br><span class="line"><span class="symbol">bf:</span>  <span class="number">48</span> <span class="number">83</span> c4 <span class="number">10</span>       <span class="keyword">add</span>    <span class="number">$0</span>x10,%rsp        <span class="comment">; æ ˆé¡¶å‘ä¸Šç¼©å‡16ä¸ªå­—èŠ‚ï¼Œå³æ¢å¤pushç¬¬ä¸ƒä¸ªå‚æ•°+Paddingçš„16ä¸ªå­—èŠ‚ç©ºé—´</span></span><br><span class="line"><span class="symbol">c3:</span>  <span class="number">48</span> <span class="number">89</span> <span class="number">45</span> f8       <span class="keyword">mov</span>    %rax,-<span class="number">0x8</span>(%rbp)   <span class="comment">; å°†calcå‡½æ•°çš„è¿”å›å€¼èµ‹å€¼ç»™å˜é‡x</span></span><br><span class="line">		return x<span class="comment">;</span></span><br><span class="line"><span class="symbol">c7:</span>  <span class="number">48</span> 8b <span class="number">45</span> f8       <span class="keyword">mov</span>    -<span class="number">0x8</span>(%rbp),%rax   <span class="comment">; å°†å˜é‡xçš„å€¼å¤åˆ¶åˆ°raxå¯„å­˜å™¨ä½œä¸ºmainå‡½æ•°çš„è¿”å›å€¼</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="symbol">cb:</span>  c9                leaveq                   <span class="comment">; ç›¸å½“äº mov %rbp %rsp; pop %rbpï¼Œä¸å‡½æ•°å¼€å¤´çš„ push %rbp; mov %rsp, %rbp å¯¹åº”ã€‚å°†rbpçš„å€¼å¤åˆ¶åˆ°rspå¯„å­˜å™¨ï¼Œå³rspå’Œrbpæ­¤æ—¶éƒ½æŒ‡å‘å½“å‰å‡½æ•°çš„æ ˆåº•ï¼›å°†æ ˆé¡¶å…ƒç´ å‡ºæ ˆï¼Œå³ä¸Šä¸€æ ˆå¸§çš„æ ˆåº•åœ°å€èµ‹å€¼åˆ°rbpä¸­ï¼Œä¹Ÿå°±æ˜¯å°†rbpæŒ‡å‘callerçš„æ ˆåº•</span></span><br><span class="line"><span class="symbol">cc:</span>  c3                retq                     <span class="comment">; ç›¸å½“äº pop %ripï¼Œä¸callæŒ‡ä»¤çš„ push %rip å¯¹åº”ã€‚å°†æ ˆé¡¶å…ƒç´ å‡ºæ ˆï¼Œå³å°†è¿”å›åœ°å€çš„å€¼å¤åˆ¶åˆ°ripæŒ‡ä»¤åœ°å€å¯„å­˜å™¨ï¼Œä»¥å®ç°ç»§ç»­æ‰§è¡Œcallerä¸­çš„æŒ‡ä»¤</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">0000000000000000</span> &lt;calc&gt;:</span><br><span class="line">long calc(char a, short b, <span class="keyword">int</span> c, long d, long e, long f, long g) &#123;</span><br><span class="line"> <span class="number">0</span>:  <span class="number">55</span>                <span class="keyword">push</span>   %rbp              <span class="comment">; å°†mainå‡½æ•°æ ˆå¸§çš„rbpå€¼å‹æ ˆ</span></span><br><span class="line"> <span class="number">1</span>:  <span class="number">48</span> <span class="number">89</span> e5          <span class="keyword">mov</span>    %rsp,%rbp         <span class="comment">; mainå‡½æ•°è§£é‡Šè¿‡äº†</span></span><br><span class="line"> <span class="number">4</span>:  <span class="number">48</span> <span class="number">83</span> ec <span class="number">40</span>       <span class="keyword">sub</span>    <span class="number">$0</span>x40,%rsp        <span class="comment">;	æ ˆé¡¶å‘ä¸‹æ‰©å±•64ä¸ªå­—èŠ‚ï¼Œç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡å’Œå¯„å­˜å™¨ä¸­çš„å€¼</span></span><br><span class="line"> <span class="number">8</span>:  <span class="number">89</span> f0             <span class="keyword">mov</span>    %esi,%eax         <span class="comment">; 6ä¸ªç”¨äºä¼ å‚çš„å¯„å­˜å™¨å€¼æŒ‰é¡ºåºå‹æ ˆ</span></span><br><span class="line"><span class="symbol"> a:</span>  <span class="number">89</span> <span class="number">55</span> e4          <span class="keyword">mov</span>    %edx,-<span class="number">0x1c</span>(%rbp)</span><br><span class="line"><span class="symbol"> d:</span>  <span class="number">48</span> <span class="number">89</span> <span class="number">4d</span> d8       <span class="keyword">mov</span>    %rcx,-<span class="number">0x28</span>(%rbp)</span><br><span class="line"><span class="number">11</span>:  4c <span class="number">89</span> <span class="number">45</span> d0       <span class="keyword">mov</span>    %r8,-<span class="number">0x30</span>(%rbp)</span><br><span class="line"><span class="number">15</span>:  4c <span class="number">89</span> <span class="number">4d</span> c8       <span class="keyword">mov</span>    %r9,-<span class="number">0x38</span>(%rbp)</span><br><span class="line"><span class="number">19</span>:  <span class="number">40</span> <span class="number">88</span> <span class="number">7d</span> ec       <span class="keyword">mov</span>    %dil,-<span class="number">0x14</span>(%rbp)</span><br><span class="line"><span class="number">1d</span>:  <span class="number">66</span> <span class="number">89</span> <span class="number">45</span> e8       <span class="keyword">mov</span>    %ax,-<span class="number">0x18</span>(%rbp)</span><br><span class="line">		srand(time(NULL))<span class="comment">;</span></span><br><span class="line"><span class="number">21</span>:  bf <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    <span class="keyword">mov</span>    <span class="number">$0</span>x0,%edi         <span class="comment">; rdiå¯„å­˜å™¨èµ‹å€¼ä¸º0ï¼Œå¯¹åº”NULL</span></span><br><span class="line"><span class="number">26</span>:  e8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    callq  2b &lt;calc+<span class="number">0x2b</span>&gt;</span><br><span class="line">2b:  <span class="number">89</span> c7             <span class="keyword">mov</span>    %eax,%edi</span><br><span class="line"><span class="number">2d</span>:  e8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    callq  <span class="number">32</span> &lt;calc+<span class="number">0x32</span>&gt;</span><br><span class="line">		<span class="keyword">int</span> h = rand()<span class="comment">;</span></span><br><span class="line"><span class="number">32</span>:  e8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    callq  <span class="number">37</span> &lt;calc+<span class="number">0x37</span>&gt;</span><br><span class="line"><span class="number">37</span>:  <span class="number">89</span> <span class="number">45</span> fc          <span class="keyword">mov</span>    %eax,-<span class="number">0x4</span>(%rbp)   <span class="comment">; randå‡½æ•°è¿”å›å€¼èµ‹å€¼åˆ°æ ˆåœ°å€[rbp - 4, rbp]</span></span><br><span class="line">		return a + b + c + d + e + f + g + h<span class="comment">;</span></span><br><span class="line">3a:  0f be <span class="number">55</span> ec       movsbl -<span class="number">0x14</span>(%rbp),%edx  <span class="comment">; å°†å˜é‡açš„å€¼1å­—èŠ‚å¸¦ç¬¦å·æ‰©å±•æˆ4å­—èŠ‚ï¼Œå¹¶å­˜åˆ°rdxå¯„å­˜å™¨</span></span><br><span class="line">3e:  0f bf <span class="number">45</span> e8       movswl -<span class="number">0x18</span>(%rbp),%eax  <span class="comment">; å°†å˜é‡bçš„å€¼2å­—èŠ‚å¸¦ç¬¦å·æ‰©å±•æˆ4å­—èŠ‚ï¼Œå¹¶å­˜åˆ°raxå¯„å­˜å™¨</span></span><br><span class="line"><span class="number">42</span>:  <span class="number">01</span> c2             <span class="keyword">add</span>    %eax,%edx         <span class="comment">; rdx = rax + rdx</span></span><br><span class="line"><span class="number">44</span>:  8b <span class="number">45</span> e4          <span class="keyword">mov</span>    -<span class="number">0x1c</span>(%rbp),%eax  <span class="comment">; å°†å˜é‡cçš„å€¼å¤åˆ¶åˆ°raxå¯„å­˜å™¨</span></span><br><span class="line"><span class="number">47</span>:  <span class="number">01</span> d0             <span class="keyword">add</span>    %edx,%eax         <span class="comment">; rax = rdx + rax</span></span><br><span class="line"><span class="number">49</span>:  <span class="number">48</span> <span class="number">63</span> d0          movslq %eax,%rdx         <span class="comment">; å°†raxä¸­çš„4å­—èŠ‚å¸¦ç¬¦å·æ‰©å±•æˆ8å­—èŠ‚ï¼Œå¹¶å­˜åˆ°rdxå¯„å­˜å™¨</span></span><br><span class="line">4c:  <span class="number">48</span> 8b <span class="number">45</span> d8       <span class="keyword">mov</span>    -<span class="number">0x28</span>(%rbp),%rax  <span class="comment">; å°†å˜é‡dçš„å€¼å¤åˆ¶åˆ°raxå¯„å­˜å™¨</span></span><br><span class="line"><span class="number">50</span>:  <span class="number">48</span> <span class="number">01</span> c2          <span class="keyword">add</span>    %rax,%rdx         <span class="comment">; rdx = rax + rdx</span></span><br><span class="line"><span class="number">53</span>:  <span class="number">48</span> 8b <span class="number">45</span> d0       <span class="keyword">mov</span>    -<span class="number">0x30</span>(%rbp),%rax  <span class="comment">; å°†å˜é‡eçš„å€¼å¤åˆ¶åˆ°raxå¯„å­˜å™¨</span></span><br><span class="line"><span class="number">57</span>:  <span class="number">48</span> <span class="number">01</span> c2          <span class="keyword">add</span>    %rax,%rdx         <span class="comment">; rdx = rax + rdx</span></span><br><span class="line">5a:  <span class="number">48</span> 8b <span class="number">45</span> c8       <span class="keyword">mov</span>    -<span class="number">0x38</span>(%rbp),%rax  <span class="comment">; å°†å˜é‡fçš„å€¼å¤åˆ¶åˆ°raxå¯„å­˜å™¨</span></span><br><span class="line">5e:  <span class="number">48</span> <span class="number">01</span> c2          <span class="keyword">add</span>    %rax,%rdx         <span class="comment">; rdx = rax + rdx</span></span><br><span class="line"><span class="number">61</span>:  <span class="number">48</span> 8b <span class="number">45</span> <span class="number">10</span>       <span class="keyword">mov</span>    <span class="number">0x10</span>(%rbp),%rax   <span class="comment">; å°†å˜é‡gçš„å€¼ï¼ˆåœ¨callerçš„æ ˆå¸§ä¸­ï¼‰å¤åˆ¶åˆ°raxå¯„å­˜å™¨</span></span><br><span class="line"><span class="number">65</span>:  <span class="number">48</span> <span class="number">01</span> c2          <span class="keyword">add</span>    %rax,%rdx         <span class="comment">; rdx = rax + rdx</span></span><br><span class="line"><span class="number">68</span>:  8b <span class="number">45</span> fc          <span class="keyword">mov</span>    -<span class="number">0x4</span>(%rbp),%eax   <span class="comment">; å°†å±€éƒ¨å˜é‡hçš„å€¼å¤åˆ¶åˆ°eaxå¯„å­˜å™¨</span></span><br><span class="line">6b:  <span class="number">48</span> <span class="number">98</span>             cltq                     <span class="comment">; å°†eaxçš„å€¼å¸¦ç¬¦å·æ‰©å±•æˆ8å­—èŠ‚å­˜åˆ°raxå¯„å­˜å™¨</span></span><br><span class="line"><span class="number">6d</span>:  <span class="number">48</span> <span class="number">01</span> d0          <span class="keyword">add</span>    %rdx,%rax         <span class="comment">; rax = rbx + rax</span></span><br><span class="line"></span><br><span class="line"><span class="number">70</span>:  c9                leaveq                   <span class="comment">; mainå‡½æ•°è§£é‡Šè¿‡äº†</span></span><br><span class="line"><span class="number">71</span>:  c3                retq                     <span class="comment">; mainå‡½æ•°è§£é‡Šè¿‡äº†</span></span><br></pre></td></tr></table></figure>

<h5 id="x86-64å¸¸ç”¨æŒ‡ä»¤"><a href="#x86-64å¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="x86_64å¸¸ç”¨æŒ‡ä»¤"></a>x86_64å¸¸ç”¨æŒ‡ä»¤</h5><h5 id="ç›¸å…³çŸ¥è¯†å»¶å±•"><a href="#ç›¸å…³çŸ¥è¯†å»¶å±•" class="headerlink" title="ç›¸å…³çŸ¥è¯†å»¶å±•"></a>ç›¸å…³çŸ¥è¯†å»¶å±•</h5><h6 id="å‡½æ•°å†…è”ä¼˜åŠ£"><a href="#å‡½æ•°å†…è”ä¼˜åŠ£" class="headerlink" title="å‡½æ•°å†…è”ä¼˜åŠ£"></a>å‡½æ•°å†…è”ä¼˜åŠ£</h6><p>å¦‚æœè¢«è°ƒå‡½æ•°ä¸­æ²¡æœ‰å†è°ƒç”¨å…¶ä»–å‡½æ•°ï¼ˆè¿™ç§å‡½æ•°é€šå¸¸è¢«ç§°ä¸ºå¶å­å‡½æ•°ï¼‰ï¼Œå¯ä»¥é€šè¿‡å°†è¢«è°ƒå‡½æ•°æŒ‡ä»¤ç›´æ¥æ›¿æ¢åˆ°è°ƒç”¨å¤„æ¥å®ç°å‡½æ•°è°ƒç”¨çš„ã€‚è¿™ä¹Ÿæ˜¯å¸¸è§çš„ç¼–è¯‘å™¨è‡ªåŠ¨ä¼˜åŒ–çš„æ‰‹æ®µï¼Œå«åš<strong>å‡½æ•°å†…è”ï¼ˆInlineï¼‰</strong>ã€‚é™¤äº†é ç¼–è¯‘å™¨è‡ªåŠ¨ä¼˜åŒ–ï¼Œä¹Ÿå¯ä»¥åœ¨å‡½æ•°å®šä¹‰å‰åŠ ä¸Šinlineå…³é”®å­—ï¼Œæ¥æç¤ºç¼–è¯‘å™¨å¯¹å‡½æ•°è¿›è¡Œå†…è”ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€æ®µä»£ç </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    srand(time(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="type">int</span> x = rand() % <span class="number">3</span>;</span><br><span class="line">    <span class="type">int</span> y = rand() % <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">return</span> add(x, y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>gcc -O</code>ç¼–è¯‘å‡ºæ¥çš„æ±‡ç¼–ä»£ç ï¼Œå¹¶æ²¡æœ‰æŠŠaddå‡½æ•°å•ç‹¬ç¼–è¯‘æˆä¸€æ®µæŒ‡ä»¤é¡ºåºï¼Œè€Œæ˜¯åœ¨è°ƒç”¨<code>add(x, y)</code>çš„æ—¶å€™ï¼Œç›´æ¥æ›¿æ¢æˆäº†ä¸€ä¸ªaddæŒ‡ä»¤</p>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line">      <span class="number">6d</span>: <span class="number">01</span> c8                         addl    %ecx, %eax</span><br><span class="line"><span class="comment">;     return a + b;</span></span><br><span class="line">      6f: <span class="number">01</span> d8                         addl    %ebx, %eax</span><br></pre></td></tr></table></figure>

<p>å†…è”å¯ä»¥å‡å°‘å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­ä¿å­˜å¯„å­˜å™¨å€¼ï¼Œæ•°æ®å‹æ ˆå‡ºæ ˆç­‰å¼€é”€ï¼Œæå‡è°ƒç”¨æ€§èƒ½ã€‚</p>
<p>ä¸è¿‡è¿™ä¹Ÿæ˜¯æœ‰ä»£ä»·çš„ï¼Œå†…è”æŠŠå¯ä»¥å¤ç”¨çš„æŒ‡ä»¤åœ¨è°ƒç”¨å®ƒçš„åœ°æ–¹å®Œå…¨å±•å¼€äº†ï¼Œè¿™å°±ä¼šå¯¼è‡´ç¨‹åºçš„ä»£ç æ®µæŒ‡ä»¤æ•°å¢åŠ ï¼Œå ç”¨ç©ºé—´å˜å¤§ã€‚</p>
<h6 id="Stack-Overflow"><a href="#Stack-Overflow" class="headerlink" title="Stack Overflow"></a>Stack Overflow</h6><p>ä¸€èˆ¬æ˜¯ç”±äºé€’å½’è°ƒç”¨ï¼Œæˆ–è°ƒç”¨é“¾è¿‡æ·±ï¼Œæˆ–åœ¨æ ˆç©ºé—´é‡Œåˆ›å»ºéå¸¸å å†…å­˜çš„å˜é‡ï¼ˆæ¯”å¦‚ä¸€ä¸ªå·¨å¤§çš„æ•°ç»„ï¼‰å¯¼è‡´çš„ã€‚</p>
<ol>
<li>Linuxï¼šé»˜è®¤æ ˆç©ºé—´å¤§å°ä¸º8MiBï¼Œåœ¨task_structåˆ›å»ºæ—¶ï¼ˆLinuxä¸åŒºåˆ†è¿›ç¨‹å’Œçº¿ç¨‹ï¼‰allocå¹¶memsetä¸º0ï¼Œå…·ä½“ä»£ç è§<a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/kernel/fork.c.html#alloc_thread_stack_node">alloc_thread_stack_node</a>ã€‚</li>
<li>JVMï¼šé»˜è®¤æ ˆç©ºé—´å¤§å°ä¸º1MiBï¼Œå¯ä»¥ç”±<code>-Xss</code>æŒ‡å®š</li>
<li>Goï¼šgoroutineåˆå§‹æ ˆç©ºé—´å¤§å°ä¸º2Kibï¼Œä¸Šé™å–å†³äºæ“ä½œç³»ç»Ÿä½æ•°ï¼Œ<a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/golang/go/blob/f296b7a6f045325a230f77e9bda1470b1270f817/src/runtime/proc.go#L120">64ä½ä¸º1GiBï¼Œ32ä½ä¸º250MiB</a></li>
<li>Pythonï¼šæ²¡æœ‰é™åˆ¶æ ˆç©ºé—´ï¼Œä¸è¿‡æœ‰æœ€å¤§é€’å½’è°ƒç”¨æ¬¡æ•°é™åˆ¶ï¼Œå¯ä»¥é€šè¿‡<code>sys.getrecursionlimit()</code>è·å–ï¼Œé»˜è®¤ä¸º1000</li>
</ol>
<h6 id="æ ˆæº¢å‡ºæ”»å‡»"><a href="#æ ˆæº¢å‡ºæ”»å‡»" class="headerlink" title="æ ˆæº¢å‡ºæ”»å‡»"></a>æ ˆæº¢å‡ºæ”»å‡»</h6><blockquote>
<p>æ ˆæº¢å‡ºåˆ©ç”¨ç¨‹åºçš„æ¼æ´ï¼Œé€šè¿‡æ„é€ ç²¾å¿ƒè®¾è®¡çš„æ•°æ®ï¼Œæ¥è¦†ç›–å‡½æ•°çš„è¿”å›åœ°å€ï¼Œè¿›è€Œæ‰“ä¹±åŸæœ‰å‡½æ•°æ‰§è¡Œæµç¨‹ï¼Œè·³å…¥é»‘å®¢é¢„å…ˆè®¾è®¡å¥½çš„æ¶æ„ä»£ç ä¸­ã€‚</p>
</blockquote>
<p>æ ˆæº¢å‡ºæ”»å‡»åŸºäºä»¥ä¸‹å‡ ä¸ªåŸç†ï¼š</p>
<ol>
<li>å‡½æ•°æ ˆå¸§ä¿å­˜äº†å‡½æ•°è°ƒç”¨è¿”å›åä¸‹ä¸€æ¡å¾…æ‰§è¡ŒæŒ‡ä»¤çš„å†…å­˜åœ°å€</li>
<li>ç¨‹åºçš„ä»£ç å’Œæ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œç›´æ¥ä»å†…å­˜çš„äºŒè¿›åˆ¶å½¢å¼ä¸Šæ˜¯æ— æ³•åŒºåˆ†å“ªäº›æ˜¯æ•°æ®å“ªäº›æ˜¯ä»£ç </li>
<li>å±€éƒ¨å˜é‡å­˜å‚¨åœ¨æ ˆä¸­ï¼Œå¦‚æœå±€éƒ¨å˜é‡æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆé€šè¿‡æ„é€ ä¸€ä¸ªæº¢å‡ºå½“å‰æ ˆå¸§çš„æ•°æ®ï¼Œå°±æœ‰å¯èƒ½è¦†ç›–ä¸Šä¸€æ ˆå¸§çš„å‡½æ•°è¿”å›åœ°å€ï¼Œè¿›è€Œè·³è½¬æ‰§è¡Œæ¶æ„ä»£ç </li>
</ol>
<p>ä¾‹å¦‚ä¸‹é¢è¿™æ®µä»£ç </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">counter</span><span class="params">(<span class="type">char</span> *data, <span class="type">char</span> c)</span> &#123;</span><br><span class="line">  <span class="type">char</span> buffer[BUF_LEN];</span><br><span class="line">  <span class="built_in">strcpy</span>(buffer, data);</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„æ ˆæº¢å‡ºä»£ç ï¼Œä½¿ç”¨äº†ä¸å®‰å…¨çš„<code>strcpy</code>å‡½æ•°ï¼Œç³»ç»Ÿä¼šç›²ç›®çš„å°†dataçš„å…¨éƒ¨æ•°æ®æ‹·è´åˆ°æ ˆç©ºé—´çš„bufferä¸Šï¼Œè€Œbufferçš„é•¿åº¦æ˜¯æœ‰é™çš„ï¼Œä¸€æ—¦dataçš„æ•°æ®é•¿åº¦è¶…è¿‡BUF_LENï¼Œå°±ä¼šäº§ç”Ÿæ ˆæº¢å‡ºã€‚</p>
<img src="https://cdn.leosocy.top/img/dinosaurloading.gif" data-lazy-src="https://cdn.leosocy.top/img/20210409011416.png" style="zoom: 33%;">

<p>åŸºæœ¬åŸç†å°±å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä½†å®é™…ä¸Šç›´æ¥ä¿®æ”¹å‡½æ•°è¿”å›åœ°å€å°†å…¶æŒ‡å‘æ¶æ„ä»£ç æ˜¯å¾ˆéš¾å®ç°çš„ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿæ¯æ¬¡åŠ è½½å¯æ‰§è¡Œæ–‡ä»¶åˆ°è¿›ç¨‹ç©ºé—´çš„ä½ç½®éƒ½ä¸æ˜¯å›ºå®šçš„ï¼Œå› æ­¤æ ˆçš„ä½ç½®å®é™…æ˜¯ä¸å›ºå®šçš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰äº†é€šè¿‡è·³æ¿(<code>jmp esp</code>)è¿›è¡Œæ ˆæº¢å‡ºçš„æ–¹å¼ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹<a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.jianshu.com/p/47d484b9227e">è¿™ç¯‡æ–‡ç« </a>ã€‚</p>
<blockquote>
<p> æ ˆæº¢å‡ºæ”»å‡»çš„é˜²æŠ¤</p>
</blockquote>
<ol>
<li>æ ˆä¸å¯æ‰§è¡Œï¼šåˆ©ç”¨cpuç¡¬ä»¶çš„ç‰¹æ€§ï¼Œå°†æ ˆè®¾ç½®ä¸ºä¸å¯æ‰§è¡Œï¼Œç¦æ­¢æ‰§è¡Œæ ˆä¸Šçš„æ•°æ®</li>
<li>æ ˆä¿æŠ¤ï¼šç¼–è¯‘æ—¶æ‰“å¼€æ ˆä¿æŠ¤å¼€å…³ï¼Œåˆ™ä¼šåœ¨å‡½æ•°çš„è¿›å…¥å’Œè¿”å›çš„åœ°æ–¹å¢åŠ ä¸€äº›æ£€æµ‹æŒ‡ä»¤ï¼Œåœ¨æ•°æ®è¢«ä¿®æ”¹æ—¶ç»ˆæ­¢ç¨‹åºè¿è¡Œ</li>
<li>å†…å­˜å¸ƒå±€éšæœºåŒ–ï¼šå°†ç¨‹åºçš„åŠ è½½ä½ç½®ã€å †æ ˆä½ç½®ä»¥åŠåŠ¨æ€é“¾æ¥åº“çš„æ˜ å°„ä½ç½®éšæœºåŒ–</li>
</ol>
<h6 id="å°¾é€’å½’ä¼˜åŒ–"><a href="#å°¾é€’å½’ä¼˜åŒ–" class="headerlink" title="å°¾é€’å½’ä¼˜åŒ–"></a>å°¾é€’å½’ä¼˜åŒ–</h6><p>å°¾é€’å½’æ˜¯æŒ‡åœ¨ä¸€ä¸ªæ–¹æ³•å†…éƒ¨ï¼Œé€’å½’è°ƒç”¨åç›´æ¥returnï¼Œæ²¡æœ‰ä»»ä½•å¤šä½™çš„æŒ‡ä»¤ã€‚ä»å‡½æ•°æ ˆå¸§è§’åº¦æ¥æƒ³ï¼Œå½“å‰æ ˆå¸§çš„æ‰€æœ‰æ•°æ®åœ¨å‘ç”Ÿé€’å½’è°ƒç”¨åéƒ½å·²ç»æ— ç”¨äº†ï¼Œæ­¤æ—¶å°±æ— éœ€å°†å…¶ä¿å­˜åˆ°å½“å‰æ ˆå¸§ï¼Œåªéœ€å°†å‚æ•°å­˜å…¥æŒ‡å®šå¯„å­˜å™¨ï¼Œgotoåˆ°å‡½æ•°å¼€å§‹çš„æŒ‡ä»¤ç»§ç»­æ‰§è¡Œå°±å¥½äº†ã€‚</p>
<p>æ¯”å¦‚ä¸‹é¢è¿™ç§æ±‚é˜¶ä¹˜çš„å†™æ³•å°±ä¸æ˜¯ä¸€ä¸ªå°¾é€’å½’ï¼Œå› ä¸ºå‡½æ•°è°ƒç”¨ç»“æŸåè¿˜è¦æ‹¿åˆ°ç»“æœè®¡ç®—ä¹˜æ³•</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">factorial</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (n == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> n * factorial(n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è€Œæ”¹å†™æˆä¸‹é¢è¿™ç§å†™æ³•å°±å¯ä»¥è¿›è¡Œå°¾é€’å½’ä¼˜åŒ–</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">factorial</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> sum)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (n == <span class="number">1</span>) <span class="keyword">return</span> sum + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> factorial(n - <span class="number">1</span>, sum + n)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="åç¨‹çš„å‡½æ•°æ ˆåˆ‡æ¢"><a href="#åç¨‹çš„å‡½æ•°æ ˆåˆ‡æ¢" class="headerlink" title="åç¨‹çš„å‡½æ•°æ ˆåˆ‡æ¢"></a>åç¨‹çš„å‡½æ•°æ ˆåˆ‡æ¢</h6><h4 id="ä»CPUæŒ‡ä»¤å±‚é¢ç†è§£ä¸€äº›é—®é¢˜"><a href="#ä»CPUæŒ‡ä»¤å±‚é¢ç†è§£ä¸€äº›é—®é¢˜" class="headerlink" title="ä»CPUæŒ‡ä»¤å±‚é¢ç†è§£ä¸€äº›é—®é¢˜"></a>ä»CPUæŒ‡ä»¤å±‚é¢ç†è§£ä¸€äº›é—®é¢˜</h4><h5 id="LLVM"><a href="#LLVM" class="headerlink" title="LLVM"></a>LLVM</h5><h5 id="æ··æ·†ç¼–è¯‘"><a href="#æ··æ·†ç¼–è¯‘" class="headerlink" title="æ··æ·†ç¼–è¯‘"></a>æ··æ·†ç¼–è¯‘</h5><h5 id="Compare-And-SwapåŸå­æ“ä½œ"><a href="#Compare-And-SwapåŸå­æ“ä½œ" class="headerlink" title="Compare And SwapåŸå­æ“ä½œ"></a>Compare And SwapåŸå­æ“ä½œ</h5><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dslztx.github.io/blog/2020/01/14/CAS/">https://dslztx.github.io/blog/2020/01/14/CAS/</a></p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dslztx.github.io/blog/2019/06/08/%E6%B1%87%E7%BC%96%E6%8C%87%E4%BB%A4%E7%9A%84LOCK%E6%8C%87%E4%BB%A4%E5%89%8D%E7%BC%80/">https://dslztx.github.io/blog/2019/06/08/%E6%B1%87%E7%BC%96%E6%8C%87%E4%BB%A4%E7%9A%84LOCK%E6%8C%87%E4%BB%A4%E5%89%8D%E7%BC%80/</a></p>
<h5 id="è¶…çº¿ç¨‹-hyperthreading"><a href="#è¶…çº¿ç¨‹-hyperthreading" class="headerlink" title="è¶…çº¿ç¨‹ hyperthreading"></a>è¶…çº¿ç¨‹ hyperthreading</h5><blockquote>
<p>ç°ä»£CPUä¸€èˆ¬å£°ç§°æœ‰4æ ¸8çº¿ç¨‹ã€8æ ¸16çº¿ç¨‹ç­‰ï¼Œè¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p>
</blockquote>
<p>è€ƒè™‘åˆ°CPUåŒå†…å­˜ã€IOè®¾å¤‡ä¹‹é—´å­˜å–é€Ÿåº¦çš„ä¸¥é‡ä¸åŒ¹é…ï¼Œå‡ºç°äº†ä¹±åºæ‰§è¡Œã€åˆ†æ”¯é¢„æµ‹ç­‰ä¼˜åŒ–è®©CPUåˆ©ç”¨æ•°æ®è£…è½½ç­‰å¾…çš„æ—¶é—´ï¼Œå°½é‡å¤šçš„æ‰§è¡Œåé¢çš„æŒ‡ä»¤ã€‚ä½†æ˜¯æŸäº›æŒ‡ä»¤å¿…é¡»è¦ç­‰åˆ°æ•°æ®åŠ è½½å®Œæˆæ‰èƒ½æ‰§è¡Œï¼Œæ¯”å¦‚æ•°å€¼æ±‚å’Œæ¯”è¾ƒç­‰ï¼Œæ­¤æ—¶CPUä»æœ‰å¤§é‡ç©ºé—²æ—¶é—´æµªè´¹ã€‚</p>
<p>ä¸ºäº†æé«˜CPUçš„åˆ©ç”¨ç‡ï¼Œèªæ˜çš„å·¥ç¨‹å¸ˆä»¬æƒ³åˆ°äº†åœ¨CPUä¸­é¢å¤–å¢åŠ ä¸€ç»„å¯„å­˜å™¨ï¼Œè¿™æ ·å¯ä»¥ä¸è¦†ç›–å½“å‰çº¿ç¨‹çš„å¯„å­˜å™¨æ•°æ®ï¼ŒåŒæ—¶æ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹çš„æŒ‡ä»¤ï¼Œæœ€å¤§ç¨‹åº¦çš„åˆ©ç”¨è®¡ç®—å•å…ƒï¼Œåœ¨å¯æ§çš„æˆæœ¬å†…ï¼ˆæ²¡æœ‰å¢åŠ ALUç­‰è¿ç®—å•å…ƒï¼‰æå‡äº†CPUåˆ©ç”¨ç‡ï¼Œè¿™å°±æ˜¯è¶…çº¿ç¨‹ã€‚</p>
<h5 id="æœ‰è¶£çš„ä¼˜åŒ–"><a href="#æœ‰è¶£çš„ä¼˜åŒ–" class="headerlink" title="æœ‰è¶£çš„ä¼˜åŒ–"></a>æœ‰è¶£çš„ä¼˜åŒ–</h5><ol>
<li><p>ä¸ºä»€ä¹ˆå°†å¾ªç¯æ±‚å’Œçš„ç»“æœæ”¾åˆ°ä¸€ä¸ªå±€éƒ¨å˜é‡ä¸­ï¼Œä¼šæ¯”å°†å…¶æ”¾åˆ°ä¸€ä¸ªé€šè¿‡æŒ‡é’ˆä¼ é€’è¿‡æ¥çš„å‚æ•°ä¸­ï¼Œè¿è¡Œèµ·æ¥æ›´å¿«å‘¢ï¼Ÿ</p>
<ol>
<li>æ”¾åˆ°å±€éƒ¨å˜é‡ç›¸å½“äºå°†ç»“æœä¿å­˜åœ¨<code>rax</code>å¯„å­˜å™¨ä¸­ï¼›è€Œæ”¾åˆ°æŒ‡é’ˆä¼ é€’è¿‡æ¥çš„å‚æ•°ç›¸å½“äºæ¯æ¬¡éƒ½è¦å…ˆæ ¹æ®å†…å­˜åœ°å€è¯»å–ä¸Šä¸€ä¸ªæ ˆå¸§ä¸­çš„å†…å­˜æ•°æ®åˆ°å¯„å­˜å™¨ï¼Œæ±‚å’Œä¹‹åå†æŠŠå¯„å­˜å™¨çš„å€¼ä¿å­˜å›å†…å­˜ä¸­ã€‚CPUæ“ä½œå¯„å­˜å™¨ç›¸æ¯”äºå†…å­˜è€—æ—¶ä¸åœ¨ä¸€ä¸ªé‡çº§ã€‚</li>
</ol>
</li>
<li></li>
</ol>
<h3 id="CPUè¿ç®—"><a href="#CPUè¿ç®—" class="headerlink" title="CPUè¿ç®—"></a>CPUè¿ç®—</h3><h4 id="ç®—æœ¯é€»è¾‘å•å…ƒï¼ˆALU-Arithmetic-Logic-Unitï¼‰"><a href="#ç®—æœ¯é€»è¾‘å•å…ƒï¼ˆALU-Arithmetic-Logic-Unitï¼‰" class="headerlink" title="ç®—æœ¯é€»è¾‘å•å…ƒï¼ˆALU Arithmetic Logic Unitï¼‰"></a>ç®—æœ¯é€»è¾‘å•å…ƒï¼ˆALU Arithmetic Logic Unitï¼‰</h4><h5 id="é—¨ç”µè·¯"><a href="#é—¨ç”µè·¯" class="headerlink" title="é—¨ç”µè·¯"></a>é—¨ç”µè·¯</h5><img src="https://cdn.leosocy.top/img/dinosaurloading.gif" data-lazy-src="https://cdn.leosocy.top/img/20210402014630.png" style="zoom: 33%;">

<p>å¼‚æˆ–ï¼š<code>A XOR B = (A &amp; ~B) | (~A &amp; B)</code></p>
<img src="https://cdn.leosocy.top/img/dinosaurloading.gif" data-lazy-src="https://cdn.leosocy.top/img/20210402014901.png" style="zoom:33%;">

<h5 id="åŠ æ³•å™¨"><a href="#åŠ æ³•å™¨" class="headerlink" title="åŠ æ³•å™¨"></a>åŠ æ³•å™¨</h5><p>äºŒè¿›åˆ¶çš„åŠ æ³•ä¸åè¿›åˆ¶åŠ æ³•æœ¬è´¨ä¸Šå¹¶æ— å·®å¼‚ï¼Œåªä¸è¿‡äºŒè¿›åˆ¶æ˜¯é€¢2è¿›1ã€‚æ‹¿ä¸ªä½ä¸¾ä¾‹ï¼Œæœ‰4ç§ç»„åˆï¼Œ00/01/10/11ï¼Œ00å’Œ11ä¸ªä½ç›¸åŠ çš„ç»“æœä¸º0ï¼Œ01å’Œ10ä¸ªä½ç›¸åŠ ç»“æœä¸º1ï¼Œè¿™ä¸ªè¾“å…¥å’Œè¾“å‡ºçš„å…³ç³»å°±æ˜¯<em>å¼‚æˆ–é—¨</em>è®¡ç®—é€»è¾‘ï¼›åŒæ—¶å¯¹äº11ç›¸åŠ åéœ€è¦å‘ä¸Šä¸€ä½è¿›ä½ï¼Œä¹Ÿå°±æ˜¯<em>ä¸é—¨</em>è®¡ç®—é€»è¾‘ã€‚</p>
<p>æ‰€ä»¥é€šè¿‡ä¸€ä¸ªå¼‚æˆ–é—¨è®¡ç®—å‡ºä¸ªä½ï¼Œé€šè¿‡ä¸€ä¸ªä¸é—¨è®¡ç®—å‡ºæ˜¯å¦è¿›ä½ï¼Œå°±é€šè¿‡ç”µè·¯ç®—å‡ºäº†ä¸€ä¸ªä¸€ä½æ•°çš„åŠ æ³•ã€‚</p>
<img src="https://cdn.leosocy.top/img/dinosaurloading.gif" data-lazy-src="https://cdn.leosocy.top/img/20210409011059.png" style="zoom:33%;">

<p>ä¹‹æ‰€ä»¥å«åŠåŠ å™¨æ˜¯å› ä¸ºè¿™é‡Œåªèƒ½å¤„ç†ä¸ªä½åŠ æ³•ï¼Œå¯¹äºäºŒä½çš„åŠ æ³•é™¤äº†åŠ æ•°å’Œè¢«åŠ æ•°ä¹‹å¤–ï¼Œè¿˜è¦åŠ ä¸Šæ¥è‡ªä¸ªä½çš„è¿›ä½ä¿¡å·ï¼Œä¸€å…±éœ€è¦3ä¸ªbitè¿›è¡Œç›¸åŠ ã€‚è¦æƒ³å®ç°3ä¸ªæ•°ç›¸åŠ ï¼Œå¯ä»¥é€šè¿‡ç»„åˆ2ä¸ªåŠåŠ å™¨å’Œ1ä¸ªæˆ–é—¨ç»„æˆä¸€ä¸ª<em>å…¨åŠ å™¨</em>ã€‚</p>
<img src="https://cdn.leosocy.top/img/dinosaurloading.gif" data-lazy-src="https://cdn.leosocy.top/img/20210409014052.png" style="zoom:33%;">

<h6 id="åŠ æ³•å™¨ä¼˜åŒ–"><a href="#åŠ æ³•å™¨ä¼˜åŒ–" class="headerlink" title="åŠ æ³•å™¨ä¼˜åŒ–"></a>åŠ æ³•å™¨ä¼˜åŒ–</h6><h5 id="ä¹˜æ³•å™¨"><a href="#ä¹˜æ³•å™¨" class="headerlink" title="ä¹˜æ³•å™¨"></a>ä¹˜æ³•å™¨</h5><h5 id="å‡æ³•è¿ç®—"><a href="#å‡æ³•è¿ç®—" class="headerlink" title="å‡æ³•è¿ç®—"></a>å‡æ³•è¿ç®—</h5><h6 id="ä¸ºä»€ä¹ˆå‡æ³•å™¨æ•ˆç‡ä½"><a href="#ä¸ºä»€ä¹ˆå‡æ³•å™¨æ•ˆç‡ä½" class="headerlink" title="ä¸ºä»€ä¹ˆå‡æ³•å™¨æ•ˆç‡ä½"></a>ä¸ºä»€ä¹ˆå‡æ³•å™¨æ•ˆç‡ä½</h6><h6 id="ä¸ºä»€ä¹ˆè´Ÿæ•°çš„è¡¥ç è¦æŒ‰ä½å–åå¹¶åŠ 1ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè´Ÿæ•°çš„è¡¥ç è¦æŒ‰ä½å–åå¹¶åŠ 1ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè´Ÿæ•°çš„è¡¥ç è¦æŒ‰ä½å–åå¹¶åŠ 1ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè´Ÿæ•°çš„è¡¥ç è¦æŒ‰ä½å–åå¹¶åŠ 1ï¼Ÿ</h6><h5 id="æµ®ç‚¹è¿ç®—"><a href="#æµ®ç‚¹è¿ç®—" class="headerlink" title="æµ®ç‚¹è¿ç®—"></a>æµ®ç‚¹è¿ç®—</h5><h4 id="æå‡CPUåˆ©ç”¨ç‡"><a href="#æå‡CPUåˆ©ç”¨ç‡" class="headerlink" title="æå‡CPUåˆ©ç”¨ç‡"></a>æå‡CPUåˆ©ç”¨ç‡</h4><h5 id="æµæ°´çº¿"><a href="#æµæ°´çº¿" class="headerlink" title="æµæ°´çº¿"></a>æµæ°´çº¿</h5><h5 id="ä¹±åºæ‰§è¡Œ"><a href="#ä¹±åºæ‰§è¡Œ" class="headerlink" title="ä¹±åºæ‰§è¡Œ"></a>ä¹±åºæ‰§è¡Œ</h5><p>å¥½å¤„ï¼šå¯ä»¥å……åˆ†åˆ©ç”¨CPUï¼Œåœ¨ç­‰å¾…å†…å­˜æ“ä½œè¿”å›çš„åŒæ—¶ï¼Œæ‰§è¡Œå…¶ä»–æŒ‡ä»¤</p>
<h5 id="åˆ†æ”¯é¢„æµ‹"><a href="#åˆ†æ”¯é¢„æµ‹" class="headerlink" title="åˆ†æ”¯é¢„æµ‹"></a>åˆ†æ”¯é¢„æµ‹</h5><h6 id="Linuxä¸­çš„likely-unlikely"><a href="#Linuxä¸­çš„likely-unlikely" class="headerlink" title="Linuxä¸­çš„likely/unlikely"></a>Linuxä¸­çš„<code>likely/unlikely</code></h6><h5 id="å¹¶è¡Œè®¡ç®—ï¼šSIMD"><a href="#å¹¶è¡Œè®¡ç®—ï¼šSIMD" class="headerlink" title="å¹¶è¡Œè®¡ç®—ï¼šSIMD"></a>å¹¶è¡Œè®¡ç®—ï¼šSIMD</h5><h5 id="ä¸€äº›æœ‰è¶£å°ğŸŒ°"><a href="#ä¸€äº›æœ‰è¶£å°ğŸŒ°" class="headerlink" title="ä¸€äº›æœ‰è¶£å°ğŸŒ°"></a>ä¸€äº›æœ‰è¶£å°ğŸŒ°</h5><ul>
<li>æ‰¾å‡ºä¸€ä¸ªæ•°ç»„ä¸­å°äºæŸæ•°xçš„ä¸ªæ•°ã€‚æ’åºåçš„æ•°ç»„è¿è¡Œæ›´å¿«</li>
<li>ä¸¤ä¸ªforå¾ªç¯åµŒå¥—ï¼Œå¾ªç¯æ¬¡æ•°å¤šçš„å†™é‡Œé¢</li>
</ul>
<h3 id="å†…å­˜"><a href="#å†…å­˜" class="headerlink" title="å†…å­˜"></a>å†…å­˜</h3><h4 id="MMUä¸TLB"><a href="#MMUä¸TLB" class="headerlink" title="MMUä¸TLB"></a>MMUä¸TLB</h4><h4 id="M-Modified-E-Exclusive-S-Shared-I-Invalid-åè®®"><a href="#M-Modified-E-Exclusive-S-Shared-I-Invalid-åè®®" class="headerlink" title="M(Modified) E(Exclusive) S(Shared) I(Invalid)åè®®"></a>M(Modified) E(Exclusive) S(Shared) I(Invalid)åè®®</h4><p>ç¼“å­˜è¡Œæœ‰4ç§ä¸åŒçš„çŠ¶æ€</p>
<ol>
<li><strong>å·²ä¿®æ”¹Modifiedï¼ˆMï¼‰ï¼š</strong>ç¼“å­˜è¡Œæ˜¯è„çš„ï¼Œä¸ä¸»å­˜çš„å€¼ä¸åŒã€‚å¦‚æœåˆ«çš„CPUå†…æ ¸è¦è¯»ä¸»å­˜è¿™å—æ•°æ®ï¼Œè¯¥ç¼“å­˜è¡Œå¿…é¡»å›å†™åˆ°ä¸»å­˜ï¼ŒçŠ¶æ€å˜ä¸ºå…±äº«ï¼ˆSï¼‰</li>
<li><strong>ç‹¬å Exclusiveï¼ˆEï¼‰ï¼š</strong>ç¼“å­˜è¡Œåªåœ¨å½“å‰ç¼“å­˜ä¸­ï¼Œè€Œä¸”ä¸ä¸»å­˜å€¼ç›¸åŒã€‚å½“åˆ«çš„ç¼“å­˜è¯»å–å®ƒæ—¶ï¼ŒçŠ¶æ€å˜ä¸ºå…±äº«ï¼›å½“å‰å†™æ•°æ®æ—¶ï¼Œå˜ä¸ºå·²ä¿®æ”¹çŠ¶æ€</li>
<li><strong>å…±äº«Sharedï¼ˆSï¼‰ï¼š</strong>ç¼“å­˜è¡Œä¹Ÿå­˜åœ¨ä¸å…¶ä»–ç¼“å­˜ä¸­ä¸”æ˜¯å¹²å‡€çš„ï¼Œç¼“å­˜è¡Œå¯ä»¥åœ¨ä»»æ„æ—¶åˆ»æŠ›å¼ƒ</li>
<li><strong>æ— æ•ˆInvalidï¼ˆIï¼‰ï¼š</strong>ç¼“å­˜è¡Œæ˜¯æ— æ•ˆçš„</li>
</ol>
<p><img src="https://cdn.leosocy.top/img/dinosaurloading.gif" data-lazy-src="https://cdn.leosocy.top/img/20211017180553.png"></p>
<p>ä¸Šå›¾ä¸º4ä¸­çŠ¶æ€é—´çš„æœ‰é™çŠ¶æ€æœºè½¬æ¢ï¼Œæœ‰ä¸¤ç§åœºæ™¯ä¼šè§¦å‘çŠ¶æ€çš„è½¬æ¢ï¼š</p>
<ol>
<li>ç¼“å­˜æ‰€åœ¨CPUçš„è¯»å†™ï¼ˆä¸Šå›¾ä¸­å·¦åŠéƒ¨é»‘å®çº¿ï¼‰<ol>
<li>PrRdï¼šå¤„ç†å™¨è¯·æ±‚è¯»ä¸€ä¸ªç¼“å­˜å—</li>
<li>PrWrï¼šå¤„ç†å™¨è¯·æ±‚å†™ä¸€ä¸ªç¼“å­˜å—</li>
</ol>
</li>
<li>å…¶ä»–CPUçš„è¯»å†™ï¼Œé€šè¿‡æ€»çº¿å‘é€ä¿¡å·ï¼Œç„¶åè¢«å…¶ä»–æ€»çº¿snooperå—…æ¢åˆ°ï¼ˆä¸Šå›¾ä¸­å³åŠéƒ¨çº¢è™šçº¿ï¼‰<ol>
<li>BusRdï¼šå—…æ¢åˆ°å…¶ä»–å¤„ç†å™¨è¯·æ±‚<strong>è¯»</strong>ä¸€ä¸ªç¼“å­˜å—</li>
<li>BusRdXï¼šå—…æ¢åˆ°å…¶ä»–å¤„ç†å™¨è¯·æ±‚<strong>å†™</strong>ä¸€ä¸ªè¯¥å¤„ç†å™¨<strong>ä¸æ‹¥æœ‰</strong>çš„ç¼“å­˜å—</li>
<li>BusUpgrï¼šå—…æ¢åˆ°å…¶ä»–å¤„ç†å™¨è¯·æ±‚<strong>å†™</strong>ä¸€ä¸ªè¯¥å¤„ç†å™¨<strong>æ‹¥æœ‰çš„</strong>ç¼“å­˜å—</li>
<li>Flushï¼šsnooperè¯·æ±‚<strong>å›å†™</strong>æ•´ä¸ªç¼“å­˜åˆ°ä¸»å­˜</li>
<li>FlushOptï¼šsnooperè¯·æ±‚å°†æ•´ä¸ªç¼“å­˜å—å‘é€åˆ°å¦ä¸€ä¸ªå¤„ç†å™¨ï¼ˆç¼“å­˜åˆ°ç¼“å­˜çš„èµ‹å¤åˆ¶ï¼‰</li>
</ol>
</li>
</ol>
<h4 id="CacheLineä¸ä¼ªå…±äº«"><a href="#CacheLineä¸ä¼ªå…±äº«" class="headerlink" title="CacheLineä¸ä¼ªå…±äº«"></a>CacheLineä¸ä¼ªå…±äº«</h4><p>ä¸€ä¸ªCacheLineåŒ…å«ï¼šæ ‡è¯†ä½ã€å’Œå†…å­˜åŒ¹é…tagã€æ•°æ®å—ã€‚å…¶ä¸­æ ‡è¯†ä½åŒ…å«ï¼šVï¼ˆValidï¼‰è¡¨ç¤ºè¿™ä¸ªç¼“å­˜å—æ˜¯å¦è¢«ä½¿ç”¨ï¼ŒMï¼ˆModifiedï¼‰è¡¨ç¤ºè¿™ä¸ªç¼“å­˜å—æ˜¯å¦è¢«å†™è¿‡ã€‚æ•°æ®å—å¤§å°ä¸€èˆ¬ä¸º64Byteã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># getconf -a | grep CACHE</span><br><span class="line"></span><br><span class="line">LEVEL1_ICACHE_SIZE                 32768</span><br><span class="line">LEVEL1_ICACHE_ASSOC                8</span><br><span class="line">LEVEL1_ICACHE_LINESIZE             64</span><br><span class="line">LEVEL1_DCACHE_SIZE                 32768</span><br><span class="line">LEVEL1_DCACHE_ASSOC                8</span><br><span class="line">LEVEL1_DCACHE_LINESIZE             64</span><br><span class="line">LEVEL2_CACHE_SIZE                  2097152</span><br><span class="line">LEVEL2_CACHE_ASSOC                 8</span><br><span class="line">LEVEL2_CACHE_LINESIZE              64</span><br><span class="line">LEVEL3_CACHE_SIZE                  16777216</span><br><span class="line">LEVEL3_CACHE_ASSOC                 16</span><br><span class="line">LEVEL3_CACHE_LINESIZE              64</span><br><span class="line">LEVEL4_CACHE_SIZE                  0</span><br><span class="line">LEVEL4_CACHE_ASSOC                 0</span><br><span class="line">LEVEL4_CACHE_LINESIZE              0</span><br></pre></td></tr></table></figure>

<p>L1 æ•°æ®Cacheå¤§å°ä¸º32Kï¼ŒåŒ…å«32 * 1024 / 64 = 512ä¸ªCacheLineï¼Œæ ‡è¯†ä¸ºå’Œtagæœ‰ä¸“é—¨çš„ç”µè·¯ï¼Œä¸å ç”¨ç¼“å­˜å—çš„ç©ºé—´ã€‚</p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://itimetraveler.github.io/2018/09/09/CPU%20Cache%E4%B8%8E%E7%BC%93%E5%AD%98%E8%A1%8C/">https://itimetraveler.github.io/2018/09/09/CPU%20Cache%E4%B8%8E%E7%BC%93%E5%AD%98%E8%A1%8C/</a></p>
<h3 id="å­˜å‚¨ä¸I-Oè®¾å¤‡"><a href="#å­˜å‚¨ä¸I-Oè®¾å¤‡" class="headerlink" title="å­˜å‚¨ä¸I/Oè®¾å¤‡"></a>å­˜å‚¨ä¸I/Oè®¾å¤‡</h3><h4 id="DMA"><a href="#DMA" class="headerlink" title="DMA"></a>DMA</h4><h4 id="INTä¸­æ–­"><a href="#INTä¸­æ–­" class="headerlink" title="INTä¸­æ–­"></a>INTä¸­æ–­</h4><ul>
<li>åœ°å€æ€»çº¿ã€æ•°æ®æ€»çº¿  </li>
<li>ext3/ext4æ–‡ä»¶ç³»ç»Ÿ</li>
</ul>
<h3 id="ä¸ºä»€ä¹ˆARMæ¶æ„åœ¨ç§»åŠ¨äº’è”ç½‘æ—¶ä»£å¤§è¡Œå…¶é“"><a href="#ä¸ºä»€ä¹ˆARMæ¶æ„åœ¨ç§»åŠ¨äº’è”ç½‘æ—¶ä»£å¤§è¡Œå…¶é“" class="headerlink" title="ä¸ºä»€ä¹ˆARMæ¶æ„åœ¨ç§»åŠ¨äº’è”ç½‘æ—¶ä»£å¤§è¡Œå…¶é“"></a>ä¸ºä»€ä¹ˆARMæ¶æ„åœ¨ç§»åŠ¨äº’è”ç½‘æ—¶ä»£å¤§è¡Œå…¶é“</h3><h2 id="æ“ä½œç³»ç»Ÿ"><a href="#æ“ä½œç³»ç»Ÿ" class="headerlink" title="æ“ä½œç³»ç»Ÿ"></a>æ“ä½œç³»ç»Ÿ</h2><ul>
<li>FUTEX(Fast Userspace muTEX)ç³»ç»Ÿè°ƒç”¨</li>
</ul>
<h3 id="å†…å­˜ç®¡ç†"><a href="#å†…å­˜ç®¡ç†" class="headerlink" title="å†…å­˜ç®¡ç†"></a>å†…å­˜ç®¡ç†</h3><h4 id="ç‰©ç†å†…å­˜ç®¡ç†"><a href="#ç‰©ç†å†…å­˜ç®¡ç†" class="headerlink" title="ç‰©ç†å†…å­˜ç®¡ç†"></a>ç‰©ç†å†…å­˜ç®¡ç†</h4><h5 id="ä¼™ä¼´ç³»ç»Ÿ"><a href="#ä¼™ä¼´ç³»ç»Ÿ" class="headerlink" title="ä¼™ä¼´ç³»ç»Ÿ"></a>ä¼™ä¼´ç³»ç»Ÿ</h5><h5 id="å°å¯¹è±¡åˆ†é…"><a href="#å°å¯¹è±¡åˆ†é…" class="headerlink" title="å°å¯¹è±¡åˆ†é…"></a>å°å¯¹è±¡åˆ†é…</h5><h4 id="è™šæ‹Ÿå†…å­˜ç®¡ç†"><a href="#è™šæ‹Ÿå†…å­˜ç®¡ç†" class="headerlink" title="è™šæ‹Ÿå†…å­˜ç®¡ç†"></a>è™šæ‹Ÿå†…å­˜ç®¡ç†</h4><h5 id="é¡µè¡¨å¸ƒå±€"><a href="#é¡µè¡¨å¸ƒå±€" class="headerlink" title="é¡µè¡¨å¸ƒå±€"></a>é¡µè¡¨å¸ƒå±€</h5><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/lorenzo-stoakes/linux-vm-notes/blob/master/sections/page-tables.md">https://github.com/lorenzo-stoakes/linux-vm-notes/blob/master/sections/page-tables.md</a></p>
<p>Linuxä¸­æœ‰4çº§é¡µè¡¨ï¼Œæ¯çº§ç”±<code>pXXval_t</code>åŒ…è£…è€Œæˆçš„ <code>pXX_t</code>ç±»å‹çš„æ•°ç»„ç»„æˆ</p>
<ol>
<li>Page Global Directory (PGD)</li>
<li>Page Upper Directory (PUD)</li>
<li>Page Middle Directory (PMD)</li>
<li>Page Table Entry Directory (PTE)</li>
</ol>
<p>è¿™äº›ç±»å‹çš„å…·ä½“å®šä¹‰å–å†³äºä¸åŒçš„archï¼Œæ¯”å¦‚åœ¨x86æ¶æ„ä¸‹çš„å®šä¹‰ä¸ºï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span>   <span class="type">pgdval_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span>   <span class="type">pudval_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span>   <span class="type">pmdval_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span>   <span class="type">pteval_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span> <span class="type">pgdval_t</span> pgd; &#125; <span class="type">pgd_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span> <span class="type">pudval_t</span> pud; &#125; <span class="type">pud_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span> <span class="type">pmdval_t</span> pmd; &#125; <span class="type">pmd_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span> <span class="type">pteval_t</span> pte; &#125; <span class="type">pte_t</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>p[gum]d_t</code>ç»“æ„å®šä¹‰åœ¨<a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/arch/x86/include/asm/pgtable_types.h.html">arch/x86/include/asm/pgtable_types.h</a>ä¸­ï¼Œè€Œ<code>pte_t</code>å’Œ<code>pXXval_t</code>ç±»å‹å®šä¹‰åœ¨<a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/arch/x86/include/asm/pgtable_64_types.h.html">arch/x86/include/asm/pgtable_64_types.h</a>ä¸­ï¼Œé€šè¿‡å®å®šä¹‰åœ¨<code>pgtable_types</code>æ–‡ä»¶ä¸­è¢«includeï¼Œè¿™æ ·æ˜¯ä¸ºäº†å°½é‡å¤ç”¨32å’Œ64ä½x86ä»£ç ã€‚</p>
</li>
<li><p>åœ¨64ä½x86æ¶æ„ï¼Œä»¥åŠ4KBé¡µå¤§å°æƒ…å†µä¸‹ï¼Œæ¯ä¸ªPGD/PUD/PMD/PTEé¡µè¡¨å‡åŒ…å«512ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸‹ä¸€çº§é¡µè¡¨çš„åœ°å€ï¼Œæ¯ä¸ªæŒ‡é’ˆ8byteï¼Œå³æ¯ä¸ªé¡µè¡¨å ç”¨4KBå†…å­˜ç©ºé—´ï¼Œåˆšå¥½ä¸€ä¸ªå†…å­˜é¡µã€‚æ¯ä¸ªé¡µè¡¨å¯åŒ…å«çš„æŒ‡é’ˆä¸ªæ•°ä½¿ç”¨å®å®šä¹‰<code>PTRS_PER_XXX</code>ï¼Œä¾‹å¦‚<a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/arch/x86/include/asm/pgtable_64_types.h.html#_M/PTRS_PER_PGD">PTRS_PER_PGD</a>ï¼Œ<a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/arch/x86/include/asm/pgtable_64_types.h.html#_M/PTRS_PER_PTE">PTRS_PER_PTE</a></p>
</li>
<li><p>è™šæ‹Ÿåœ°å€å¯¹åº”çš„æ¯ä¸ªé¡µè¡¨çš„ä¸‹æ ‡éœ€è¦å…ˆé€šè¿‡<code>&gt;&gt;</code>ç„¶å<code>&amp; MASK</code>è®¡ç®—å¾—å‡º</p>
<ul>
<li>å³ç§»ä½æ•°ï¼š<code>PGDIR_SHIFT=39, PUD_SHIFT=30, PMD_SHIFT=21, PAGE_SHIFT=12</code></li>
<li>MASKï¼šä»¥<code>PTRS_PER_XXX - 1</code>ä¸ºæ©ç ï¼Œå°†æ‰€æœ‰é«˜äºç¬¬9ä½çš„ä½å…¨éƒ¨ç½®0</li>
</ul>
</li>
<li><p>è®¡ç®—æ¯ä¸ªé¡µè¡¨çš„indexè¢«å®šä¹‰æˆäº†inlineå‡½æ•°ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªè®¡ç®—pteåœ¨pmdä¸­çš„indexçš„æ–¹æ³•</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="title function_">pte_index</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> address)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (address &gt;&gt; PAGE_SHIFT) &amp; (PTRS_PER_PTE - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>é€šè¿‡é¡µè¡¨åŸºåœ°å€+indexå¯ä»¥è·å¾—ä¸‹ä¸€çº§é¡µè¡¨çš„åŸºåœ°å€</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">pte_t</span> *<span class="title function_">pte_offset_kernel</span><span class="params">(<span class="type">pmd_t</span> *pmd, <span class="type">unsigned</span> <span class="type">long</span> address)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (<span class="type">pte_t</span> *)pmd_page_vaddr(*pmd) + pte_index(address);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>PGDçš„è™šæ‹ŸåŸºåœ°å€å­˜å‚¨åœ¨æ¯ä¸ªè¿›ç¨‹çš„<a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/include/linux/mm_types.h.html#mm_struct::(anonymous)::pgd">struct mm_struct-&gt;pgd</a>å­—æ®µä¸­ï¼Œå¯¹åº”çš„ç‰©ç†åœ°å€å­˜å‚¨åœ¨CR3å¯„å­˜å™¨ä¸­ï¼Œå¹¶éšç€è¿›ç¨‹åˆ‡æ¢è€Œæ”¹å˜</li>
<li>ä¾æ¬¡è°ƒç”¨<a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/arch/x86/include/asm/pgtable.h.html#1003">pgd_offset_k</a> -&gt; <a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/arch/x86/include/asm/pgtable.h.html#pud_offset">pud_offset</a> -&gt; <a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/arch/x86/include/asm/pgtable.h.html#pmd_offset">pmd_offset</a> -&gt; <a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/arch/x86/include/asm/pgtable.h.html#pte_offset_kernel">pte_offset_kernel</a>æ¥æŸ¥æ‰¾é¡µè¡¨é¡¹çš„è™šæ‹Ÿåœ°å€ï¼Œæµç¨‹å›¾å¦‚ä¸‹</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="number">0000000000000000</span> <span class="number">000000010</span> <span class="number">000000101</span> <span class="number">000000110</span> <span class="number">100100101</span> <span class="number">000000100100</span></span><br><span class="line">[   RESERVED   ] [  PGD  ] [  PUD  ] [  PMD  ] [  PTE  ] [  OFFSET  ]</span><br><span class="line"></span><br><span class="line">PGD offset =    <span class="number">000000010</span> = <span class="number">2</span></span><br><span class="line">PUD offset =    <span class="number">000000101</span> = <span class="number">5</span></span><br><span class="line">PMD offset =    <span class="number">000000110</span> = <span class="number">6</span></span><br><span class="line">PTE offset =    <span class="number">100100101</span> = <span class="number">293</span></span><br><span class="line">phy offset = <span class="number">000000100100</span> = <span class="number">36</span></span><br><span class="line"></span><br><span class="line">         PGD</span><br><span class="line">        -----   </span><br><span class="line">      <span class="number">0</span> |   |         PUD</span><br><span class="line">      . |   |        -----   </span><br><span class="line">      <span class="number">2</span> |~~~|-----&gt;<span class="number">0</span> |   |   </span><br><span class="line">      . |   |      . |   |         PMD</span><br><span class="line">      . |   |      . |   |        -----   </span><br><span class="line">      . |   |      <span class="number">5</span> |~~~|-----&gt;<span class="number">0</span> |   |   </span><br><span class="line">      . |   |      . |   |      . |   |         PTE</span><br><span class="line">      . |   |      . |   |      . |   |        -----   </span><br><span class="line">    <span class="number">512</span> -----      . |   |      <span class="number">6</span> |~~~|-----&gt;<span class="number">0</span> |   |   </span><br><span class="line">                   . |   |      . |   |      . |   |   </span><br><span class="line">                 <span class="number">512</span> -----      . |   |      . |   |   </span><br><span class="line">                                . |   |      . |   |   </span><br><span class="line">                                . |   |      . |   |     physical page</span><br><span class="line">                              <span class="number">512</span> -----      . |   |        -----</span><br><span class="line">                                           <span class="number">293</span> |~~~|-----&gt;<span class="number">0</span> |   |</span><br><span class="line">                                             . |   |      . |   |</span><br><span class="line">                                           <span class="number">512</span> -----     <span class="number">36</span> | h |</span><br><span class="line">                                                          . | e |</span><br><span class="line">                                                          . | l |</span><br><span class="line">                                                          . | l |</span><br><span class="line">                                                          . | o |</span><br><span class="line">                                                         <span class="number">41</span> | ! |</span><br><span class="line">                                                          . |   |</span><br><span class="line">                                                        <span class="number">4096</span>-----</span><br></pre></td></tr></table></figure>

<h5 id="Page-Table-Entry-Flags"><a href="#Page-Table-Entry-Flags" class="headerlink" title="Page Table Entry Flags"></a>Page Table Entry Flags</h5><ul>
<li>ç”±äºæ¯ä¸ªé¡µç›®å½•é¡¹æ˜¯é¡µå¯¹é½çš„ï¼Œæ‰€ä»¥æ¯ä¸ªé¡µè¡¨é¦–åœ°å€çš„ä½<code>PAGE_SHIFT</code>ä½éƒ½æ˜¯0ï¼Œä¹Ÿå°±æ˜¯è¯´<code>PGD/PUD/PMD/PTE</code>ä¸­æŒ‡é’ˆçš„å€¼ä½<code>PAGE_SHIFT</code>ä½æ˜¯æ²¡ç”¨åˆ°çš„ï¼Œè¿™æ ·å°±å¯ä»¥å°†è¿™äº›ä½ä½œä¸ºæ ‡å¿—ä½å­˜å‚¨pageçš„é…ç½®ä¿¡æ¯ã€‚å¦å¤–åœ¨x86-64æ¶æ„ä¸­ï¼Œåªæœ‰46ä¸ªå¯å¯»å€ä½ï¼Œæ‰€ä»¥ä¸å‚ä¸å¯»å€çš„é«˜ä½ä¹Ÿå¯ä»¥å­˜å‚¨æ ‡å¿—ä½</li>
<li>è¿™æ ·åšçš„å½±å“æ˜¯ï¼šè®¡ç®—é¡µç›®å½•indexæ—¶éœ€è¦å¿½ç•¥æ ‡å¿—ä½ã€‚åœ¨é¡µå¤§å°ä¸º4KBæƒ…å†µä¸‹ï¼Œæ˜¯é€šè¿‡<a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/arch/x86/include/asm/pgtable_types.h.html#_M/PTE_PFN_MASK">PTE_PFN_MASK</a>å’Œ<a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/arch/x86/include/asm/pgtable_types.h.html#_M/PTE_FLAGS_MASK">PTE_FLAGS_MASK</a>ä¸¤ä¸ªå®å®šä¹‰è®¡ç®—çš„ã€‚æ›´å¤§çš„é¡µå¤§å°éœ€è¦äº›ç‰¹æ®Šå¤„ç†ï¼Œè¿™é‡Œå…ˆä¸èµ˜è¿°äº†ï¼Œä¼šåœ¨[Huge Page](#Huge Page)ä¸€èŠ‚è¯¦è¿°ã€‚</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">PAGE_MASK = ~((<span class="number">1UL</span> &lt;&lt; <span class="number">12</span>) - <span class="number">1</span>) = </span><br><span class="line"><span class="number">1111111111111111111111111111111111111111111111111111000000000000</span></span><br><span class="line"></span><br><span class="line">__PHYSICAL_MASK = ((<span class="number">1UL</span> &lt;&lt; <span class="number">52</span>) - <span class="number">1</span>) = </span><br><span class="line"><span class="number">0000000000001111111111111111111111111111111111111111111111111111</span></span><br><span class="line"></span><br><span class="line">PTE_PFN_MASK = PAGE_MASK &amp; __PHYSICAL_MASK = </span><br><span class="line"><span class="number">1111111111111111111111111111111111111111111111111111000000000000</span></span><br><span class="line"><span class="number">0000000000001111111111111111111111111111111111111111111111111111</span> = </span><br><span class="line"><span class="number">0000000000001111111111111111111111111111111111111111000000000000</span></span><br><span class="line"></span><br><span class="line">PTE_FLAGS_MASK = ~PTE_PFN_MASK =</span><br><span class="line"><span class="number">1111111111110000000000000000000000000000000000000000111111111111</span></span><br><span class="line">  </span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">pteval_t</span> pte_flags(<span class="type">pte_t</span> pte)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> native_pte_val(pte) &amp; PTE_FLAGS_MASK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿™äº›é¢å¤–çš„æ ‡å¿—ä½ç”¨äºè¡¨ç¤ºé¡µè¡¨é¡¹ä¸­çš„é¡µçš„å„ç§çŠ¶æ€ï¼Œæœ‰ä¸€ç‚¹éœ€è¦å¼„æ¸…æ¥šï¼šPGDä¸­çš„ <code>pdg_t</code>æ¡ç›®çš„æ ‡å¿—ä½ä»£è¡¨çš„æ˜¯å…¶æŒ‡å‘çš„PUDé¡µçš„çŠ¶æ€ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ª<code>pXX_t</code>æ¡ç›®çš„æ ‡å¿—ä½å®é™…ä¸Šè¡¨ç¤ºçš„æ˜¯ä¸‹ä¸€çº§<code>PXX</code>é¡µçš„çŠ¶æ€</li>
<li>æ ‡å¿—ä½çš„å–å€¼é€šè¿‡<code>(pXX_FLAGS_MASK &amp; pXX_val) &amp; (((pteval_t)1) &lt;&lt; FLAG_OFFSET)</code>è®¡ç®—ï¼Œæ¯”å¦‚<code>pte_write = pte_flags(pte) &amp; (1UL &lt;&lt; 1)</code></li>
<li>ä¸€äº›å¸¸ç”¨çš„æ ‡å¿—ä½å«ä¹‰ï¼ˆå…¨éƒ¨å®šä¹‰å¯è§<a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/arch/">arch</a>/<a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/arch/x86/">x86</a>/<a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/arch/x86/include/">include</a>/<a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/arch/x86/include/asm/">asm</a>/<a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/arch/x86/include/asm/pgtable_types.h.html">pgtable_types.h</a>ï¼‰<ul>
<li><code>_PAGE_PRESENT</code>: ç”¨äºç¡®å®šé¡µåœ¨å†…å­˜ä¸­æ˜¯å¦å¯ç”¨ï¼Œè¿˜æ˜¯ç”±äºé¡µæ¢å‡ºæˆ–å…¶ä»–åŸå› å¯¼è‡´ä¸å¯ç”¨</li>
<li><code>_PAGE_RW</code>: å¦‚æœæ¸…é™¤è¯¥æ ‡å¿—ï¼Œåˆ™å†…å­˜é¡µæ˜¯åªè¯»çš„ï¼ˆå¸¸ç”¨è¯­Copy On Writeï¼‰</li>
<li><code>_PAGE_USER</code>: å¦‚æœæ¸…é™¤è¯¥æ ‡å¿—ï¼Œåˆ™åªæœ‰å†…æ ¸æ€èƒ½è®¿é—®å†…å­˜é¡µ</li>
<li><code>_PAGE_ACCESSED</code>: é¡µé¢å·²è¢«è®¿é—®ï¼Œå¦‚æœåœ¨åˆ›å»ºé¡µé¢æ—¶å°†å…¶æ¸…é™¤ï¼Œåˆ™å¯¹è¯¥é¡µé¢çš„é¦–æ¬¡è®¿é—®å°†è®¾ç½®è¯¥æ ‡å¿—ï¼Œå¹¶ä¸”è¯¥æ ‡å¿—å°†ä¿æŒè®¾ç½®çŠ¶æ€ï¼Œç›´åˆ°æ‰‹åŠ¨æ¸…é™¤ä¸ºæ­¢</li>
<li><code>_PAGE_DIRTY</code>: é¡µé¢å·²è¢«ä¿®æ”¹ï¼Œå¦‚æœåœ¨åˆ›å»ºé¡µé¢æ—¶å°†å…¶æ¸…é™¤ï¼Œåˆ™å¯¹è¯¥é¡µé¢çš„é¦–æ¬¡å†™å…¥å°†è®¾ç½®è¯¥æ ‡å¿—ï¼Œå¹¶ä¸”è¯¥æ ‡å¿—å°†ä¿æŒè®¾ç½®çŠ¶æ€ï¼Œç›´åˆ°æ‰‹åŠ¨æ¸…é™¤ä¸ºæ­¢</li>
<li><code>_PAGE_PSE</code>: ä¸º1åˆ™è¡¨ç¤ºè¯¥é¡µæ˜¯ä¸€ä¸ªHuge Pageï¼Œå³1GBæˆ–2MBè€Œä¸æ˜¯4KB</li>
<li><code>_PAGE_GLOBAL</code>: ä¸º1åˆ™è¡¨ç¤ºæ™®é€šçš„TLBç¼“å­˜åˆ·æ–°ä¸ä¼šé©±é€è¯¥é¡µ</li>
</ul>
</li>
</ul>
<h5 id="PGDä¸è¿›ç¨‹åˆ‡æ¢"><a href="#PGDä¸è¿›ç¨‹åˆ‡æ¢" class="headerlink" title="PGDä¸è¿›ç¨‹åˆ‡æ¢"></a>PGDä¸è¿›ç¨‹åˆ‡æ¢</h5><h5 id="Huge-Page"><a href="#Huge-Page" class="headerlink" title="Huge Page"></a>Huge Page</h5><h2 id="ç¼–è¯‘åŸç†"><a href="#ç¼–è¯‘åŸç†" class="headerlink" title="ç¼–è¯‘åŸç†"></a>ç¼–è¯‘åŸç†</h2><h2 id="ç¨‹åºé“¾æ¥ä¸è£…è½½"><a href="#ç¨‹åºé“¾æ¥ä¸è£…è½½" class="headerlink" title="ç¨‹åºé“¾æ¥ä¸è£…è½½"></a>ç¨‹åºé“¾æ¥ä¸è£…è½½</h2><ol>
<li>Preprocess -&gt; Compile -&gt; Assemble -&gt; Link</li>
</ol>
<h3 id="åº“æ‰“æ¡©æœºåˆ¶"><a href="#åº“æ‰“æ¡©æœºåˆ¶" class="headerlink" title="åº“æ‰“æ¡©æœºåˆ¶"></a>åº“æ‰“æ¡©æœºåˆ¶</h3><ul>
<li>ç¼–è¯‘æ—¶æ‰“æ¡©ï¼šåˆ©ç”¨ç¼–è¯‘å™¨çš„<code>-I</code>å‚æ•°ï¼Œä»¥åŠå®å®šä¹‰ï¼Œåœ¨ç¼–è¯‘æ—¶å°†ç›®æ ‡å‡½æ•°çš„å£°æ˜æ›¿æ¢æ‰ã€‚å…¸å‹çš„åº”ç”¨æœ‰ï¼š<ul>
<li>Redisä¸­æ ¹æ®ä¸åŒçš„ç¼–è¯‘å‚æ•°é€‰æ‹©ä½¿ç”¨ä¸åŒçš„å†…å­˜åˆ†é…å™¨ï¼Œå¹¶å°†<code>malloc</code>, <code>free</code>ç­‰å‡½æ•°åˆ©ç”¨å®å®šä¹‰æ›¿æ¢æˆä¸åŒå†…å­˜åˆ†é…å™¨çš„å‡½æ•°å£°æ˜ï¼Œæ¯”å¦‚<code>je_malloc</code>, <code>je_free</code></li>
</ul>
</li>
<li>é“¾æ¥æ—¶æ‰“æ¡©</li>
<li>è¿è¡Œæ—¶æ‰“æ¡©</li>
</ul>
<h3 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h3><h4 id="é“¾æ¥çš„æ¥å£â€”â€”ç¬¦å·"><a href="#é“¾æ¥çš„æ¥å£â€”â€”ç¬¦å·" class="headerlink" title="é“¾æ¥çš„æ¥å£â€”â€”ç¬¦å·"></a>é“¾æ¥çš„æ¥å£â€”â€”ç¬¦å·</h4><ul>
<li><p>C++ä¸­namespaceä¸å‡½æ•°é‡è½½åœ¨ç¬¦å·è¡¨ä¸­çš„ä½“ç°ï¼šç¼–è¯‘å™¨æ ¹æ®å‡½æ•°ç­¾åä¸­çš„å‡½æ•°åã€å‚æ•°ç±»å‹ä»¥åŠæ‰€åœ¨ç±»å’Œå‘½åç©ºé—´ç”Ÿæˆä¿®é¥°ååç§°ï¼Œä¿è¯é“¾æ¥æ—¶ä¸ä¼šå‡ºç°å‡½æ•°é‡å¤å®šä¹‰ã€‚ä¸‹é¢æ˜¯GCCç¼–è¯‘å™¨ç”Ÿæˆä¿®é¥°ååç§°ï¼Œ</p>
<table>
<thead>
<tr>
<th>å‡½æ•°ç­¾å</th>
<th>ä¿®é¥°ååç§°</th>
</tr>
</thead>
<tbody><tr>
<td>int func(int)</td>
<td>_Z4funci</td>
</tr>
<tr>
<td>float func(float)</td>
<td>_Z4funcf</td>
</tr>
<tr>
<td>int ClassA::func(int)</td>
<td>_ZN6ClassA4funcEi</td>
</tr>
<tr>
<td>int ClassA::ClassB::func(int)</td>
<td>_ZN6ClassA6ClassB4funcEi</td>
</tr>
<tr>
<td>int NamespaceA::ClassC::func(int)</td>
<td>_ZN10NamespaceA6ClassC4funcEi</td>
</tr>
</tbody></table>
</li>
<li><p>C++ä¸­<code>extern &quot;C&quot;</code>ç”¨é€”ï¼šå‘ŠçŸ¥C++ç¼–è¯‘å™¨ï¼Œå¯¹äºå…¶ä¿®é¥°çš„ä»£ç å—ï¼Œä¸è¦æŒ‰ç…§C++å‡½æ•°ä¿®é¥°è§„åˆ™ç”Ÿæˆç¬¦å·ã€‚è¿™åœ¨C++ç¨‹åºè°ƒç”¨Cåº“å‡½æ•°ï¼Œæˆ–C++ç¨‹åºæš´éœ²Cå‡½æ•°æ¥å£æ—¶æ˜¯éå¸¸æœ‰å¿…è¦çš„ï¼Œå¦åˆ™åœ¨é“¾æ¥æ—¶ä¼šæŠ¥<code>undefined reference</code>é”™è¯¯</p>
</li>
<li><p>å¼±ç¬¦å·ï¼šåº“ä¸­å®šä¹‰çš„å¼±ç¬¦å·å¯ä»¥è¢«ç”¨æˆ·å®šä¹‰çš„å¼ºç¬¦å·æ‰€è¦†ç›–ï¼Œå¼±ç¬¦å·ç›¸å½“äºå‡½æ•°çš„é»˜è®¤å®ç°ï¼Œç”¨æˆ·å¯ä»¥åœ¨é“¾æ¥æ—¶ä½¿ç”¨è‡ªå®šä¹‰çš„å®ç°è¦†ç›–å®ƒï¼Œè¿›è€Œä½¿å¾—ä¾èµ–æ­¤å‡½æ•°çš„ç¬¬ä¸‰æ–¹åœ¨ä¸æ”¹åŠ¨ä»£ç çš„æƒ…å†µä¸‹æ›¿æ¢å‡½æ•°çš„åŠŸèƒ½</p>
</li>
<li><p>å¼±å¼•ç”¨ï¼šç¨‹åºä¸­å£°æ˜çš„å¼±å¼•ç”¨åœ¨é“¾æ¥æ—¶å¦‚æœæ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ç¬¦å·ï¼Œä¸ä¼šæŠ¥é“¾æ¥é”™ï¼Œå…¶å‡½æ•°åœ°å€ä¸º0ã€‚åˆ©ç”¨æ­¤ç‰¹æ€§ï¼Œç¨‹åºå¯ä»¥é€‰æ‹©æ€§ä½¿ç”¨æŸäº›æ‰©å±•åŠŸèƒ½æ¨¡å—ï¼Œå½“é“¾æ¥æ‰©å±•æ¨¡å—æ—¶åˆ™ä½¿ç”¨å¯¹åº”å‡½æ•°ï¼Œå¦åˆ™ä¹Ÿä¸å½±å“ç¨‹åºæ­£å¸¸è¿è¡Œ</p>
</li>
</ul>
<h4 id="åŠ¨æ€é“¾æ¥"><a href="#åŠ¨æ€é“¾æ¥" class="headerlink" title="åŠ¨æ€é“¾æ¥"></a>åŠ¨æ€é“¾æ¥</h4><h5 id="GOTä¸C-ä¸­çš„è™šå‡½æ•°è¡¨"><a href="#GOTä¸C-ä¸­çš„è™šå‡½æ•°è¡¨" class="headerlink" title="GOTä¸C++ä¸­çš„è™šå‡½æ•°è¡¨"></a>GOTä¸C++ä¸­çš„è™šå‡½æ•°è¡¨</h5><ul>
<li>C++ä¸­çš„è™šå‡½æ•°ä¹Ÿæ˜¯åœ¨è¿è¡Œæ—¶é€šè¿‡ä¿®æ”¹å¯¹è±¡çš„è™šå‡½æ•°è¡¨åœ°å€æ¥å®ç°å¤šæ€çš„</li>
</ul>
<h5 id="å‡½æ•°çš„å…¥å£ä¸€å®šæ˜¯mainå—"><a href="#å‡½æ•°çš„å…¥å£ä¸€å®šæ˜¯mainå—" class="headerlink" title="å‡½æ•°çš„å…¥å£ä¸€å®šæ˜¯mainå—"></a>å‡½æ•°çš„å…¥å£ä¸€å®šæ˜¯mainå—</h5><p>è¿˜æœ‰ä¸€ä¸ªè¡ç”Ÿé—®é¢˜ï¼Œä¸ºä»€ä¹ˆmainå‡½æ•°åœ¨Javaä¸­ä¸€å®šè¦æ˜¯staticçš„ï¼Ÿ</p>
<p>ç¨‹åºçœŸæ­£æ‰§è¡Œçš„å…¥å£æ˜¯mainå—ï¼Ÿï¼ˆglibcä¸­mainå‡½æ•°åœ°å€å¹¶ä¸æ˜¯ELFä¸­çš„entryï¼‰</p>
<h2 id="è®¡ç®—æœºç½‘ç»œ"><a href="#è®¡ç®—æœºç½‘ç»œ" class="headerlink" title="è®¡ç®—æœºç½‘ç»œ"></a>è®¡ç®—æœºç½‘ç»œ</h2><h3 id="ç›¸å…³èµ„æ–™"><a href="#ç›¸å…³èµ„æ–™" class="headerlink" title="ç›¸å…³èµ„æ–™"></a>ç›¸å…³èµ„æ–™</h3><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://tonydeng.github.io/sdn-handbook/secure/vpn/">https://tonydeng.github.io/sdn-handbook/secure/vpn/</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://segmentfault.com/a/1190000008836467">https://segmentfault.com/a/1190000008836467</a></li>
</ul>
<h3 id="æ•°æ®é“¾è·¯å±‚"><a href="#æ•°æ®é“¾è·¯å±‚" class="headerlink" title="æ•°æ®é“¾è·¯å±‚"></a>æ•°æ®é“¾è·¯å±‚</h3><h4 id="FDB-Fowarding-dataase"><a href="#FDB-Fowarding-dataase" class="headerlink" title="FDB(Fowarding dataase)"></a>FDB(Fowarding dataase)</h4><h3 id="ç½‘ç»œå±‚"><a href="#ç½‘ç»œå±‚" class="headerlink" title="ç½‘ç»œå±‚"></a>ç½‘ç»œå±‚</h3><h4 id="ARP-Address-Resolution-Protocol"><a href="#ARP-Address-Resolution-Protocol" class="headerlink" title="ARP(Address Resolution Protocol)"></a>ARP(Address Resolution Protocol)</h4><h4 id="IP"><a href="#IP" class="headerlink" title="IP"></a>IP</h4><h5 id="IPv6"><a href="#IPv6" class="headerlink" title="IPv6"></a>IPv6</h5><h6 id="ä¸€äº›å°é—®é¢˜"><a href="#ä¸€äº›å°é—®é¢˜" class="headerlink" title="ä¸€äº›å°é—®é¢˜"></a>ä¸€äº›å°é—®é¢˜</h6><ul>
<li>ä¸ºä»€ä¹ˆIPv6åœ¨httpè¯·æ±‚çš„è·¯å¾„ä¸­éœ€è¦åŠ <code>[]</code>ï¼Ÿ<ul>
<li>IPv6å¯ä»¥ä½¿ç”¨åŒå†’å·<code>::</code>è¡¨ç¤ºä¸€ç»„0æˆ–å¤šç»„è¿ç»­çš„0ï¼Œä½†åªèƒ½å‡ºç°ä¸€æ¬¡</li>
<li>http urlå¯ä»¥ä½¿ç”¨<code>ip:port</code>ä½œä¸ºdomainï¼Œä¹Ÿå¯ä»¥çœç•¥portï¼Œæ­¤æ—¶httpé»˜è®¤ä¸º80ç«¯å£ï¼Œhttpsé»˜è®¤ä¸º443ç«¯å£</li>
<li>å¦‚æœä¸ç”¨<code>[]</code>æ‰©èµ·ï¼Œåˆ™å½¢å¦‚<code>https://2021:0216::1234:6789/path/to</code>çš„urlå°±æ²¡åŠæ³•åŒºåˆ†è¯·æ±‚çš„æ˜¯<code>2021:0216:0000:0000:0000:0000:0000:1234</code>åœ°å€çš„6789ç«¯å£è¿˜æ˜¯<code>2021:0216:0000:0000:0000:0000:1234:6789</code>åœ°å€çš„443ç«¯å£</li>
</ul>
</li>
</ul>
<h4 id="TUN-TAPåŠå…¶åº”ç”¨"><a href="#TUN-TAPåŠå…¶åº”ç”¨" class="headerlink" title="TUN/TAPåŠå…¶åº”ç”¨"></a>TUN/TAPåŠå…¶åº”ç”¨</h4><h3 id="socket"><a href="#socket" class="headerlink" title="socket"></a>socket</h3><h4 id="UnixDomain-Socket"><a href="#UnixDomain-Socket" class="headerlink" title="UnixDomain Socket"></a>UnixDomain Socket</h4><h3 id="ä¼ è¾“å±‚"><a href="#ä¼ è¾“å±‚" class="headerlink" title="ä¼ è¾“å±‚"></a>ä¼ è¾“å±‚</h3><h4 id="Packet-Filtering-amp-iptables"><a href="#Packet-Filtering-amp-iptables" class="headerlink" title="Packet Filtering &amp; iptables"></a>Packet Filtering &amp; iptables</h4><h3 id="åº”ç”¨å±‚åè®®"><a href="#åº”ç”¨å±‚åè®®" class="headerlink" title="åº”ç”¨å±‚åè®®"></a>åº”ç”¨å±‚åè®®</h3><h4 id="HTTPå®¶æ—"><a href="#HTTPå®¶æ—" class="headerlink" title="HTTPå®¶æ—"></a>HTTPå®¶æ—</h4><h5 id="HTTP2ç‰¹æ€§"><a href="#HTTP2ç‰¹æ€§" class="headerlink" title="HTTP2ç‰¹æ€§"></a>HTTP2ç‰¹æ€§</h5><ol>
<li>Headerså‹ç¼©ï¼šHPACKç®—æ³•</li>
<li>äºŒè¿›åˆ¶åˆ†å¸§</li>
<li>å¤šè·¯å¤ç”¨ï¼Œä¸€ä¸ªTCPè¿æ¥èƒ½åŒæ—¶æ‰¿è½½å¤šä¸ªè¯·æ±‚ã€‚æ¯ä¸ªæµéƒ½æœ‰ä¸€ä¸ªID, å³å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚ï¼Œä¸å†ä¾èµ–å¤šä¸ª TCP è¿æ¥å»å®ç°å¤šæµå¹¶è¡Œäº†ã€‚</li>
<li>è§£å†³HTTPå¤´éƒ¨é˜»å¡ï¼ˆä»æœªè§£å†³TCPå¤´éƒ¨é˜»å¡ï¼‰<ul>
<li>HTTPå¤´éƒ¨é˜»å¡ï¼šå‰ä¸€ä¸ªè¯·æ±‚æœªæ”¶åˆ°å“åº”æ—¶ï¼Œä¸èƒ½ä½¿ç”¨è¯¥TCPè¿æ¥å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚æ ¹æœ¬åŸå› è¿˜æ˜¯è¯·æ±‚å’Œå“åº”çš„æ¯ä¸€ä¸ªpacketä¹‹é—´ç¼ºä¹ä¸€ä¸ªkeyè¿›è¡Œå…³è”ï¼Œå¯¼è‡´å¦‚æœè¦æ”¯æŒåŒä¸€ä¸ªTCPè¿æ¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚ï¼Œåœ¨æ”¶åˆ°ä¸åŒè¯·æ±‚çš„å“åº”æ•°æ®åŒ…åï¼Œæ— æ³•æ‰¾åˆ°å®ƒä»¬å¯¹åº”çš„æ˜¯å“ªä¸ªè¯·æ±‚ä»¥åŠæ— æ³•ç»„è£…åŒä¸€ä¸ªå“åº”çš„ä¸åŒæ•°æ®åŒ…ã€‚è€ŒHTTP2å¼•å…¥åˆ†å¸§åï¼Œåœ¨æ¯ä¸ªå¸§ä¸­å¢åŠ äº†StreamIDä»¥ä¸²è”åŒä¸€ä¸ªTCPè¿æ¥ä¸­ä¸åŒçš„æµã€‚</li>
<li>TCPå¤´éƒ¨é˜»å¡ï¼šç”±äºTCPéœ€è¦ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§ï¼Œæ‰€ä»¥ä¸€ä¸ªæ•°æ®åŒ…ä¸¢åŒ…åï¼Œå…¶åé¢çš„æ•°æ®åŒ…å°±ç®—æ¥æ”¶åˆ°ä¹Ÿä¸ä¼šå›å¤ackã€‚æ„å‘³ç€åé¢çš„æ•°æ®åŒ…éƒ½è¢«è¿™ä¸ªä¸¢å¤±çš„æ•°æ®åŒ…é˜»å¡äº†ã€‚</li>
</ul>
</li>
<li>æœåŠ¡ç«¯æ¨é€ï¼šæœåŠ¡ç«¯å¯ä»¥åœ¨å®¢æˆ·ç«¯çš„æŸä¸ªè¯·æ±‚ä¹‹åï¼Œä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€å…¶ä»–èµ„æºã€‚è¿™ä¹Ÿå¾—ç›ŠäºäºŒè¿›åˆ¶åˆ†å¸§ï¼Œé€šè¿‡StreamIDå¯ä»¥åŒºåˆ†ä¸åŒçš„æµã€‚è€Œåœ¨HTTPä¸­ï¼Œæ²¡åŠæ³•å®ç°æœåŠ¡ç«¯æ¨é€ï¼Œå› ä¸ºå®¢æˆ·ç«¯åŒºåˆ†ä¸äº†æ˜¯æŸä¸ªè¯·æ±‚çš„å“åº”è¿˜æ˜¯æœåŠ¡ç«¯ä¸»åŠ¨æ¨é€çš„ã€‚</li>
</ol>
<h5 id="QUIC"><a href="#QUIC" class="headerlink" title="QUIC"></a>QUIC</h5><h4 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h4><h4 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h4><p>SSHåŸç†ï¼š <a target="_blank" rel="external nofollow noopener noreferrer" href="https://mp.weixin.qq.com/s/E05ZSzJQFc6efXtvs5sf1g">https://mp.weixin.qq.com/s/E05ZSzJQFc6efXtvs5sf1g</a></p>
<blockquote>
<p>æ›´å¤šå†…å®¹è¯¦è§<a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.ietf.org/rfc/rfc4251.txt">RFC4251</a></p>
</blockquote>
<p>SSH(<code>Secure Shell</code>)æ˜¯ä¸ºäº†åœ¨<strong>ä¸å®‰å…¨çš„ç½‘ç»œä¸Š</strong>æä¾›å®‰å…¨çš„è¿œç¨‹ç™»å½•å’Œå…¶ä»–ç½‘ç»œæœåŠ¡ï¼Œç”¨æ¥æ›¿ä»£ä¸å®‰å…¨çš„ç»ˆç«¯è®¿é—®æ–¹å¼ï¼Œä¾‹å¦‚<code>telnet</code> ã€‚</p>
<p>SSHåè®®å¯ä»¥ç†è§£ä¸ºä¸€ç»„åè®®è§„èŒƒï¼Œä¸»è¦åŒ…æ‹¬3ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li>ä¼ è¾“å±‚åè®®<code>[SSH-TRANS]</code>ï¼š</li>
<li>ç”¨æˆ·è®¤è¯åè®®<code>[SSH-USERAUTH]</code>ï¼š</li>
<li>ä¼šè¯è¿æ¥åè®®<code>[SSH-CONNECT]</code>ï¼š</li>
</ol>
<p>åœ¨ä¼ è¾“å±‚ä¾èµ–äºTCPåè®®ï¼Œé‡‡ç”¨éå¯¹ç§°åŠ å¯†ï¼ˆéå¯¹ç§°åŠ å¯†<a href="#%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86">è¯¦è§</a>ï¼‰å®ç°èº«ä»½è®¤è¯</p>
<h5 id="SSHä½¿ç”¨è´¦å·å¯†ç è®¤è¯åŸç†"><a href="#SSHä½¿ç”¨è´¦å·å¯†ç è®¤è¯åŸç†" class="headerlink" title="SSHä½¿ç”¨è´¦å·å¯†ç è®¤è¯åŸç†"></a>SSHä½¿ç”¨è´¦å·å¯†ç è®¤è¯åŸç†</h5><h5 id="SSHä½¿ç”¨ç§˜é’¥è®¤è¯åŸç†"><a href="#SSHä½¿ç”¨ç§˜é’¥è®¤è¯åŸç†" class="headerlink" title="SSHä½¿ç”¨ç§˜é’¥è®¤è¯åŸç†"></a>SSHä½¿ç”¨ç§˜é’¥è®¤è¯åŸç†</h5><p>å¹³å¸¸ä½¿ç”¨<code>ssh user@ip</code>é»˜è®¤ä½¿ç”¨å½“å‰ç”¨æˆ·çš„id_rsaç§˜é’¥æ–‡ä»¶ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡<code>ssh -i rsa</code>æŒ‡å®šç§é’¥ã€‚</p>
<ol>
<li><p>ç§é’¥ä¸­åŒ…å«äº†å…¬é’¥ï¼Œä¹Ÿå°±æ˜¯è¯´é€šè¿‡ç§é’¥å¯ä»¥è®¡ç®—å‡ºå…¬é’¥ï¼Œå…¬ç§é’¥è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼Œå…·ä½“å¯è§ <a target="_blank" rel="external nofollow noopener noreferrer" href="https://tools.ietf.org/html/rfc3447#appendix-A.1.1">RFC3447</a>ã€‚é€šè¿‡<code>ssh-keygen -yf ~/.ssh/id_rsa</code>å¯ä»¥æå–å…¬é’¥</p>
<blockquote>
<p>RSAPublicKey ::= SEQUENCE {</p>
<pre><code>      modulus           INTEGER,  -- n
      publicExponent    INTEGER   -- e
  &#125;
</code></pre>
<p>RSAPrivateKey ::= SEQUENCE {</p>
<pre><code>      version           Version,
      modulus           INTEGER,  -- n
      publicExponent    INTEGER,  -- e
      privateExponent   INTEGER,  -- d
      prime1            INTEGER,  -- p
      prime2            INTEGER,  -- q
      exponent1         INTEGER,  -- d mod (p-1)
      exponent2         INTEGER,  -- d mod (q-1)
      coefficient       INTEGER,  -- (inverse of q) mod p
      otherPrimeInfos   OtherPrimeInfos OPTIONAL
  &#125;
</code></pre>
</blockquote>
</li>
<li><p>å…¬é’¥å’Œç§é’¥è®¡ç®—å‡ºçš„ç§˜é’¥æŒ‡çº¹æ˜¯ç›¸åŒçš„ã€‚é€šè¿‡<code>ssh-keygen -lf ~/.ssh/id_rsa</code>å¯ä»¥è®¡ç®—fingerprintï¼Œç§˜é’¥æŒ‡çº¹ç”Ÿæˆç®—æ³•å¦‚ä¸‹ï¼ˆbigendianï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">00 00 00 07  ssh-rsa 00 00 00 03 01 00 01 00 00 01 01 00 01 ... 63 25</span><br><span class="line">[tag length] [ tag ] [e length ] [   e  ] [n length ] [      n      ]</span><br><span class="line"></span><br><span class="line">*.pubæ–‡ä»¶ä¸­çš„ç¬¬äºŒæ®µå°±æ˜¯é€šè¿‡ï¼šå…ˆå°†å…¬é’¥æŒ‰ç…§ä¸Šé¢çš„ç®—æ³•ç”Ÿæˆçš„å­—èŠ‚ï¼Œå†ç”¨base64ç¼–ç </span><br><span class="line"></span><br><span class="line">ssh-keygen -lf ~/.ssh/id_rsa.pubç”Ÿæˆçš„SHA256æ‘˜è¦æŒ‡çº¹æ˜¯é€šè¿‡ï¼šå…ˆå°†å…¬é’¥æŒ‰ç…§ä¸Šé¢çš„ç®—æ³•ç”Ÿæˆçš„å­—èŠ‚ï¼Œå†ç”¨sha256ç®—æ³•ç”Ÿæˆdigestï¼Œå†ç”¨base64ç¼–ç </span><br></pre></td></tr></table></figure>

</li>
</ol>
<p><code>ssh -i</code>é‰´æƒæµç¨‹ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯åå•†äº§ç”Ÿä¼šè¯å¯†é’¥</li>
<li>å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ç™»å½•è¯·æ±‚ï¼ˆå¦‚ <code>root@192.168.0.2</code>ï¼‰ï¼Œå‘é€çš„ä¿¡æ¯åŒ…æ‹¬ç”¨æˆ·årootä»¥åŠæ ¹æ®å…¬/ç§é’¥è®¡ç®—çš„å…¬é’¥æŒ‡çº¹ï¼Œä¸”æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯ç»è¿‡ä¼šè¯ç§˜é’¥åŠ å¯†è¿‡çš„</li>
<li>æœåŠ¡ç«¯æ”¶åˆ°æ•°æ®åä½¿ç”¨ä¼šè¯ç§˜é’¥è§£å¯†å¾—åˆ°ç™»å½•çš„ç”¨æˆ·årootä»¥åŠç§˜é’¥æŒ‡çº¹ï¼Œç„¶åè¯»å–<code>/root/.ssh/autorized_keys</code>æ–‡ä»¶ä¸­çš„æ‰€æœ‰å…¬é’¥æ•°æ®ï¼Œé€šè¿‡ä¸Šè¿°ç®—æ³•ç”ŸæˆæŒ‡çº¹ä¸å®¢æˆ·ç«¯å‘é€çš„æŒ‡çº¹å¯¹æ¯”ï¼Œä»è€Œæ‰¾åˆ°å®¢æˆ·ç«¯å¯¹åº”çš„å…¬é’¥</li>
<li>æœåŠ¡ç«¯ä½¿ç”¨æ‰¾åˆ°çš„å®¢æˆ·ç«¯å…¬é’¥å¯¹ä¸€ä¸ªéšæœºæ•°è¿›è¡ŒåŠ å¯†ç„¶åå‘é€åˆ°å®¢æˆ·ç«¯</li>
<li>å®¢æˆ·ç«¯ä½¿ç”¨ç§é’¥å¯¹æœåŠ¡çš„å‘é€çš„éšæœºæ•°å¯†æ–‡è¿›è¡Œè§£å¯†ï¼Œç„¶åæŠŠè§£å¯†åçš„ç»“æœå‘ç»™æœåŠ¡ç«¯</li>
<li>æœåŠ¡ç«¯éªŒè¯å®¢æˆ·ç«¯è§£å¯†åçš„éšæœºæ•°ä¸ä¹‹å‰å‘é€çš„æ•°æ®ä¸€è‡´ï¼Œåˆ™å¯¹å®¢æˆ·ç«¯çš„èº«ä»½éªŒè¯é€šè¿‡</li>
</ol>
<h5 id="SSH-tunnelingåŸç†åŠä½¿ç”¨"><a href="#SSH-tunnelingåŸç†åŠä½¿ç”¨" class="headerlink" title="SSH tunnelingåŸç†åŠä½¿ç”¨"></a>SSH tunnelingåŸç†åŠä½¿ç”¨</h5><h2 id="æ•°æ®ç»“æ„ä¸ç®—æ³•"><a href="#æ•°æ®ç»“æ„ä¸ç®—æ³•" class="headerlink" title="æ•°æ®ç»“æ„ä¸ç®—æ³•"></a>æ•°æ®ç»“æ„ä¸ç®—æ³•</h2><h1 id="åç«¯æŠ€èƒ½"><a href="#åç«¯æŠ€èƒ½" class="headerlink" title="åç«¯æŠ€èƒ½"></a>åç«¯æŠ€èƒ½</h1><h2 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h2><h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><h4 id="InnoDBçš„Page-Structure"><a href="#InnoDBçš„Page-Structure" class="headerlink" title="InnoDBçš„Page Structure"></a>InnoDBçš„Page Structure</h4><ul>
<li>ä¸ºä»€ä¹ˆUser Recordsè¦ä»¥å•é“¾è¡¨å½¢å¼å­˜å‚¨è€Œéæ•°ç»„å‘¢ï¼Ÿ<ul>
<li>æ’å…¥è®°å½•O(1)æ—¶é—´å¤æ‚åº¦ï¼Œæ— éœ€ç§»åŠ¨æ•°æ®ï¼›è€Œå‘æ•°ç»„ä¸­é—´æ’å…¥è®°å½•å¿…é¡»æŒªåŠ¨åé¢æ‰€æœ‰çš„è®°å½•ï¼Œæˆæœ¬å¤ªé«˜</li>
<li>æ¯æ¡è®°å½•çš„å¤§å°æ˜¯ä¸å›ºå®šçš„</li>
</ul>
</li>
</ul>
<h3 id="åˆ†åº“åˆ†è¡¨"><a href="#åˆ†åº“åˆ†è¡¨" class="headerlink" title="åˆ†åº“åˆ†è¡¨"></a>åˆ†åº“åˆ†è¡¨</h3><h4 id="ä¸€è‡´æ€§å“ˆå¸Œ"><a href="#ä¸€è‡´æ€§å“ˆå¸Œ" class="headerlink" title="ä¸€è‡´æ€§å“ˆå¸Œ"></a>ä¸€è‡´æ€§å“ˆå¸Œ</h4><h2 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h2><h3 id="ç¼“å­˜æŠ€æœ¯æ€»è§ˆ"><a href="#ç¼“å­˜æŠ€æœ¯æ€»è§ˆ" class="headerlink" title="ç¼“å­˜æŠ€æœ¯æ€»è§ˆ"></a>ç¼“å­˜æŠ€æœ¯æ€»è§ˆ</h3><h4 id="ç¼“å­˜æ·˜æ±°ç­–ç•¥"><a href="#ç¼“å­˜æ·˜æ±°ç­–ç•¥" class="headerlink" title="ç¼“å­˜æ·˜æ±°ç­–ç•¥"></a>ç¼“å­˜æ·˜æ±°ç­–ç•¥</h4><h5 id="TinyLFU"><a href="#TinyLFU" class="headerlink" title="TinyLFU"></a>TinyLFU</h5><h6 id="W-TinyLFU"><a href="#W-TinyLFU" class="headerlink" title="W-TinyLFU"></a>W-TinyLFU</h6><h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><h4 id="Redisæ•°æ®ç»“æ„"><a href="#Redisæ•°æ®ç»“æ„" class="headerlink" title="Redisæ•°æ®ç»“æ„"></a>Redisæ•°æ®ç»“æ„</h4><h5 id="Redisç¼–ç "><a href="#Redisç¼–ç " class="headerlink" title="Redisç¼–ç "></a>Redisç¼–ç </h5><h5 id="Rediså¯¹è±¡"><a href="#Rediså¯¹è±¡" class="headerlink" title="Rediså¯¹è±¡"></a>Rediså¯¹è±¡</h5><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">0            3 4                7 8          31 32              63 64         127</span><br><span class="line">|&lt;-- type --&gt;| |&lt;-- encoding --&gt;| |&lt;-- lru --&gt;| |&lt;-- refcount --&gt;| |&lt;-- prt --&gt;|</span><br><span class="line"></span><br><span class="line">type: Rediså¯¹è±¡ç±»å‹ï¼ŒString, List, Set, Sorted set, Hash</span><br><span class="line">encoding: å¯¹è±¡çš„ç¼–ç ç±»å‹ï¼ŒRaw, Integer, Hash table, Skiplist, Embstrç­‰</span><br><span class="line">lru: è¡¨ç¤ºä¸lru_clockçš„ç›¸å¯¹å€¼ï¼ˆç”¨äºLRUé©±é€ç­–ç•¥ï¼‰ï¼›æˆ–LFUçš„æ•°æ®ï¼Œä½8bitè¡¨ç¤ºfrequencyï¼Œé«˜16bitè¡¨ç¤ºæœ€åè®¿é—®æ—¶é—´ï¼ˆä»¥åˆ†é’Ÿä¸ºå•ä½ï¼‰</span><br><span class="line">refcount: æ­¤å¯¹è±¡çš„å¼•ç”¨è®¡æ•°</span><br><span class="line">ptr: æŒ‡å‘å¯¹è±¡å€¼çš„æŒ‡é’ˆ</span><br></pre></td></tr></table></figure>

<h6 id="String-Object"><a href="#String-Object" class="headerlink" title="String Object"></a>String Object</h6><p>å­—ç¬¦ä¸²é•¿åº¦<code>&lt;= 44</code>ä½¿ç”¨embstrï¼Œå¦åˆ™ä½¿ç”¨raw stringã€‚ä¹‹æ‰€ä»¥æ ¹æ®å­—ç¬¦ä¸²é•¿åº¦æœ‰ä¸åŒçš„å®ç°ï¼Œæ˜¯å› ä¸ºembstråªéœ€è¦ä¸€æ¬¡å†…å­˜åˆ†é…ï¼Œè€Œraw stringéœ€è¦2æ¬¡å†…å­˜åˆ†é…ï¼Œè€Œä¸”ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œå¦å¤–é‡è¦çš„ä¸€ç‚¹æ˜¯Stringå¯¹è±¡ä½œä¸ºæœ€åŸºç¡€çš„å¯¹è±¡ï¼Œé€šå¸¸é•¿åº¦ä¸ä¼šå¤ªé•¿ï¼ˆä½œä¸ºcommandã€keyç­‰ï¼‰ã€‚</p>
<p>è€Œ44è¿™ä¸ªæ•°å­—ï¼Œæ˜¯å› ä¸ºString Objectä¸­ä¸€ä¸ª<code>robj</code>å¯¹è±¡å ç”¨16å­—èŠ‚ï¼Œ<code>sdshdr8</code>å ç”¨3å­—èŠ‚ï¼Œ<code>\0</code>å ç”¨1å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´å°±ç®—æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ä¹Ÿè¦å ç”¨20å­—èŠ‚ã€‚Redisä½¿ç”¨çš„å†…å­˜åˆ†é…å™¨é»˜è®¤æ˜¯<code>jemalloc</code>ï¼Œæ ¹æ®class_sizeå‘ä¸Šå–æ•´ç†åº”è¦åˆ†é…32å­—èŠ‚ï¼Œä½†æ˜¯è¿™æ ·çš„è¯å­—ç¬¦ä¸²æœ€å¤§é•¿åº¦åªæœ‰12å­—èŠ‚ï¼Œæ²¡åŠæ³•é€‚ç”¨å¤§éƒ¨åˆ†åœºæ™¯ã€‚æ‰€ä»¥å°±æ‰©å¤§äº†é™åˆ¶ä»¥é€‚é…64å­—èŠ‚è¿™ä¸ªsizeã€‚</p>
<h4 id="Redisé€šä¿¡åè®®"><a href="#Redisé€šä¿¡åè®®" class="headerlink" title="Redisé€šä¿¡åè®®"></a>Redisé€šä¿¡åè®®</h4><h5 id="RESPï¼ˆREdis-Serialization-Protocolï¼‰"><a href="#RESPï¼ˆREdis-Serialization-Protocolï¼‰" class="headerlink" title="RESPï¼ˆREdis Serialization Protocolï¼‰"></a>RESPï¼ˆREdis Serialization Protocolï¼‰</h5><p>ç”¨äºRedis Clientå’ŒServeré€šä¿¡ï¼ŒRESPå¯ä»¥å…¼é¡¾ä»¥ä¸‹å‡ ä¸ªä¼˜ç‚¹ï¼š1. å®ç°ç®€å•    2. è§£æé€Ÿåº¦å¿«    3. Human readableã€‚</p>
<p>RESPå°½é‡éµå¾ªç®€å•çš„è¯·æ±‚-å“åº”æ¨¡å‹ï¼Œå³Clientå‘é€ä¸åŒå‚æ•°ç»„æˆçš„å‘½ä»¤ï¼ŒServeræ¥æ”¶åˆ°åå¤„ç†å¹¶å“åº”ã€‚ä½†æ˜¯æœ‰2ä¸ªä¾‹å¤–çš„åœºæ™¯ï¼š</p>
<ol>
<li><code>Pipeline</code>ï¼šå®¢æˆ·ç«¯ä¼šä¸€æ¬¡æ€§å‘é€å¤šä¸ªè¯·æ±‚å‘½ä»¤ï¼Œç„¶åç­‰å¾…æ‰¹é‡çš„å“åº”ï¼ˆå¤šä¸ªè¯·æ±‚ä¹‹é—´ç”¨<code>\r\n</code>åˆ†éš”ï¼‰</li>
<li><code>Pub/Sub</code>ï¼šä¸å†éœ€è¦å®¢æˆ·ç«¯ä¸»åŠ¨è¯·æ±‚ï¼Œå› ä¸ºæœåŠ¡ç«¯ä¼šåœ¨Channelæœ‰æ–°Messageæ—¶ä¸»åŠ¨é€šçŸ¥å®¢æˆ·ç«¯</li>
</ol>
<p>RESPæ”¯æŒå¤šç§æ•°æ®ç±»å‹å¹¶å¯ä»¥ç”¨ä¸€ä¸ªå­—èŠ‚æšä¸¾ï¼Œè¯·æ±‚å’Œå“åº”çš„æ•°æ®ç”±å¤šç§ä¸åŒæ•°æ®ç±»å‹çš„partç»„æˆã€‚æ¯ä¸ªpartçš„æ•°æ®ä»¥ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºçš„æ•°æ®ç±»å‹å¼€å¤´ï¼Œ<code>\r\n(CRLF)</code>ç»“å°¾ã€‚</p>
<p>RESP3åœ¨RESP2çš„åŸºç¡€ä¸Šé¢å¤–å¢åŠ äº†å¤šç§æ•°æ®ç±»å‹ï¼ŒåŒæ—¶åè®®å‘åå…¼å®¹ã€‚RESP3åœ¨Redis 6.0åŠä»¥ä¸Šç‰ˆæœ¬å¼•å…¥ï¼Œä½†æ˜¯ä¸ºäº†ä¿è¯Clientçš„å…¼å®¹é»˜è®¤æ˜¯å…³é—­çš„ï¼Œå¯ä»¥é€šè¿‡<code>HELLO 3</code>å‘½ä»¤å‡çº§ä¸ºRESP3ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡<code>HELLO 2</code>é™çº§å›RESP2ã€‚</p>
<div class="tabs" id="respæ•°æ®ç±»å‹è¯´æ˜"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#respæ•°æ®ç±»å‹è¯´æ˜-1">RESP2</button></li><li class="tab"><button type="button" data-href="#respæ•°æ®ç±»å‹è¯´æ˜-2">RESP3ä¸­å¼•å…¥</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="respæ•°æ®ç±»å‹è¯´æ˜-1"><table>
<thead>
<tr>
<th>æ•°æ®ç±»å‹</th>
<th>first byte</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td>Simple String</td>
<td>+</td>
<td><code>+&lt;string&gt;\r\n</code>ã€‚å­—ç¬¦ä¸²ä¸­ä¸èƒ½åŒ…å«CRæˆ–LFï¼Œæ‰€ä»¥ä¸æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„</td>
<td><code>+PONG\r\n</code></td>
</tr>
<tr>
<td>Simple Error</td>
<td>-</td>
<td>è§„åˆ™ä¸Simple Stringç›¸åŒã€‚ç¬¬ä¸€ä¸ªå¤§å†™å•è¯ä»£è¡¨é”™è¯¯ç ï¼Œå®¢æˆ·ç«¯ä¼šæŠŠå­—ç¬¦ä¸²å½“æˆå¼‚å¸¸ä¿¡æ¯æ¥å¤„ç†</td>
<td><code>-Error message\r\n</code></td>
</tr>
<tr>
<td>Number</td>
<td>:</td>
<td>64ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œ<code>:&lt;number&gt;\r\n</code>ã€‚INCR, LLENç­‰å‘½ä»¤ä¼šè¿”å›å…·ä½“çš„æ•°å€¼ï¼Œè€ŒSETNX, EXISTSç­‰å‘½ä»¤ä¼šè¿”å›1ä»£è¡¨<code>true/å®é™…æ‰§è¡Œäº†æ“ä½œ</code> æˆ– 0ä»£è¡¨<code>false/æ²¡æœ‰æ‰§è¡Œæ“ä½œ</code></td>
<td><code>:666\r\n</code></td>
</tr>
<tr>
<td>Blob String</td>
<td>$</td>
<td><code>$&lt;length&gt;\r\n&lt;bytes&gt;\r\n</code>ï¼Œå› ä¸ºæœ‰å­—èŠ‚é•¿åº¦ï¼Œæ‰€ä»¥æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚åœ¨RESP2ä¸­ä½¿ç”¨<code>$-1\r\n</code>è¡¨ç¤ºNullï¼Œæ¯”å¦‚GETçš„keyä¸å­˜åœ¨</td>
<td><code>$3\r\nfoo\r\n</code></td>
</tr>
<tr>
<td>Array</td>
<td>*</td>
<td>Clientä½¿ç”¨æ•°ç»„æ¥å‘é€å‘½ä»¤ï¼ŒæŸäº›å‘½ä»¤Serverä¹Ÿä¼šè¿”å›æ•°ç»„ï¼Œä¾‹å¦‚<code>SMEMBERS</code>ã€‚â€*â€ åé¢è·Ÿç€æ•°ç»„é•¿åº¦Nï¼Œéšåæ˜¯CRLFï¼Œæ¥ç€æ˜¯Nä¸ªä»»ä½•ç±»å‹çš„å…ƒç´ ï¼ˆå¯ä»¥æ˜¯ä¸åŒç±»å‹ï¼‰</td>
<td><code>*2\r\n$3\r\nfoo\r\n$3\r\nbar\r\n</code></td>
</tr>
</tbody></table><button type="button" class="tab-to-top" onclick="scrollToDest($(this).parents('.tabs'),65)"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="respæ•°æ®ç±»å‹è¯´æ˜-2"><table>
<thead>
<tr>
<th>æ•°æ®ç±»å‹</th>
<th>first byte</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td>Null</td>
<td>_</td>
<td><code>_\r\n</code></td>
<td><code>_\r\n</code></td>
</tr>
<tr>
<td>Double</td>
<td>,</td>
<td><code>,&lt;floating-point-number&gt;\r\n</code>ï¼Œ<code>inf</code>è¡¨ç¤ºæ­£æ— ç©·ï¼Œ<code>-inf</code>è¡¨ç¤ºè´Ÿæ— ç©·</td>
<td><code>,3.1415926\r\n</code></td>
</tr>
<tr>
<td>Boolean</td>
<td>#</td>
<td><code>#t\r\n</code>ä»£è¡¨Trueï¼Œ<code>#\f\r\n</code>ä»£è¡¨False</td>
<td></td>
</tr>
<tr>
<td>Blob Error</td>
<td>!</td>
<td>è§„åˆ™ä¸Blob Stringç›¸åŒã€‚ç¬¬ä¸€ä¸ªå¤§å†™å•è¯ä»£è¡¨é”™è¯¯ç ï¼Œå®¢æˆ·ç«¯ä¼šæŠŠå­—ç¬¦ä¸²å½“æˆå¼‚å¸¸ä¿¡æ¯æ¥å¤„ç†</td>
<td><code>!21\r\nSYNTAX invalid syntax\r\n</code></td>
</tr>
<tr>
<td>Verbatim String</td>
<td>=</td>
<td>è§„åˆ™ä¸Šä¸Blob Stringç±»ä¼¼ï¼Œå‰ä¸‰ä¸ªå­—èŠ‚è¡¨ç¤ºå¯Œæ–‡æœ¬ç±»å‹ï¼Œæ¯”å¦‚<code>txt</code>/<code>mkd</code>ï¼Œç¬¬å››ä¸ªå­—èŠ‚ä¸º<code>:</code>ï¼Œç„¶åæ˜¯çœŸæ­£çš„å­—ç¬¦ä¸²</td>
<td><code>=8\r\ntxt:test\r\n</code></td>
</tr>
<tr>
<td>Big Number</td>
<td>(</td>
<td>ç”¨æ¥ä»£è¡¨è¶…è¿‡æœ‰ç¬¦å·64æ•´æ•°çš„æ•°å­—ï¼Œ<code>(&lt;big number&gt;\r\n</code>ã€‚å¤§æ•°å¯ä»¥æ˜¯æ­£æ•°æˆ–è´Ÿæ•°ï¼Œä½†ä¸èƒ½åŒ…å«å°æ•°éƒ¨åˆ†</td>
<td><code>(3492890328409238509324850943850943825024385\r\n</code></td>
</tr>
<tr>
<td>Map</td>
<td>%</td>
<td>ä¸Arrayç±»ä¼¼ï¼Œâ€%â€åè·Ÿç€é”®å€¼å¯¹çš„ä¸ªæ•°Nï¼Œéšåæ˜¯CRLFï¼Œæ¥ç€æ˜¯Nä¸ªä»»ä½•ç±»å‹çš„Key-Valueå¯¹</td>
<td><code>%2\r\n+foo\r\n:1\r\n+bar\r\n#t\r\n</code></td>
</tr>
<tr>
<td>Set</td>
<td>~</td>
<td>ä¸Arrayç±»ä¼¼ï¼Œä¸è¿‡è¯­ä¹‰ä¸Šç¨æœ‰ä¸åŒï¼ŒSetè¿”å›çš„å…ƒç´ æ˜¯æ— åºçš„ã€‚åè®®ä¸Šå¹¶æ²¡æœ‰å¼ºåˆ¶ä¿è¯Setå†…çš„å…ƒç´ ä¸é‡å¤ï¼ŒClientéœ€è¦å¤„ç†è¿™ç§æƒ…å†µ</td>
<td><code>~3\r\n+foo\r\n:1\r\n#f\r\n</code></td>
</tr>
</tbody></table><button type="button" class="tab-to-top" onclick="scrollToDest($(this).parents('.tabs'),65)"><i class="fas fa-arrow-up"></i></button></div></div></div>

<blockquote>
<p> ä¸‹é¢æˆ‘ä»¬é€šè¿‡ncå‘½ä»¤ï¼Œä½¿ç”¨RESPåè®®å°è¯•ä¸åŒçš„è¯·æ±‚å‘½ä»¤ï¼ŒåŠ æ·±ä¸‹ç†è§£ã€‚</p>
<p><strong><em>Tipsï¼š</em></strong>å½“æˆ‘ä»¬éœ€è¦åœ¨çº¿ä¸Šç¯å¢ƒå®šä½é—®é¢˜æ—¶ï¼Œå¯èƒ½æ²¡æœ‰æ˜“ç”¨çš„redis-cliå‘½ä»¤ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ncå‘½ä»¤æŒ‰ç…§RESPè§„èŒƒè¿›è¡Œè¯·æ±‚ã€‚å½“ç„¶Redisä¹Ÿæä¾›äº†å¦ä¸€ç§ç®€åŒ–çš„ä½¿ç”¨æ–¹å¼ï¼Œå«åš<code>å†…è”å‘½ä»¤(Inline Commands)</code>ï¼Œ å¯ä»¥é€šè¿‡ç©ºæ ¼åˆ†éš”çš„å‚æ•°è¿›è¡Œè¯·æ±‚ã€‚</p>
</blockquote>
<div class="tabs" id="resp2åè®®ä½¿ç”¨"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#resp2åè®®ä½¿ç”¨-1">ä½¿ç”¨RESP2</button></li><li class="tab"><button type="button" data-href="#resp2åè®®ä½¿ç”¨-2">å†…è”å‘½ä»¤</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="resp2åè®®ä½¿ç”¨-1"><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &#x27;*1\r\n$7\r\nUNKNOWN\r\n&#x27; | nc redis 6379</span><br><span class="line">-ERR unknown command `UNKNOWN`, with args beginning with: </span><br><span class="line"></span><br><span class="line">echo &#x27;*2\r\n$3\r\nGET\r\n$3\r\nfoo\r\n&#x27; | nc redis 6379</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">-1</span></span><br><span class="line"></span><br><span class="line">echo &#x27;*3\r\n$3\r\nSET\r\n$3\r\nfoo\r\n$6\r\nfooval\r\n&#x27; | nc redis 6379</span><br><span class="line">+OK</span><br><span class="line"></span><br><span class="line">echo &#x27;*2\r\n$3\r\nGET\r\n$3\r\nfoo\r\n&#x27; | nc redis 6379</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">6</span></span><br><span class="line">fooval</span><br><span class="line"></span><br><span class="line">echo &#x27;*3\r\n$5\r\nSETNX\r\n$3\r\nfoo\r\n$6\r\nfooval\r\n&#x27; | nc redis 6379</span><br><span class="line">:0	# SETNXï¼Œæ­¤æ—¶fooå·²ç»å­˜åœ¨ï¼Œæ‰€ä»¥è¿”å›:0è¡¨ç¤ºæ²¡æœ‰æ‰§è¡Œæ“ä½œ</span><br><span class="line"></span><br><span class="line">echo &#x27;*5\r\n$5\r\nLPUSH\r\n$3\r\nbar\r\n$2\r\nv1\r\n$2\r\nv2\r\n$2\r\nv3\r\n&#x27; | nc redis 6379</span><br><span class="line">:3</span><br><span class="line"></span><br><span class="line">echo &#x27;*4\r\n$6\r\nLRANGE\r\n$3\r\nbar\r\n$1\r\n0\r\n$2\r\n-1\r\n&#x27; | nc redis 6379 </span><br><span class="line">*3</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">2</span></span><br><span class="line">v3</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">2</span></span><br><span class="line">v2</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">2</span></span><br><span class="line">v1</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" onclick="scrollToDest($(this).parents('.tabs'),65)"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="resp2åè®®ä½¿ç”¨-2"><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &#x27;UNKNOWN&#x27; | nc redis 6379</span><br><span class="line">-ERR unknown command `UNKNOWN`, with args beginning with:</span><br><span class="line"></span><br><span class="line">echo &#x27;GET foo&#x27; | nc redis 6379</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">-1</span></span><br><span class="line"></span><br><span class="line">echo &#x27;SET foo foovalue&#x27; | nc redis 6379</span><br><span class="line">+OK</span><br><span class="line"></span><br><span class="line">echo &#x27;SET foo foovalue NX&#x27; | nc redis 6379</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">-1</span></span><br><span class="line"></span><br><span class="line">echo &#x27;lpush bar v1 v2 v3&#x27; | nc redis 6379</span><br><span class="line">:3</span><br><span class="line"></span><br><span class="line">echo &#x27;lrange bar 0 -1&#x27; | nc redis 6379</span><br><span class="line">*3</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">2</span></span><br><span class="line">v3</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">2</span></span><br><span class="line">v2</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">2</span></span><br><span class="line">v1</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" onclick="scrollToDest($(this).parents('.tabs'),65)"><i class="fas fa-arrow-up"></i></button></div></div></div>

<h4 id="æ·˜æ±°æœºåˆ¶"><a href="#æ·˜æ±°æœºåˆ¶" class="headerlink" title="æ·˜æ±°æœºåˆ¶"></a>æ·˜æ±°æœºåˆ¶</h4><ul>
<li>æ¯æ¬¡lookupKeyéƒ½ä¼šæ›´æ–°robjçš„lruå€¼</li>
<li>LFUçš„ä½16ä½å­˜å‚¨ä¸Šæ¬¡è®¿é—®çš„æ—¶é—´æˆ³å¯¹åº”çš„åˆ†é’Ÿæ•°</li>
</ul>
<h3 id="å†…å­˜ç¼“å­˜"><a href="#å†…å­˜ç¼“å­˜" class="headerlink" title="å†…å­˜ç¼“å­˜"></a>å†…å­˜ç¼“å­˜</h3><h2 id="æ¶ˆæ¯é˜Ÿåˆ—"><a href="#æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—"></a>æ¶ˆæ¯é˜Ÿåˆ—</h2><h2 id="ç¼–ç -amp-å‹ç¼©-amp-åŠ å¯†"><a href="#ç¼–ç -amp-å‹ç¼©-amp-åŠ å¯†" class="headerlink" title="ç¼–ç  &amp; å‹ç¼© &amp; åŠ å¯†"></a>ç¼–ç  &amp; å‹ç¼© &amp; åŠ å¯†</h2><h3 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h3><p>ç¼–ç çš„æœ¬è´¨å°±æ˜¯åŒæ–¹æ ¹æ®ä¸€å®šçš„è§„åˆ™å¯¹æ•°æ®è¿›è¡Œå¤„ç†</p>
<h4 id="å­—ç¬¦ç¼–ç "><a href="#å­—ç¬¦ç¼–ç " class="headerlink" title="å­—ç¬¦ç¼–ç "></a>å­—ç¬¦ç¼–ç </h4><ul>
<li>å­—ç¬¦ï¼šå„ç§æ–‡å­—å’Œç¬¦å·çš„æ€»ç§°ï¼ŒåŒ…æ‹¬å„å›½å®¶æ–‡å­—ã€æ ‡ç‚¹ç¬¦å·ã€å›¾å½¢ç¬¦å·ã€æ•°å­—ç­‰ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¿¡æ¯å•ä½ï¼Œä¸€ä¸ªæ•°å­—æ˜¯ä¸€ä¸ªå­—ç¬¦ï¼Œä¸€ä¸ªæ–‡å­—æ˜¯ä¸€ä¸ªå­—ç¬¦ï¼Œä¸€ä¸ªæ ‡ç‚¹ç¬¦å·ä¹Ÿæ˜¯ä¸€ä¸ªå­—ç¬¦ã€‚</li>
<li>å­—ç¬¦é›†ï¼šå­—ç¬¦çš„é›†åˆï¼Œä¸åŒé›†åˆæ”¯æŒçš„å­—ç¬¦èŒƒå›´è‡ªç„¶ä¹Ÿä¸ä¸€æ ·ï¼Œè­¬å¦‚ASCIIåªæ”¯æŒè‹±æ–‡ï¼ŒGB18030æ”¯æŒä¸­æ–‡ç­‰ç­‰ã€‚åœ¨å­—ç¬¦é›†ä¸­å­˜åœ¨ä¸€ä¸ªç è¡¨ï¼Œæ¯ä¸ªå­—ç¬¦åœ¨å„è‡ªå­—ç¬¦é›†å¯¹åº”ç€å”¯ä¸€ä¸€ä¸ªç ã€‚ä½†æ˜¯åŒä¸€ä¸ªå­—ç¬¦åœ¨ä¸åŒçš„å­—ç¬¦é›†ä¸­å¯¹åº”çš„ç ä¸åŒï¼Œæ¯”å¦‚å­—ç¬¦â€œä¸–â€åœ¨Unicodeä¸­ä¸º<code>U+4e16</code>ï¼Œåœ¨GBKä¸­ä¸º<code>0xcac0</code></li>
<li>å­—ç¬¦ç¼–ç ï¼šå®šä¹‰å­—ç¬¦é›†ä¸­çš„å­—ç¬¦å¦‚ä½•ç¼–ç ä¸ºç‰¹å®šçš„äºŒè¿›åˆ¶æ•°ï¼Œä»¥ä¾¿åœ¨è®¡ç®—æœºä¸­å­˜å‚¨ã€‚å­—ç¬¦é›†ä¸å­—ç¬¦ç¼–ç é€šå¸¸æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œæ¯”å¦‚GB18030æ—¢å¯ä»¥ä»£è¡¨å­—ç¬¦é›†ä¹Ÿå¯ä»¥ä»£è¡¨å­—ç¬¦ç¼–ç ï¼Œå®ƒä¸ºäº†å…¼å®¹ASCIIç ï¼Œç¼–ç æ–¹å¼ä¸ºå¤§äº255é‡‡ç”¨ä¸¤å­—èŠ‚æ¥ä»£è¡¨ä¸€ä¸ªå­—ç¬¦ï¼Œå¦åˆ™å°±æ˜¯å…¼å®¹æ¨¡å¼ï¼Œä¸€ä¸ªå­—èŠ‚ä»£è¡¨ä¸€ä¸ªå­—ç¬¦ã€‚å½“ç„¶ä¹Ÿå­˜åœ¨ç‰¹ä¾‹ï¼Œæ¯”å¦‚Unicodeå­—ç¬¦é›†å°±æœ‰å¤šç§ç¼–ç å®ç°ï¼ˆUTF-8ï¼ŒUTF-16ç­‰ï¼‰</li>
</ul>
<h5 id="å­—ç¬¦é›†ä¸å­—ç¬¦ç¼–ç å‘å±•å²"><a href="#å­—ç¬¦é›†ä¸å­—ç¬¦ç¼–ç å‘å±•å²" class="headerlink" title="å­—ç¬¦é›†ä¸å­—ç¬¦ç¼–ç å‘å±•å²"></a>å­—ç¬¦é›†ä¸å­—ç¬¦ç¼–ç å‘å±•å²</h5><ul>
<li>æœ€æ—©çš„è®¡ç®—æœºåªéœ€è¦ä½¿ç”¨è‹±æ–‡ç¬¦å·ï¼ŒåŠ ä¸Šæ•°å­—å’Œä¸€äº›ç‰¹æ®Šç¬¦å·ï¼Œç„¶åç”¨8ä½äºŒè¿›åˆ¶æ˜ å°„åˆ°128ä¸ªä¸åŒçš„å­—ç¬¦ä¸²é‡Œï¼Œè¿™æ ·å°±èƒ½è¡¨ç¤ºæ—¥å¸¸éœ€è¦çš„æ‰€æœ‰å­—ç¬¦äº†ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ASCIIç ï¼ˆAmerican Standard Code for Information Interchangeï¼Œç¾å›½ä¿¡æ¯äº¤æ¢æ ‡å‡†ä»£ç ï¼‰ã€‚åœ¨ASCIIç ä¸­ï¼Œ0<del>31æ˜¯æ§åˆ¶å­—ç¬¦å¦‚æ¢è¡Œåˆ é™¤ç­‰ï¼Œ32</del>126æ˜¯å¯æ‰“å°å­—ç¬¦å¯ä»¥é€šè¿‡é”®ç›˜è¾“å‡ºå¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚</li>
<li>åæ¥è®¡ç®—æœºä¼ å…¥æ¬§æ´²ï¼Œä¸€äº›æ¬§æ´²å›½å®¶å†³å®šå¯¹ASCIIç¼–ç è¿›è¡Œé€‚å½“çš„â€œæ”¹é€ â€ï¼šåˆ©ç”¨å­—èŠ‚ä¸­é—²ç½®çš„æœ€é«˜ä½ç¼–å…¥æ–°çš„ç¬¦å·ï¼Œè¿™æ ·ä¸€æ¥å¯ä»¥è¡¨ç¤ºæœ€å¤š256ä¸ªç¬¦å·ã€‚ä½†æ˜¯æ¬§æ´²çš„è¯­è¨€ä½“ç³»æœ‰ä¸ªç‰¹ç‚¹ï¼šå°å›½å®¶ç‰¹åˆ«å¤šï¼Œæ¯ä¸ªå›½å®¶å¯èƒ½éƒ½æœ‰è‡ªå·±çš„è¯­è¨€ä½“ç³»ï¼Œå› æ­¤å³ä¾¿æœ‰256ä¸ªå­—ç¬¦ä¹Ÿæ²¡åŠæ³•ç»Ÿä¸€æ¬§æ´²çš„è¯­è¨€ç¯å¢ƒã€‚åæ¥å¤§å®¶æƒ³äº†ä¸€ä¸ªæŠ˜ä¸­çš„æ–¹æ¡ˆï¼šåœ¨256ä¸ªå­—ç¬¦ä¸­ï¼Œå‰128å­—ç¬¦å’ŒASCIIç¼–ç è¡¨ç¤ºçš„å­—ç¬¦å®Œå…¨ä¸€æ ·ï¼Œå128ä¸ªå­—ç¬¦æ¯ä¸ªå›½å®¶æˆ–åœ°åŒºéƒ½æœ‰è‡ªå·±çš„ç¼–ç æ ‡å‡†ã€‚æ ¹æ®è¿™ä¸ªè§„åˆ™ï¼Œå½¢æˆäº†å¾ˆå¤šå­æ ‡å‡†ï¼šISO-8859-1ã€ISO-8859-2ã€‚ã€‚ã€‚</li>
<li>è®¡ç®—æœºä¼ å…¥äºšæ´²åï¼Œå›½é™…æ ‡å‡†å·²è¢«å®Œå…¨ä¸å¤Ÿç”¨ï¼Œå„ä¸ªå›½å®¶æ ¹æ®è‡ªå·±çš„åœ°åŒºç‰¹è‰²ï¼Œå‘æ˜äº†é€‚ç”¨è‡ªèº«çš„å­—ç¬¦é›†ä¸ç¼–ç ï¼Œè­¬å¦‚ä¸­å›½å¤§é™†çš„GB2312ï¼Œæ—¥æœ¬çš„Shift JISç­‰ç­‰ è¿™äº›ç¼–ç éƒ½æ˜¯ç”¨åŒå­—èŠ‚æ¥è¿›è¡Œå­˜å‚¨ï¼Œå®ƒä»¬å¯¹å¤–æœ‰ä¸€ä¸ªç»Ÿç§°ANSIï¼ˆAmerican National Standards Instituteï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´GB2312æˆ–Shift JISç­‰éƒ½æ˜¯ANSIåœ¨å„è‡ªåœ°åŒºçš„ä¸åŒæ ‡å‡†ã€‚</li>
<li>åˆ°äº†å…¨çƒäº’è”ç½‘æ—¶ä»£ï¼Œä¸åŒå›½å®¶éœ€è¦åœ¨äº’è”ç½‘ä¸Šè¿›è¡Œä¿¡æ¯äº¤äº’ï¼Œè¿™æ—¶å€™ç”±äºå„è‡ªç¼–ç æ ‡å‡†éƒ½ä¸ä¸€æ ·ï¼Œå½¼æ­¤ä¹‹é—´éƒ½æ˜¯ä¹±ç ï¼Œæ— æ³•è‰¯å¥½çš„æ²Ÿé€šäº¤æµã€‚äºæ˜¯è¿™æ—¶å€™ISOç»„ç»‡ä¸ç»Ÿä¸€ç è”ç›Ÿæ•´åˆæ¨å‡ºäº†Unicodeå­—ç¬¦é›†ï¼Œå®ƒä½¿ç”¨4å­—èŠ‚çš„æ•°å­—æ¥è¡¨è¾¾æ¯ä¸ªå­—ç¬¦ã€‚æ¯ä¸ªæ•°å­—ä»£è¡¨å”¯ä¸€çš„è‡³å°‘åœ¨æŸç§è¯­è¨€ä¸­ä½¿ç”¨çš„å­—ç¬¦ã€‚è¿™æ—¶å€™æ‰€æœ‰çš„å­—ç¬¦éƒ½å¯ä»¥é‡‡ç”¨åŒä¸€ä¸ªå­—ç¬¦é›†ï¼Œæœ‰ç€ç›¸åŒçš„ç¼–ç ï¼Œå¯ä»¥æ„‰å¿«çš„è¿›è¡Œäº¤æµäº†ã€‚</li>
</ul>
<h5 id="UTF-8ç¼–ç è§„åˆ™"><a href="#UTF-8ç¼–ç è§„åˆ™" class="headerlink" title="UTF-8ç¼–ç è§„åˆ™"></a>UTF-8ç¼–ç è§„åˆ™</h5><p><strong>UTF-8</strong>ï¼ˆ8-bit Unicode Transformation Formatï¼‰æ˜¯ä¸€ç§é’ˆå¯¹Unicodeçš„å¯å˜é•¿åº¦å­—ç¬¦ç¼–ç ã€‚å®ƒå¯ä»¥ç”¨æ¥è¡¨ç¤ºUnicodeæ ‡å‡†ä¸­çš„ä»»ä½•å­—ç¬¦ï¼Œä¸”å…¶ç¼–ç ä¸­çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ä»ä¸ASCIIå…¼å®¹ã€‚</p>
<p>UTF-8 çš„ç¼–ç è§„åˆ™å¾ˆç®€å•ï¼š</p>
<ol>
<li>å¯¹äºå•å­—èŠ‚å­—ç¬¦ï¼Œä¸ASCIIç¼–ç å®Œå…¨ç›¸åŒ</li>
<li>å¯¹äº<code>n</code>å­—èŠ‚çš„å­—ç¬¦ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚çš„å‰<code>n</code>ä¸ªbitéƒ½ç½®ä¸º1ï¼Œç¬¬<code>n+1</code>ä¸ªbitç½®ä¸º<code>0</code>ï¼Œåé¢å­—èŠ‚çš„å‰ä¸¤ä½ä¸€å¾‹ç½®ä¸º<code>10</code>ï¼Œå‰©ä½™çš„bitç”¨äºä»å·¦è‡³å³ä¾æ¬¡å­˜å‚¨Unicodeçš„ç ç‚¹</li>
</ol>
<p>Unicodeä¸UTF-8è½¬æ¢å…³ç³»è¡¨</p>
<table>
<thead>
<tr>
<th>Unicodeç ç‚¹ä½æ•°</th>
<th>Unicodeç ç‚¹èŒƒå›´</th>
<th>UTF-8å­—èŠ‚åº</th>
</tr>
</thead>
<tbody><tr>
<td>[0, 7]</td>
<td>U+0000~U+007F</td>
<td>0xxxxxxx</td>
</tr>
<tr>
<td>[8, 11]</td>
<td>U+0080~U+07FF</td>
<td>110xxxxx 10xxxxxx</td>
</tr>
<tr>
<td>[12, 16]</td>
<td>U+0800~U+FFFF</td>
<td>1110xxxx 10xxxxxx 10xxxxxx</td>
</tr>
<tr>
<td>[17, 21]</td>
<td>U+10000~U+1FFFFF</td>
<td>11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</td>
</tr>
<tr>
<td>[22, 26]</td>
<td>U+200000~U+3FFFFFF</td>
<td>111110xx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx</td>
</tr>
<tr>
<td>[27, 31]</td>
<td>U+4000000~U+7FFFFFFF</td>
<td>1111110x 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx</td>
</tr>
</tbody></table>
<p>ä¸¾å‡ ä¸ªä¾‹å­</p>
<table>
<thead>
<tr>
<th>å­—ç¬¦</th>
<th>Unicode</th>
<th>UTF-8</th>
</tr>
</thead>
<tbody><tr>
<td>Ä€</td>
<td>U+0100</td>
<td>11000100 10000000 = C4 80</td>
</tr>
<tr>
<td>ä¸–</td>
<td>U+4E16</td>
<td>11100100 10111000 10010110 = E4 B8 96</td>
</tr>
<tr>
<td>ğŸ…</td>
<td>U+1F385</td>
<td>11110000 10011111 10001110 10000101 = F0 9F 8E 85</td>
</tr>
</tbody></table>
<h5 id="æ‰‹æŒä¸¤æŠŠé”Ÿæ–¤æ‹·ï¼Œå£ä¸­ç–¾å‘¼çƒ«çƒ«çƒ«"><a href="#æ‰‹æŒä¸¤æŠŠé”Ÿæ–¤æ‹·ï¼Œå£ä¸­ç–¾å‘¼çƒ«çƒ«çƒ«" class="headerlink" title="æ‰‹æŒä¸¤æŠŠé”Ÿæ–¤æ‹·ï¼Œå£ä¸­ç–¾å‘¼çƒ«çƒ«çƒ«"></a>æ‰‹æŒä¸¤æŠŠé”Ÿæ–¤æ‹·ï¼Œå£ä¸­ç–¾å‘¼çƒ«çƒ«çƒ«</h5><h5 id="MySQLä¸­çš„utf8mb4"><a href="#MySQLä¸­çš„utf8mb4" class="headerlink" title="MySQLä¸­çš„utf8mb4"></a>MySQLä¸­çš„utf8mb4</h5><p>utf8æ— æ³•å­˜å‚¨emojiï¼Œå› ä¸ºMySQLä¸­çš„utf8æœ€å¤šåªç”¨3å­—èŠ‚å­˜å‚¨ï¼Œè€Œemojiä½¿ç”¨4å­—èŠ‚ç¼–ç ï¼Œæ¯”å¦‚ğŸ…çš„16è¿›åˆ¶ç¼–ç ä¸º<code>0xF09F8E85</code></p>
<h5 id="Python2ä¸­è®¨åŒçš„ç¼–ç "><a href="#Python2ä¸­è®¨åŒçš„ç¼–ç " class="headerlink" title="Python2ä¸­è®¨åŒçš„ç¼–ç "></a>Python2ä¸­è®¨åŒçš„ç¼–ç </h5><h4 id="Protobuf"><a href="#Protobuf" class="headerlink" title="Protobuf"></a>Protobuf</h4><h5 id="varint"><a href="#varint" class="headerlink" title="varint"></a>varint</h5><h5 id="zigzag"><a href="#zigzag" class="headerlink" title="zigzag"></a>zigzag</h5><h4 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h4><h5 id="simdjsonæ˜¯ä½•æ–¹ç¥åœ£"><a href="#simdjsonæ˜¯ä½•æ–¹ç¥åœ£" class="headerlink" title="simdjsonæ˜¯ä½•æ–¹ç¥åœ£"></a>simdjsonæ˜¯ä½•æ–¹ç¥åœ£</h5><h4 id="Base64å®¶æ—"><a href="#Base64å®¶æ—" class="headerlink" title="Base64å®¶æ—"></a>Base64å®¶æ—</h4><h3 id="å‹ç¼©"><a href="#å‹ç¼©" class="headerlink" title="å‹ç¼©"></a>å‹ç¼©</h3><h4 id="GZip"><a href="#GZip" class="headerlink" title="GZip"></a>GZip</h4><h4 id="LZ4"><a href="#LZ4" class="headerlink" title="LZ4"></a>LZ4</h4><h4 id="Snappy"><a href="#Snappy" class="headerlink" title="Snappy"></a>Snappy</h4><h3 id="åŠ å¯†"><a href="#åŠ å¯†" class="headerlink" title="åŠ å¯†"></a>åŠ å¯†</h3><h4 id="éå¯¹ç§°åŠ å¯†"><a href="#éå¯¹ç§°åŠ å¯†" class="headerlink" title="éå¯¹ç§°åŠ å¯†"></a>éå¯¹ç§°åŠ å¯†</h4><h5 id="RSAç®—æ³•çš„æ•°å­¦åŸç†"><a href="#RSAç®—æ³•çš„æ•°å­¦åŸç†" class="headerlink" title="RSAç®—æ³•çš„æ•°å­¦åŸç†"></a>RSAç®—æ³•çš„æ•°å­¦åŸç†</h5><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://segmentfault.com/a/1190000014871852">https://segmentfault.com/a/1190000014871852</a></li>
</ul>
<h2 id="åˆ†å¸ƒå¼"><a href="#åˆ†å¸ƒå¼" class="headerlink" title="åˆ†å¸ƒå¼"></a>åˆ†å¸ƒå¼</h2><p><a target="_blank" rel="external nofollow noopener noreferrer" href="http://thesecretlivesofdata.com/raft/">http://thesecretlivesofdata.com/raft/</a></p>
<h2 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h2><h2 id="å†…å­˜åˆ†é…ä¸å›æ”¶"><a href="#å†…å­˜åˆ†é…ä¸å›æ”¶" class="headerlink" title="å†…å­˜åˆ†é…ä¸å›æ”¶"></a>å†…å­˜åˆ†é…ä¸å›æ”¶</h2><p>åˆ†é…å™¨å¤šç§å¤šæ ·ï¼Œæ¯”å¦‚é€šç”¨çš„jemallocã€tcmallocï¼Œæˆ–è€…å„ä¸ªè¯­è¨€è‡ªå·±å®ç°çš„æ¯”å¦‚pymallocï¼Œä½†æ˜¯ä»–ä»¬çš„ç›®æ ‡æ˜¯ä¸€æ ·çš„ï¼š</p>
<ol>
<li>åŸºæœ¬åŠŸèƒ½ï¼šå°†ä¸€å—å†…å­˜æ ¹æ®å›ºå®šå•ä½çš„é¡µå®šä¹‰å‡ºæ¥ï¼Œç„¶ååŒºåˆ†å¯¹è±¡å¤§å°åˆ†åˆ«ç®¡ç†å†…å­˜ï¼Œå°å†…å­˜åˆ†æˆè‹¥å¹²ç±»ï¼Œä¸“é—¨ç”¨æ¥åˆ†é…å›ºå®šå¤§å°çš„å†…å­˜å—ï¼Œå¹¶ç”¨ä¸€ä¸ªè¡¨ç®¡ç†èµ·æ¥ï¼Œé™ä½å†…éƒ¨ç¢ç‰‡ï¼Œå‡å°‘Page Faultï¼Œæå‡å†…å­˜åˆ†é…é€Ÿåº¦ã€‚å¤§å†…å­˜åˆ™ä»¥é¡µä¸ºå•ä½ç®¡ç†ï¼Œé…åˆå°å¯¹è±¡æ‰€åœ¨é¡µï¼Œ é™ä½ç¢ç‰‡ã€‚</li>
<li>å›æ”¶ï¼šå½“é‡Šæ”¾å†…å­˜æ—¶ï¼Œè¦èƒ½å¤Ÿåˆå¹¶å°å†…å­˜ä¸ºå¤§å†…å­˜ï¼Œæ ¹æ®ä¸€äº›æ¡ä»¶ï¼Œè¯¥ä¿ç•™çš„å°±ä¿ç•™ä¸‹æ¥ï¼Œåœ¨ä¸‹æ¬¡ä½¿ç”¨æ—¶å¯ä»¥å¿«é€Ÿå“åº”</li>
<li>å¤šçº¿ç¨‹ä¸‹æ€§èƒ½ä¼˜åŒ–ï¼šæ¯ä¸ªçº¿ç¨‹ç‹¬å ä¸€æ®µå†…å­˜ï¼Œè¢«ç§°ä¸ºTLSï¼Œè¿™æ ·çº¿ç¨‹å†…æ“ä½œæ—¶å¯ä»¥ä¸åŠ é”ï¼Œæé«˜æ€§èƒ½ã€‚å½“ç‹¬å çš„å†…å­˜ä¸å¤Ÿç”¨æ—¶å†ä»å…¨å±€çš„å†…å­˜ä¸­åˆ†é…ã€‚ä½†éšä¹‹è€Œæ¥çš„ä¹Ÿæœ‰äº›å¾…è§£å†³çš„é—®é¢˜ï¼š<ol>
<li>å¦‚ä½•å°½é‡å‡å°‘åˆ°å…¨å±€å†…å­˜æ± ä¸­åˆ†é…å¯¼è‡´é”å†²çª</li>
<li>å¦‚ä½•è§£å†³ä¸åŒçº¿ç¨‹å†…å­˜åˆ©ç”¨ç‡ä¸ä¸€è‡´å¯¼è‡´çš„overhead</li>
<li>å¦‚ä½•åœ¨ç©ºé—²æ—¶å°†çº¿ç¨‹ç‹¬å å†…å­˜é‡Šæ”¾å›å…¨å±€å†…å­˜ä¸­ä»¥ä¾¿å…¶ä»–çº¿ç¨‹ä½¿ç”¨</li>
</ol>
</li>
</ol>
<p>å½“å ç”¨å†…å­˜çš„å¯¹è±¡ä¸å†å¯èƒ½è¢«ä½¿ç”¨çš„æ—¶å€™ï¼Œéœ€è¦å¯¹å…¶ä½¿ç”¨çš„å†…å­˜è¿›è¡Œå›æ”¶ï¼Œå¸¸è§çš„å›æ”¶ç®—æ³•æœ‰<em>å¼•ç”¨è®¡æ•°æ³•</em>ï¼Œ<em>æ ‡è®°æ¸…é™¤æ³•</em>ï¼Œå®ƒä»¬çš„ç›®æ ‡æ˜¯ï¼š</p>
<ol>
<li>å°½å¯èƒ½å¤šçš„è¯†åˆ«å‡ºä¸ä½¿ç”¨çš„å†…å­˜ç©ºé—´</li>
<li>å‡å°‘å†…å­˜å›æ”¶å¯¼è‡´çš„å¤–éƒ¨ç¢ç‰‡</li>
<li>é™ä½å†…å­˜å›æ”¶å¯¹ç¨‹åºè¿è¡Œçš„å½±å“ï¼Œè€—æ—¶å°½é‡çŸ­</li>
</ol>
<h2 id="eBPF"><a href="#eBPF" class="headerlink" title="eBPF"></a>eBPF</h2><h1 id="ç¼–ç¨‹è¯­è¨€"><a href="#ç¼–ç¨‹è¯­è¨€" class="headerlink" title="ç¼–ç¨‹è¯­è¨€"></a>ç¼–ç¨‹è¯­è¨€</h1><h2 id="C"><a href="#C" class="headerlink" title="C"></a>C</h2><h2 id="C-1"><a href="#C-1" class="headerlink" title="C++"></a>C++</h2><h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><ul>
<li>å†…å­˜ç®¡ç†</li>
</ul>
<h3 id="åº•å±‚å®ç°"><a href="#åº•å±‚å®ç°" class="headerlink" title="åº•å±‚å®ç°"></a>åº•å±‚å®ç°</h3><h4 id="ä¸€åˆ‡çš†å¯¹è±¡"><a href="#ä¸€åˆ‡çš†å¯¹è±¡" class="headerlink" title="ä¸€åˆ‡çš†å¯¹è±¡"></a>ä¸€åˆ‡çš†å¯¹è±¡</h4><h5 id="int"><a href="#int" class="headerlink" title="int"></a>int</h5><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.dongwm.com/post/python-memory-usage-1/">https://www.dongwm.com/post/python-memory-usage-1/</a></p>
<h4 id="import"><a href="#import" class="headerlink" title="import"></a>import</h4><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://juejin.cn/post/6924192092902146055#heading-12">importåŸç†è¯¦ç»†è§£è¯»</a></p>
<h3 id="å¥‡æ·«å·§æŠ€"><a href="#å¥‡æ·«å·§æŠ€" class="headerlink" title="å¥‡æ·«å·§æŠ€"></a>å¥‡æ·«å·§æŠ€</h3><h4 id="new-ä¸-init"><a href="#new-ä¸-init" class="headerlink" title="__new__ä¸__init__"></a><code>__new__</code>ä¸<code>__init__</code></h4><p><code>__new__</code>ç”¨äºåˆ›å»ºå¯¹è±¡ï¼›<code>__init__</code>ç”¨äºåˆå§‹åŒ–å¯¹è±¡ã€‚</p>
<p><code>__new__</code>ä¼šåœ¨ä½¿ç”¨<code>ClassName()</code>åˆ›å»ºå¯¹è±¡æ—¶è‡ªåŠ¨è°ƒç”¨ï¼Œ<code>__init__</code>ä¼šåœ¨newè¿”å›åˆ›å»ºçš„å®ä¾‹åè¢«è°ƒç”¨ï¼Œå¹¶æŠŠè¿”å›çš„å®ä¾‹ä¼ å…¥<code>__init__</code>ï¼Œå¯¹åº”å…¥å‚<code>self</code>ã€‚</p>
<p>å¦‚æœé‡å†™äº†çˆ¶ç±»çš„<code>__new__</code>ä½†æ˜¯å¹¶æ²¡æœ‰è¿”å›å®ä¾‹ï¼Œåˆ™ä¸ä¼šè°ƒç”¨<code>__init__</code></p>
<h4 id="ç±»æ–¹æ³•ä¸å®ä¾‹æ–¹æ³•"><a href="#ç±»æ–¹æ³•ä¸å®ä¾‹æ–¹æ³•" class="headerlink" title="ç±»æ–¹æ³•ä¸å®ä¾‹æ–¹æ³•"></a>ç±»æ–¹æ³•ä¸å®ä¾‹æ–¹æ³•</h4><p>ç±»æ–¹æ³•å¯¹åº”çš„åœ°å€å…¨å±€å”¯ä¸€ï¼Œä¸åŒçš„å¯¹è±¡å¯¹åº”çš„ç±»æ–¹æ³•idéƒ½æ˜¯ç›¸åŒçš„ã€‚</p>
<p>ä¸åŒçš„å¯¹è±¡å¯¹åº”çš„å®ä¾‹æ–¹æ³•idæ˜¯ä¸åŒçš„ï¼Œå®ä¾‹æ–¹æ³•ä¹Ÿå¯ä»¥é€šè¿‡<code>Class.method(object)</code>è°ƒç”¨ï¼Œå®ä¾‹æ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<code>self</code>ä¹Ÿå°±æ˜¯å®ä¾‹ï¼Œæˆ‘ä»¬å¹³å¸¸ç”¨çš„<code>object.method(args)</code>æœ¬è´¨ä¸Šå°±æ˜¯åœ¨å¯¹è±¡åˆ›å»ºæ—¶é€šè¿‡<code>Class.method</code>ç”Ÿæˆä¸€ä¸ªæ–°çš„<code>åå‡½æ•°(partial)</code>ï¼Œå°†ç¬¬ä¸€ä¸ªå‚æ•°ç»‘å®šæˆå®ä¾‹ï¼Œç„¶åé‡æ–°<code>setattr(object,  method, partialed_method)</code>ã€‚</p>
<h4 id="mockçš„åŸç†"><a href="#mockçš„åŸç†" class="headerlink" title="mockçš„åŸç†"></a>mockçš„åŸç†</h4><ol>
<li>Pythonä¸­ä¸€åˆ‡éƒ½æ˜¯å¯¹è±¡ï¼Œmoduleæ˜¯å¯¹è±¡ï¼Œclassæ˜¯å¯¹è±¡ï¼Œfunctionä¹Ÿæ˜¯å¯¹è±¡</li>
<li>globals() å’Œ locals()</li>
<li>setattr()</li>
</ol>
<h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><h3 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h3><h4 id="Object-Header"><a href="#Object-Header" class="headerlink" title="Object Header"></a>Object Header</h4><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://juejin.cn/post/6844904113306615822">https://juejin.cn/post/6844904113306615822</a></li>
</ul>
<h2 id="Scala"><a href="#Scala" class="headerlink" title="Scala"></a>Scala</h2><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://twitter.github.io/scala_school/index.html">Twitter Scala School</a></li>
</ul>
<h2 id="Go"><a href="#Go" class="headerlink" title="Go"></a>Go</h2><h3 id="ä¸ºä»€ä¹ˆGoçš„å¯æ‰§è¡Œæ–‡ä»¶ç‰¹åˆ«å°è¿˜ä¸éœ€è¦ä¾èµ–so"><a href="#ä¸ºä»€ä¹ˆGoçš„å¯æ‰§è¡Œæ–‡ä»¶ç‰¹åˆ«å°è¿˜ä¸éœ€è¦ä¾èµ–so" class="headerlink" title="ä¸ºä»€ä¹ˆGoçš„å¯æ‰§è¡Œæ–‡ä»¶ç‰¹åˆ«å°è¿˜ä¸éœ€è¦ä¾èµ–so"></a>ä¸ºä»€ä¹ˆGoçš„å¯æ‰§è¡Œæ–‡ä»¶ç‰¹åˆ«å°è¿˜ä¸éœ€è¦ä¾èµ–so</h3><h1 id="å†…åŠŸå¿ƒæ³•"><a href="#å†…åŠŸå¿ƒæ³•" class="headerlink" title="å†…åŠŸå¿ƒæ³•"></a>å†…åŠŸå¿ƒæ³•</h1><p><strong>å¯ç»´æŠ¤æ€§ = å½“ä¾èµ–å˜åŒ–æ—¶ï¼Œæœ‰å¤šå°‘ä»£ç éœ€è¦éšä¹‹æ”¹å˜</strong></p>
<p><strong>å¯æ‰©å±•æ€§ = åšæ–°éœ€æ±‚æˆ–æ”¹é€»è¾‘æ—¶ï¼Œéœ€è¦æ–°å¢/ä¿®æ”¹å¤šå°‘ä»£ç </strong></p>
<p><strong>å¯æµ‹è¯•æ€§ = è¿è¡Œæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹æ‰€èŠ±è´¹çš„æ—¶é—´ * æ¯ä¸ªéœ€æ±‚æ‰€éœ€è¦å¢åŠ çš„æµ‹è¯•ç”¨ä¾‹æ•°é‡ * ç¼–å†™æµ‹è¯•ç”¨ä¾‹çš„éš¾æ˜“ç¨‹åº¦</strong> </p>
<h2 id="é¢å‘å¯¹è±¡æ€æƒ³"><a href="#é¢å‘å¯¹è±¡æ€æƒ³" class="headerlink" title="é¢å‘å¯¹è±¡æ€æƒ³"></a>é¢å‘å¯¹è±¡æ€æƒ³</h2><ul>
<li>å››å¤§ç‰¹æ€§ï¼šå°è£…ã€æŠ½è±¡ã€ç»§æ‰¿ã€å¤šæ€</li>
<li>ä¸é¢å‘è¿‡ç¨‹çš„åŒºåˆ«äºè”ç³»</li>
<li>æ¥å£ä¸æŠ½è±¡ç±»</li>
<li>åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹</li>
<li>å¤šç”¨ç»„åˆå°‘ç”¨ç»§æ‰¿</li>
<li>é¢å‘è¿‡ç¨‹çš„è´«è¡€æ¨¡å‹ä¸é¢å‘å¯¹è±¡çš„å……è¡€æ¨¡å‹</li>
</ul>
<h2 id="è®¾è®¡åŸåˆ™"><a href="#è®¾è®¡åŸåˆ™" class="headerlink" title="è®¾è®¡åŸåˆ™"></a>è®¾è®¡åŸåˆ™</h2><ul>
<li>S(Single Responsibility Principle)ï¼šå•ä¸€èŒè´£åŸåˆ™</li>
<li>O(Open Close Principle)ï¼šå¼€é—­åŸåˆ™</li>
<li>L(Liskov Substitution Principle)ï¼šé‡Œæ°æ›¿æ¢åŸåˆ™</li>
<li>I(Interface Segregation Principle)ï¼šæ¥å£éš”ç¦»åŸåˆ™</li>
<li>D(Dependency Inversion Principle)ï¼šä¾èµ–å¯¼è‡´åŸåˆ™</li>
<li>DRY(Donâ€™t Repeat Yourself)</li>
<li>KISS(Keep It Simple, Silly)</li>
<li>YAGNI(You Arenâ€™t Gonna Need It)</li>
<li>LOD(Law Of Demeter): è¿ªç±³ç‰¹æ³•åˆ™ï¼Œåˆå«åšæœ€å°‘çŸ¥è¯†åŸåˆ™</li>
</ul>
<h2 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h2><ul>
<li><p>åˆ›å»ºå‹</p>
<ul>
<li>å¸¸ç”¨ï¼šå•ä¾‹æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼ã€å·¥å‚æ¨¡å¼ï¼ˆç®€å•å·¥å‚ã€å·¥å‚æ–¹æ³•ï¼‰</li>
<li>ä¸å¸¸ç”¨ï¼šæŠ½è±¡å·¥å‚ã€åŸå‹æ¨¡å¼</li>
</ul>
</li>
<li><p>ç»“æ„å‹</p>
<ul>
<li>å¸¸ç”¨ï¼šä»£ç†æ¨¡å¼ã€æ¡¥æ¥æ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼ã€é€‚é…å™¨æ¨¡å¼</li>
<li>ä¸å¸¸ç”¨ï¼šé—¨é¢æ¨¡å¼ã€ç»„åˆæ¨¡å¼ã€äº«å…ƒæ¨¡å¼</li>
</ul>
</li>
<li><p>è¡Œä¸ºå‹</p>
<ul>
<li>å¸¸ç”¨ï¼šè§‚å¯Ÿè€…æ¨¡å¼ã€æ¨¡æ¿æ¨¡å¼ã€ç­–ç•¥æ¨¡å¼ã€èŒè´£é“¾æ¨¡å¼ã€è¿­ä»£å™¨æ¨¡å¼ã€ç©ºå¯¹è±¡æ¨¡å¼</li>
<li>çŠ¶æ€ï¼šè®¿é—®è€…æ¨¡å¼ã€å¤‡å¿˜å½•æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ã€è§£é‡Šå™¨æ¨¡å¼ã€ä¸­ä»‹æ¨¡å¼</li>
</ul>
<h2 id="ç¼–ç è§„èŒƒ"><a href="#ç¼–ç è§„èŒƒ" class="headerlink" title="ç¼–ç è§„èŒƒ"></a>ç¼–ç è§„èŒƒ</h2></li>
<li><p>å‘½åï¼Œå‘½åï¼Œè¿˜æ˜¯å‘½å</p>
</li>
<li><p>å‡½æ•°</p>
</li>
<li><p>å¯¹è±¡å’Œæ•°æ®ç»“æ„</p>
</li>
<li><p>é”™è¯¯å¤„ç†</p>
</li>
<li><p>ç±»</p>
</li>
</ul>
<h2 id="æ¥å£è®¾è®¡è§„èŒƒ"><a href="#æ¥å£è®¾è®¡è§„èŒƒ" class="headerlink" title="æ¥å£è®¾è®¡è§„èŒƒ"></a>æ¥å£è®¾è®¡è§„èŒƒ</h2><p>RESTfulæ¥å£è®¾è®¡å¯ä»¥å‚ç…§Googleçš„è¿™ç¯‡æŒ‡å—</p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://cloud.google.com/apis/design">https://cloud.google.com/apis/design</a></p>
<p>å…·ä½“åº”ç”¨å¯ä»¥å‚è€ƒK8Sçš„æ¥å£è®¾è®¡</p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#-strong-api-overview-strong-">https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#-strong-api-overview-strong-</a></p>
<h2 id="ä»£ç é‡æ„"><a href="#ä»£ç é‡æ„" class="headerlink" title="ä»£ç é‡æ„"></a>ä»£ç é‡æ„</h2><ul>
<li>é‡æ„çš„ç›®çš„ï¼ˆWhyï¼‰ã€å¯¹è±¡ï¼ˆWhatï¼‰ã€æ—¶æœºï¼ˆWhenï¼‰ã€æ–¹æ³•ï¼ˆHowï¼‰</li>
<li>ä¿è¯é‡æ„ä¸å‡ºé”™çš„æŠ€æœ¯æ‰‹æ®µï¼šå•å…ƒæµ‹è¯•ã€ä»£ç å¯æµ‹è¯•æ€§</li>
</ul>
<h2 id="é¢†åŸŸé©±åŠ¨è®¾è®¡"><a href="#é¢†åŸŸé©±åŠ¨è®¾è®¡" class="headerlink" title="é¢†åŸŸé©±åŠ¨è®¾è®¡"></a>é¢†åŸŸé©±åŠ¨è®¾è®¡</h2><h1 id="å¤§æ•°æ®"><a href="#å¤§æ•°æ®" class="headerlink" title="å¤§æ•°æ®"></a>å¤§æ•°æ®</h1><h2 id="æ‰¹æµå¤„ç†"><a href="#æ‰¹æµå¤„ç†" class="headerlink" title="æ‰¹æµå¤„ç†"></a>æ‰¹æµå¤„ç†</h2><h2 id="å­˜å‚¨"><a href="#å­˜å‚¨" class="headerlink" title="å­˜å‚¨"></a>å­˜å‚¨</h2><h2 id="å®æ—¶åˆ†æ"><a href="#å®æ—¶åˆ†æ" class="headerlink" title="å®æ—¶åˆ†æ"></a>å®æ—¶åˆ†æ</h2><h1 id="äº‘åŸç”Ÿ"><a href="#äº‘åŸç”Ÿ" class="headerlink" title="äº‘åŸç”Ÿ"></a>äº‘åŸç”Ÿ</h1><h2 id="è™šæ‹ŸåŒ–æŠ€æœ¯"><a href="#è™šæ‹ŸåŒ–æŠ€æœ¯" class="headerlink" title="è™šæ‹ŸåŒ–æŠ€æœ¯"></a>è™šæ‹ŸåŒ–æŠ€æœ¯</h2><h3 id="KVM"><a href="#KVM" class="headerlink" title="KVM"></a>KVM</h3><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/fs/ioctl.c.html#718">ioctl syscall</a> -&gt; <a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/fs/ioctl.c.html#ksys_ioctl">ksys_ioctl</a> -&gt; <a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/fs/ioctl.c.html#do_vfs_ioctl">do_vfs_ioctl</a> -&gt; <a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/fs/ioctl.c.html#vfs_ioctl">vfs_ioctl</a> -&gt; <a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/virt/kvm/kvm_main.c.html#3321">unlocked_ioctl</a> -&gt; <a target="_blank" rel="external nofollow noopener noreferrer" href="https://code.woboq.org/linux/linux/virt/kvm/kvm_main.c.html#kvm_vm_ioctl">kvm_vm_ioctl</a> -&gt; </p>
<h2 id="å®¹å™¨æŠ€æœ¯"><a href="#å®¹å™¨æŠ€æœ¯" class="headerlink" title="å®¹å™¨æŠ€æœ¯"></a>å®¹å™¨æŠ€æœ¯</h2><h3 id="å®¹å™¨åº•å±‚æ ¸å¿ƒæŠ€æœ¯"><a href="#å®¹å™¨åº•å±‚æ ¸å¿ƒæŠ€æœ¯" class="headerlink" title="å®¹å™¨åº•å±‚æ ¸å¿ƒæŠ€æœ¯"></a>å®¹å™¨åº•å±‚æ ¸å¿ƒæŠ€æœ¯</h3><h4 id="Namespace"><a href="#Namespace" class="headerlink" title="Namespace"></a>Namespace</h4><h4 id="CGroup"><a href="#CGroup" class="headerlink" title="CGroup"></a>CGroup</h4><ul>
<li>OOM Killè¿›ç¨‹çš„æ—¥å¿—å¯ä»¥åœ¨<code>/var/log/kern.log</code>ä¸­æŸ¥çœ‹ï¼Œ</li>
</ul>
<p><img src="https://cdn.leosocy.top/img/dinosaurloading.gif" data-lazy-src="https://cdn.leosocy.top/img/20201203000045.png"></p>
<h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><h4 id="Dockerç½‘ç»œ"><a href="#Dockerç½‘ç»œ" class="headerlink" title="Dockerç½‘ç»œ"></a>Dockerç½‘ç»œ</h4><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://segmentfault.com/a/1190000007898437">https://segmentfault.com/a/1190000007898437</a></li>
</ul>
<h3 id="Podman"><a href="#Podman" class="headerlink" title="Podman"></a>Podman</h3><h2 id="Kubernetes"><a href="#Kubernetes" class="headerlink" title="Kubernetes"></a>Kubernetes</h2><h3 id="K8Sç½‘ç»œ"><a href="#K8Sç½‘ç»œ" class="headerlink" title="K8Sç½‘ç»œ"></a>K8Sç½‘ç»œ</h3><h4 id="Flannelç½‘ç»œåŸç†"><a href="#Flannelç½‘ç»œåŸç†" class="headerlink" title="Flannelç½‘ç»œåŸç†"></a>Flannelç½‘ç»œåŸç†</h4><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.laputa.io/kubernetes-flannel-networking-6a1cb1f8ec7c">https://blog.laputa.io/kubernetes-flannel-networking-6a1cb1f8ec7c</a></p>
<ul>
<li>nodeçš„annotationä¸­æœ‰flannelç›¸å…³çš„ä¿¡æ¯ï¼Œæ¯”å¦‚Vtep MACã€PublicIPã€podCIDRç­‰</li>
<li>flannelä¼šé€šè¿‡IndexerInformer watch k8s nodeçš„å˜æ›´</li>
<li>å¯¹äºnodeçš„å˜æ›´ï¼Œflannelä¼šè°ƒç”¨netlinkåŒ…ä¸­çš„FDBã€ARPæ¥å£ï¼Œæ›´æ–°fdbè¡¨å’Œè·¯ç”±è¡¨</li>
</ul>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="http://just4coding.com/2020/04/20/vxlan-fdb/">http://just4coding.com/2020/04/20/vxlan-fdb/</a></p>
<h3 id="Helm"><a href="#Helm" class="headerlink" title="Helm"></a>Helm</h3><p>ä¸‰å¤§æ¦‚å¿µ</p>
<ol>
<li>Chartï¼šä»£è¡¨ä¸€ä¸ªhelmåŒ…ï¼ŒåŒ…å«äº†è¿è¡Œä¸€ä¸ªåº”ç”¨/å·¥å…·/æœåŠ¡æ‰€éœ€è¦çš„æ‰€æœ‰èµ„æºå®šä¹‰ï¼Œæ¯”å¦‚åœ¨k8sä¸­éƒ¨ç½²MySQLéœ€è¦<a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/helm/charts/blob/master/stable/mysql/templates/deployment.yaml">Deploymentå®šä¹‰</a>ã€<a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/helm/charts/blob/master/stable/mysql/templates/svc.yaml">Serviceå®šä¹‰</a>ã€<a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/helm/charts/blob/master/stable/mysql/templates/pvc.yaml">PVCå®šä¹‰</a>ç­‰</li>
<li>Repositoryï¼šå­˜å‚¨å…±äº«å„ç§Chartsçš„åœ°æ–¹</li>
<li>Releaseï¼šåœ¨k8sé›†ç¾¤ä¸­è¿è¡ŒChartå®ä¾‹ï¼Œä¸€ä¸ªChartå¯ä»¥å¤šæ¬¡å®‰è£…åˆ°åŒä¸€é›†ç¾¤ä¸­ï¼Œæ¯æ¬¡å®‰è£…æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°ç‰ˆæœ¬ã€‚æ¯”å¦‚åœ¨ä¸€ä¸ªé›†ç¾¤ä¸­è¿è¡Œä¸¤ä¸ªä¸åŒç‰ˆæœ¬çš„MySQLå®ä¾‹</li>
</ol>
<p>å¸¸ç”¨æ“ä½œ</p>
<ol>
<li><code>helm repo add NAME URL</code>ï¼Œå¯ä»¥åˆ°<a target="_blank" rel="external nofollow noopener noreferrer" href="https://artifacthub.ioæœç´¢å„ç§chartå¯¹åº”çš„repo.`helm/">https://artifacthub.ioæœç´¢å„ç§Chartå¯¹åº”çš„repoã€‚`helm</a> search repo NAME`ï¼Œåœ¨å·²ç»æ·»åŠ çš„repoä¸­<strong>æ¨¡ç³Š</strong>æœç´¢Chart</li>
<li><code>helm install NAME CHART Flags</code>ï¼Œéƒ¨ç½²Chartåˆ°k8sé›†ç¾¤ï¼Œå¯ä»¥æŒ‡å®š<code>-f config.yaml</code>æˆ–<code>--set key=value</code>è¦†ç›–Chartä¸­çš„é…ç½®å€¼ã€‚<code>helm upgrade RELEASE CHART</code>ï¼Œæ›´æ–°Releaseçš„é…ç½®ï¼Œä¸€èˆ¬ç”¨äºæ›´æ–°é…ç½®å€¼</li>
<li><code>helm rollback RELEASE REVISION</code>ï¼Œå›æ»šReleaseåˆ°æŒ‡å®šç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡<code>helm history RELEASE</code>æŸ¥çœ‹å‘å¸ƒå†å²</li>
<li><code>helm list</code>æŸ¥çœ‹éƒ¨ç½²çš„releasesï¼Œ<code>helm uninstall RELEASE</code>å°†releaseä»é›†ç¾¤ä¸­å¸è½½</li>
<li><code>helm create NAME</code>åˆ›å»ºä¸€ä¸ªæ–°çš„Chartï¼Œä½ å¯ä»¥å®šä¹‰è‡ªå·±çš„Chartï¼Œ<code>helm lint PATH</code>ç”¨äºæ ¡éªŒå†™çš„chartæ˜¯ä¸æ˜¯åˆæ³•çš„</li>
</ol>
<h2 id="ServiceMesh"><a href="#ServiceMesh" class="headerlink" title="ServiceMesh"></a>ServiceMesh</h2><h1 id="ç³»ç»Ÿè®¾è®¡"><a href="#ç³»ç»Ÿè®¾è®¡" class="headerlink" title="ç³»ç»Ÿè®¾è®¡"></a>ç³»ç»Ÿè®¾è®¡</h1><h1 id="ä»£ç ä¹‹å¤–çš„è½¯æŠ€èƒ½"><a href="#ä»£ç ä¹‹å¤–çš„è½¯æŠ€èƒ½" class="headerlink" title="ä»£ç ä¹‹å¤–çš„è½¯æŠ€èƒ½"></a>ä»£ç ä¹‹å¤–çš„è½¯æŠ€èƒ½</h1><h1 id="æ•ˆç‡å·¥å…·"><a href="#æ•ˆç‡å·¥å…·" class="headerlink" title="æ•ˆç‡å·¥å…·"></a>æ•ˆç‡å·¥å…·</h1><h2 id="æ€§èƒ½åˆ†æ"><a href="#æ€§èƒ½åˆ†æ" class="headerlink" title="æ€§èƒ½åˆ†æ"></a>æ€§èƒ½åˆ†æ</h2><h3 id="ç«ç„°å›¾"><a href="#ç«ç„°å›¾" class="headerlink" title="ç«ç„°å›¾"></a>ç«ç„°å›¾</h3></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:leosocy@gmail.com" rel="external nofollow noopener noreferrer" target="_blank">Leosocy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://blog.leosocy.top/posts/133f/">https://blog.leosocy.top/posts/133f/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="external nofollow noopener noreferrer">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://blog.leosocy.top" target="_blank">Leosocy's Blog</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">åŸºç¡€çŸ¥è¯†</a><a class="post-meta__tags" href="/tags/%E5%90%8E%E7%AB%AF%E6%8A%80%E8%83%BD/">åç«¯æŠ€èƒ½</a><a class="post-meta__tags" href="/tags/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">ç¼–ç¨‹è¯­è¨€</a><a class="post-meta__tags" href="/tags/%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95/">å†…åŠŸå¿ƒæ³•</a><a class="post-meta__tags" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">å¤§æ•°æ®</a><a class="post-meta__tags" href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/">äº‘åŸç”Ÿ</a><a class="post-meta__tags" href="/tags/%E6%95%88%E7%8E%87%E5%B7%A5%E5%85%B7/">æ•ˆç‡å·¥å…·</a></div><div class="post_share"><div class="social-share" data-image="/img/computer-science.png" data-sites="wechat,weibo,qq,facebook,twitter"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/9e84/"><img class="prev-cover" data-lazy-src="https://cdn.leosocy.top/img/20210703000745.png" onerror="onerror=null;src='https://cdn.leosocy.top/img/404.jpg'"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Dockerå®¹å™¨çš„æ—¥å¿—æ˜¯å¦‚ä½•å­˜å‚¨çš„</div></div></a></div><div class="next-post pull-right"><a href="/posts/6d47/"><img class="next-cover" data-lazy-src="https://cdn.leosocy.top/img/linux-toy-cowsay.png" onerror="onerror=null;src='https://cdn.leosocy.top/img/404.jpg'"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">æ·±å…¥äº†è§£Linux - COWå†™æ—¶æ‹·è´å®ç°åŸç†</div></div></a></div></nav><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div><div class="comment-switch"><span class="first-comment">Valine</span><label><input id="switch-comments-btn" type="checkbox"><span class="slider"></span></label><span class="second-comment">Gitalk</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="gitalk-container"></div></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2017 - 2023   <i id="heartbeat" class="fa fas fa-heartbeat"></i>  Leosocy</div><div class="icp"><a target="_blank" rel="external nofollow noopener noreferrer" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=32011302320676"><span>è‹ICPå¤‡19003706å·-1</span></a></div></div><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LeosocyBlog/cdn@master/css/heartbeat.min.css"></head></footer><script>var bg_index = Math.floor(Math.random() * 21);
if (true === true)
  var res = 'background-image: url("https://cdn.leosocy.top/img/background/' + bg_index + '-bg.jpg");'
else
  var res = 'background-image: url("https://cdn.jsdelivr.net/gh/LeosocyBlog/cdn/img/background/' + bg_index + '-bg.jpg");'
document.getElementById('web_bg').style = res
</script></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="font_plus" type="button" title="æ”¾å¤§å­—ä½“"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="ç¼©å°å­—ä½“"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">æœ¬åœ°æœç´¢</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>ç”±</span> <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>æä¾›æ”¯æŒ</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.spacingElementById('content-inner')
  else {
    $.getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js', () => {
      pangu.spacingElementById('content-inner')
    })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguFn)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    window.valine = new Valine({
      el: '#vcomment',
      appId: 'HrxT0ob97kYUTuWuUo08mkqc-gzGzoHsz',
      appKey: 'oeKW9UqjBpN6MNv7ENaikdwP',
      placeholder: 'è¯·è¾“å…¥å†…å®¹',
      avatar: 'retro',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: 'https://lcapi.leosocy.top',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      visitor: true
    });
    if ('nick') { valine.config.requiredFields= 'nick'.split(',') }
  }

  if (typeof Valine === 'function') initValine() 
  else $.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true && !true) loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(() => loadValine(), 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk({
      clientID: '32b06a1ce1ba2d645bb5',
      clientSecret: 'c4e9c93c5a16234ecb67a9b83b9315f763436cdd',
      repo: 'comments',
      owner: 'LeosocyBlog',
      admin: ['Leosocy'],
      id: 'a358fabc5f4106a986d34e38bc55c3fc',
      language: 'zh-CN',
      perPage: 10,
      distractionFreeMode: true,
      pagerDirection: 'last',
      createIssueManually: false,
      updateCountCallback: commentCount
    })
    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    $.getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js', initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Valine' === 'Gitalk' || !true) {
  if (true) loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script><script>cdn_url = "https://cdn.leosocy.top"</script><script src="/"></script></div><script src="https://cdn.jsdelivr.net/gh/LeosocyBlog/cdn@master/js/leosocy.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>$(function () {
  var pjax = new Pjax({
    selectors: [
      'title',
      'meta[name=description]',
      '#config_change',
      '#body-wrap',
      '#rightside-config-hide',
      '#rightside-config-show',
      '.js-pjax'
    ],
    cacheBust: false,
  })

  document.addEventListener('pjax:complete', function () {
    refreshFn()

    $('script[data-pjax]').each(function () {
      $(this).parent().append($(this).remove())
    })

    GLOBAL_CONFIG.islazyload && lazyLoadInstance.update()

    typeof chatBtnFn === 'function' && chatBtnFn()
    typeof panguInit === 'function' && panguInit()

    if (typeof gtag === 'function') {
      gtag('config', 'G-8EGQPPW7GQ', {'page_path': window.location.pathname});
    }

    if (document.getElementsByClassName('aplayer').length){
      typeof loadMeting === 'function' && loadMeting()
    }
  })

  document.addEventListener('pjax:send', function () {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }

    typeof typed === 'object' && typed.destroy()

    $(window).off('scroll')

    //reset readmode
    $('body').hasClass('read-mode') && $('body').removeClass('read-mode')

    //reset font-size
    $('body').css('font-size') !== originFontSize && $('body').css('font-size', parseFloat(originFontSize))
  })
})</script></div></body></html>